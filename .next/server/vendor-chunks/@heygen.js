"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@heygen";
exports.ids = ["vendor-chunks/@heygen"];
exports.modules = {

/***/ "(ssr)/./node_modules/@heygen/streaming-avatar/lib/index.esm.js":
/*!****************************************************************!*\
  !*** ./node_modules/@heygen/streaming-avatar/lib/index.esm.js ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AvatarQuality: () => (/* binding */ AvatarQuality),\n/* harmony export */   ConnectionQuality: () => (/* binding */ ConnectionQuality),\n/* harmony export */   ElevenLabsModel: () => (/* binding */ ElevenLabsModel),\n/* harmony export */   STTProvider: () => (/* binding */ STTProvider),\n/* harmony export */   StreamingEvents: () => (/* binding */ StreamingEvents),\n/* harmony export */   TaskMode: () => (/* binding */ TaskMode),\n/* harmony export */   TaskType: () => (/* binding */ TaskType),\n/* harmony export */   VoiceChatTransport: () => (/* binding */ VoiceChatTransport),\n/* harmony export */   VoiceEmotion: () => (/* binding */ VoiceEmotion),\n/* harmony export */   \"default\": () => (/* binding */ StreamingAvatar)\n/* harmony export */ });\n/* harmony import */ var livekit_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! livekit-client */ \"(ssr)/./node_modules/livekit-client/dist/livekit-client.esm.mjs\");\n/* harmony import */ var protobufjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! protobufjs */ \"(ssr)/./node_modules/protobufjs/index.js\");\n\n\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nvar options = {\n\tsyntax: \"proto3\"\n};\nvar nested = {\n\tpipecat: {\n\t\tnested: {\n\t\t\tTextFrame: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"uint64\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\ttext: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tAudioRawFrame: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"uint64\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\taudio: {\n\t\t\t\t\t\ttype: \"bytes\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t},\n\t\t\t\t\tsampleRate: {\n\t\t\t\t\t\ttype: \"uint32\",\n\t\t\t\t\t\tid: 4\n\t\t\t\t\t},\n\t\t\t\t\tnumChannels: {\n\t\t\t\t\t\ttype: \"uint32\",\n\t\t\t\t\t\tid: 5\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tTranscriptionFrame: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"uint64\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\ttext: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t},\n\t\t\t\t\tuserId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 4\n\t\t\t\t\t},\n\t\t\t\t\ttimestamp: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 5\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tFrame: {\n\t\t\t\toneofs: {\n\t\t\t\t\tframe: {\n\t\t\t\t\t\toneof: [\n\t\t\t\t\t\t\t\"text\",\n\t\t\t\t\t\t\t\"audio\",\n\t\t\t\t\t\t\t\"transcription\"\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfields: {\n\t\t\t\t\ttext: {\n\t\t\t\t\t\ttype: \"TextFrame\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\taudio: {\n\t\t\t\t\t\ttype: \"AudioRawFrame\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\ttranscription: {\n\t\t\t\t\t\ttype: \"TranscriptionFrame\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\nvar jsonDescriptor = {\n\toptions: options,\n\tnested: nested\n};\n\nvar ConnectionQuality;\n(function (ConnectionQuality) {\n    ConnectionQuality[\"UNKNOWN\"] = \"UNKNOWN\";\n    ConnectionQuality[\"GOOD\"] = \"GOOD\";\n    ConnectionQuality[\"BAD\"] = \"BAD\";\n})(ConnectionQuality || (ConnectionQuality = {}));\nvar AbstractConnectionQualityIndicator = /** @class */ (function () {\n    function AbstractConnectionQualityIndicator(onConnectionQualityChanged) {\n        this._connectionQuality = ConnectionQuality.UNKNOWN;\n        this.onConnectionQualityChanged = onConnectionQualityChanged;\n    }\n    Object.defineProperty(AbstractConnectionQualityIndicator.prototype, \"connectionQuality\", {\n        get: function () {\n            return this._connectionQuality;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    AbstractConnectionQualityIndicator.prototype.handleStatsChanged = function () {\n        var newConnectionQuality = this.calculateConnectionQuality();\n        if (newConnectionQuality !== this._connectionQuality) {\n            this._connectionQuality = newConnectionQuality;\n            this.onConnectionQualityChanged(newConnectionQuality);\n        }\n    };\n    AbstractConnectionQualityIndicator.prototype.start = function (params) {\n        this.stop(true);\n        this._start(params);\n    };\n    AbstractConnectionQualityIndicator.prototype.stop = function (muted) {\n        if (muted === void 0) { muted = false; }\n        this._stop();\n        this._connectionQuality = ConnectionQuality.UNKNOWN;\n        if (!muted) {\n            this.onConnectionQualityChanged(ConnectionQuality.UNKNOWN);\n        }\n    };\n    return AbstractConnectionQualityIndicator;\n}());\nfunction QualityIndicatorMixer() {\n    var configs = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        configs[_i] = arguments[_i];\n    }\n    var CombinedQualityIndicator = /** @class */ (function (_super) {\n        __extends(CombinedQualityIndicator, _super);\n        function CombinedQualityIndicator(onConnectionQualityChanged) {\n            var _this = _super.call(this, onConnectionQualityChanged) || this;\n            _this.childTrackers = configs.map(function (_a) {\n                var getParams = _a.getParams, TrackerClass = _a.TrackerClass;\n                return ({\n                    tracker: new TrackerClass(function () { return _this.handleStatsChanged(); }),\n                    getParams: getParams,\n                });\n            });\n            return _this;\n        }\n        CombinedQualityIndicator.prototype.calculateConnectionQuality = function () {\n            var connectionQualities = this.childTrackers.map(function (_a) {\n                var tracker = _a.tracker;\n                return tracker.connectionQuality;\n            });\n            if (connectionQualities.some(function (quality) { return quality === ConnectionQuality.BAD; })) {\n                return ConnectionQuality.BAD;\n            }\n            if (connectionQualities.every(function (quality) { return quality === ConnectionQuality.UNKNOWN; })) {\n                return ConnectionQuality.UNKNOWN;\n            }\n            return ConnectionQuality.GOOD;\n        };\n        CombinedQualityIndicator.prototype._start = function (params) {\n            this.childTrackers.forEach(function (_a) {\n                var tracker = _a.tracker, getParams = _a.getParams;\n                return tracker.start(getParams(params));\n            });\n        };\n        CombinedQualityIndicator.prototype._stop = function () {\n            this.childTrackers.forEach(function (_a) {\n                var tracker = _a.tracker;\n                return tracker.stop(true);\n            });\n        };\n        return CombinedQualityIndicator;\n    }(AbstractConnectionQualityIndicator));\n    return CombinedQualityIndicator;\n}\n\nvar LiveKitConnectionQualityIndicator = /** @class */ (function (_super) {\n    __extends(LiveKitConnectionQualityIndicator, _super);\n    function LiveKitConnectionQualityIndicator() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.room = null;\n        _this.liveKitConnectionQuality = livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionQuality.Unknown;\n        _this.liveKitConnectionState = null;\n        _this.handleConnectionQualityChanged = function (quality) {\n            _this.liveKitConnectionQuality = quality;\n            _this.handleStatsChanged();\n        };\n        _this.handleConnectionStateChanged = function (state) {\n            _this.liveKitConnectionState = state;\n            _this.handleStatsChanged();\n        };\n        return _this;\n    }\n    LiveKitConnectionQualityIndicator.prototype._start = function (room) {\n        this.room = room;\n        this.room.localParticipant.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.ConnectionQualityChanged, this.handleConnectionQualityChanged);\n        this.room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged, this.handleConnectionStateChanged);\n    };\n    LiveKitConnectionQualityIndicator.prototype._stop = function () {\n        if (this.room) {\n            this.room.localParticipant.off(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionQualityChanged, this.handleConnectionQualityChanged);\n            this.room.off(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged, this.handleConnectionStateChanged);\n        }\n    };\n    LiveKitConnectionQualityIndicator.prototype.calculateConnectionQuality = function () {\n        if ([livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionQuality.Lost, livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionQuality.Poor].includes(this.liveKitConnectionQuality)) {\n            return ConnectionQuality.BAD;\n        }\n        if (this.liveKitConnectionState &&\n            [\n                livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionState.Disconnected,\n                livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionState.Reconnecting,\n                livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionState.SignalReconnecting,\n            ].includes(this.liveKitConnectionState)) {\n            return ConnectionQuality.BAD;\n        }\n        return ConnectionQuality.GOOD;\n    };\n    return LiveKitConnectionQualityIndicator;\n}(AbstractConnectionQualityIndicator));\n\nvar t,e,s,n;function r(){}function o(){o.init.call(this);}function i(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function a(t,e,s){if(e)t.call(s);else for(var n=t.length,r=m(t,n),o=0;o<n;++o)r[o].call(s);}function c(t,e,s,n){if(e)t.call(s,n);else for(var r=t.length,o=m(t,r),i=0;i<r;++i)o[i].call(s,n);}function d(t,e,s,n,r){if(e)t.call(s,n,r);else for(var o=t.length,i=m(t,o),a=0;a<o;++a)i[a].call(s,n,r);}function u(t,e,s,n,r,o){if(e)t.call(s,n,r,o);else for(var i=t.length,a=m(t,i),c=0;c<i;++c)a[c].call(s,n,r,o);}function h(t,e,s,n){if(e)t.apply(s,n);else for(var r=t.length,o=m(t,r),i=0;i<r;++i)o[i].apply(s,n);}function l(t,e,s,n){var o,a,c,d;if(\"function\"!=typeof s)throw new TypeError('\"listener\" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit(\"newListener\",e,s.listener?s.listener:s),a=t._events),c=a[e]):(a=t._events=new r,t._eventsCount=0),c){if(\"function\"==typeof c?c=a[e]=n?[s,c]:[c,s]:n?c.unshift(s):c.push(s),!c.warned&&(o=i(t))&&o>0&&c.length>o){c.warned=!0;var u=new Error(\"Possible EventEmitter memory leak detected. \"+c.length+\" \"+e+\" listeners added. Use emitter.setMaxListeners() to increase limit\");u.name=\"MaxListenersExceededWarning\",u.emitter=t,u.type=e,u.count=c.length,d=u,\"function\"==typeof console.warn?console.warn(d):console.log(d);}}else c=a[e]=s,++t._eventsCount;return t}function p(t,e,s){var n=!1;function r(){t.removeListener(e,r),n||(n=!0,s.apply(t,arguments));}return r.listener=s,r}function f(t){var e=this._events;if(e){var s=e[t];if(\"function\"==typeof s)return 1;if(s)return s.length}return 0}function m(t,e){for(var s=new Array(e);e--;)s[e]=t[e];return s}r.prototype=Object.create(null),o.EventEmitter=o,o.usingDomains=!1,o.prototype.domain=void 0,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.init=function(){this.domain=null,o.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new r,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},o.prototype.setMaxListeners=function(t){if(\"number\"!=typeof t||t<0||isNaN(t))throw new TypeError('\"n\" argument must be a positive number');return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return i(this)},o.prototype.emit=function(t){var e,s,n,r,o,i,l,p=\"error\"===t;if(i=this._events)p=p&&null==i.error;else if(!p)return !1;if(l=this.domain,p){if(e=arguments[1],!l){if(e instanceof Error)throw e;var f=new Error('Uncaught, unspecified \"error\" event. ('+e+\")\");throw f.context=e,f}return e||(e=new Error('Uncaught, unspecified \"error\" event')),e.domainEmitter=this,e.domain=l,e.domainThrown=!1,l.emit(\"error\",e),!1}if(!(s=i[t]))return !1;var m=\"function\"==typeof s;switch(n=arguments.length){case 1:a(s,m,this);break;case 2:c(s,m,this,arguments[1]);break;case 3:d(s,m,this,arguments[1],arguments[2]);break;case 4:u(s,m,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];h(s,m,this,r);}return !0},o.prototype.addListener=function(t,e){return l(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return l(this,t,e,!0)},o.prototype.once=function(t,e){if(\"function\"!=typeof e)throw new TypeError('\"listener\" argument must be a function');return this.on(t,p(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if(\"function\"!=typeof e)throw new TypeError('\"listener\" argument must be a function');return this.prependListener(t,p(this,t,e)),this},o.prototype.removeListener=function(t,e){var s,n,o,i,a;if(\"function\"!=typeof e)throw new TypeError('\"listener\" argument must be a function');if(!(n=this._events))return this;if(!(s=n[t]))return this;if(s===e||s.listener&&s.listener===e)0==--this._eventsCount?this._events=new r:(delete n[t],n.removeListener&&this.emit(\"removeListener\",t,s.listener||e));else if(\"function\"!=typeof s){for(o=-1,i=s.length;i-- >0;)if(s[i]===e||s[i].listener&&s[i].listener===e){a=s[i].listener,o=i;break}if(o<0)return this;if(1===s.length){if(s[0]=void 0,0==--this._eventsCount)return this._events=new r,this;delete n[t];}else !function(t,e){for(var s=e,n=s+1,r=t.length;n<r;s+=1,n+=1)t[s]=t[n];t.pop();}(s,o);n.removeListener&&this.emit(\"removeListener\",t,a||e);}return this},o.prototype.off=function(t,e){return this.removeListener(t,e)},o.prototype.removeAllListeners=function(t){var e,s;if(!(s=this._events))return this;if(!s.removeListener)return 0===arguments.length?(this._events=new r,this._eventsCount=0):s[t]&&(0==--this._eventsCount?this._events=new r:delete s[t]),this;if(0===arguments.length){for(var n,o=Object.keys(s),i=0;i<o.length;++i)\"removeListener\"!==(n=o[i])&&this.removeAllListeners(n);return this.removeAllListeners(\"removeListener\"),this._events=new r,this._eventsCount=0,this}if(\"function\"==typeof(e=s[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1]);}while(e[0]);return this},o.prototype.listeners=function(t){var e,s=this._events;return s&&(e=s[t])?\"function\"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),s=0;s<e.length;++s)e[s]=t[s].listener||t[s];return e}(e):[]},o.listenerCount=function(t,e){return \"function\"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class g extends o{}!function(t){t.Issue=\"issue\",t.NetworkScoresUpdated=\"network-scores-updated\",t.StatsParsingFinished=\"stats-parsing-finished\";}(t||(t={})),function(t){t.Network=\"network\",t.CPU=\"cpu\",t.Server=\"server\",t.Stream=\"stream\";}(e||(e={})),function(t){t.OutboundNetworkQuality=\"outbound-network-quality\",t.InboundNetworkQuality=\"inbound-network-quality\",t.OutboundNetworkMediaLatency=\"outbound-network-media-latency\",t.InboundNetworkMediaLatency=\"inbound-network-media-latency\",t.NetworkMediaSyncFailure=\"network-media-sync-failure\",t.OutboundNetworkThroughput=\"outbound-network-throughput\",t.InboundNetworkThroughput=\"inbound-network-throughput\",t.EncoderCPUThrottling=\"encoder-cpu-throttling\",t.DecoderCPUThrottling=\"decoder-cpu-throttling\",t.ServerIssue=\"server-issue\",t.UnknownVideoDecoderIssue=\"unknown-video-decoder\",t.LowInboundMOS=\"low-inbound-mean-opinion-score\",t.LowOutboundMOS=\"low-outbound-mean-opinion-score\",t.FrozenVideoTrack=\"frozen-video-track\",t.MissingVideoStreamData=\"missing-video-stream-data\",t.MissingAudioStreamData=\"missing-audio-stream-data\";}(s||(s={})),function(t){t[t.BAD=2.1]=\"BAD\",t[t.POOR=2.6]=\"POOR\",t[t.FAIR=3.1]=\"FAIR\",t[t.GOOD=3.8]=\"GOOD\",t[t.EXCELLENT=4.3]=\"EXCELLENT\";}(n||(n={}));class S extends o{static STATS_REPORT_READY_EVENT=\"stats-report-ready\";static STATS_REPORTS_PARSED=\"stats-reports-parsed\";isStopped=!1;reportTimer;getStatsInterval;compositeStatsParser;constructor(t){super(),this.compositeStatsParser=t.compositeStatsParser,this.getStatsInterval=t.getStatsInterval??1e4;}get isRunning(){return !!this.reportTimer&&!this.isStopped}startReporting(){if(this.reportTimer)return;const t=()=>setTimeout((()=>{this.isStopped?this.reportTimer=void 0:this.parseReports().finally((()=>{this.reportTimer=t();}));}),this.getStatsInterval);this.isStopped=!1,this.reportTimer=t();}stopReporting(){this.isStopped=!0,this.reportTimer&&(clearTimeout(this.reportTimer),this.reportTimer=void 0);}async parseReports(){const t=Date.now(),e=await this.compositeStatsParser.parse(),s=Date.now()-t;this.emit(S.STATS_REPORTS_PARSED,{timeTaken:s,reportItems:e}),e.forEach((t=>{this.emit(S.STATS_REPORT_READY_EVENT,t);}));}}const v=(()=>{const t=new Map;return e=>{const{taskId:s,delayMs:n,maxJitterMs:r,callback:o}=e,i=Math.ceil(Math.random()*(r||0)),a=t.get(s);a&&clearTimeout(a);const c=setTimeout((()=>{o(),t.delete(s);}),n+i);t.set(s,c);}})();class k{#t={};calculate(t){const{connection:{id:e}}=t,{mos:s,stats:n}=this.calculateOutboundScore(t)||{},{mos:r,stats:o}=this.calculateInboundScore(t)||{};return this.#t[e]=t,v({taskId:e,delayMs:35e3,callback:()=>delete this.#t[e]}),{outbound:s,inbound:r,connectionId:e,statsSamples:{inboundStatsSample:o,outboundStatsSample:n}}}calculateOutboundScore(t){const e=[...t.remote?.audio.inbound||[],...t.remote?.video.inbound||[]];if(!e.length)return;const s=this.#t[t.connection.id];if(!s)return;const n=[...s.remote?.audio.inbound||[],...s.remote?.video.inbound||[]],{packetsSent:r}=t.connection,o=s.connection.packetsSent,i=e.reduce(((t,e)=>{const s=n.find((t=>t.ssrc===e.ssrc));return {sumJitter:t.sumJitter+e.jitter,packetsLost:t.packetsLost+e.packetsLost,lastPacketsLost:t.lastPacketsLost+(s?.packetsLost||0)}}),{sumJitter:0,packetsLost:0,lastPacketsLost:0}),a=1e3*t.connection.currentRoundTripTime||0,{sumJitter:c}=i,d=c/e.length,u=r-o,h=i.packetsLost-i.lastPacketsLost,l=u&&h?Math.round(100*h/(u+h)):0;return {mos:this.calculateMOS({avgJitter:d,rtt:a,packetsLoss:l}),stats:{avgJitter:d,rtt:a,packetsLoss:l}}}calculateInboundScore(t){const e=[...t.audio?.inbound,...t.video?.inbound];if(!e.length)return;const s=this.#t[t.connection.id];if(!s)return;const n=[...s.video?.inbound,...s.audio?.inbound],{packetsReceived:r}=t.connection,o=s.connection.packetsReceived,i=e.reduce(((t,e)=>{const s=n.find((t=>t.ssrc===e.ssrc));return {sumJitter:t.sumJitter+e.jitter,packetsLost:t.packetsLost+e.packetsLost,lastPacketsLost:t.lastPacketsLost+(s?.packetsLost||0)}}),{sumJitter:0,packetsLost:0,lastPacketsLost:0}),a=1e3*t.connection.currentRoundTripTime||0,{sumJitter:c}=i,d=c/e.length,u=r-o,h=i.packetsLost-i.lastPacketsLost,l=u&&h?Math.round(100*h/(u+h)):0;return {mos:this.calculateMOS({avgJitter:d,rtt:a,packetsLoss:l}),stats:{avgJitter:d,rtt:a,packetsLoss:l}}}calculateMOS({avgJitter:t,rtt:e,packetsLoss:s}){const n=e+2*t+10;let r=n<160?93.2-n/40:93.2-n/120-10;return r-=2.5*s,1+.035*r+7e-6*r*(r-60)*(100-r)}}class y{#e=new Map;#s;#n;constructor(t={}){this.#s=t.statsCleanupTtlMs??35e3,this.#n=t.maxParsedStatsStorageSize??5;}detect(t,e){const s={...t,networkScores:{...e,statsSamples:e?.statsSamples||{}}},n=this.performDetection(s);return this.setLastProcessedStats(t.connection.id,s),this.performPrevStatsCleanup({connectionId:t.connection.id}),n}performPrevStatsCleanup(t){const{connectionId:e,cleanupCallback:s}=t;this.#e.has(e)&&v({taskId:e,delayMs:this.#s,callback:()=>{this.deleteLastProcessedStats(e),\"function\"==typeof s&&s();}});}setLastProcessedStats(t,e){if(!t||e.connection.id!==t)return;const s=this.#e.get(t)??[];s.push(e),s.length>this.#n&&s.shift(),this.#e.set(t,s);}getLastProcessedStats(t){const e=this.#e.get(t);return e?.[e.length-1]}getAllLastProcessedStats(t){return this.#e.get(t)??[]}deleteLastProcessedStats(t){this.#e.delete(t);}}class w extends y{#r;constructor(t={}){super(t),this.#r=t.availableOutgoingBitrateThreshold??1e5;}performDetection(t){const n=[],{availableOutgoingBitrate:r}=t.connection;if(void 0===r)return n;const o=t.audio.outbound.reduce(((t,e)=>t+e.targetBitrate),0),i=t.video.outbound.reduce(((t,e)=>t+e.bitrate),0);if(!o&&!i)return n;const a={availableOutgoingBitrate:r,videoStreamsTotalBitrate:i,audioStreamsTotalTargetBitrate:o};return o>r||i>0&&r<this.#r?(n.push({statsSample:a,type:e.Network,reason:s.OutboundNetworkThroughput}),n):n}}class b extends y{#o;#i;#a;#c;constructor(t={}){super(),this.#o=t.highPacketLossThresholdPct??5,this.#i=t.highJitterThreshold??200,this.#a=t.highJitterBufferDelayThresholdMs??500,this.#c=t.highRttThresholdMs??250;}performDetection(t){return this.processData(t)}processData(t){const n=[],r=[...t.audio?.inbound,...t.video?.inbound];if(!r.length)return n;const o=this.getLastProcessedStats(t.connection.id);if(!o)return n;const i=[...o.video?.inbound,...o.audio?.inbound],{packetsReceived:a}=t.connection,c=o.connection.packetsReceived,d=r.reduce(((t,e)=>{const s=i.find((t=>t.ssrc===e.ssrc)),n=s?.jitterBufferDelay||0,r=s?.jitterBufferEmittedCount||0,o=e.jitterBufferDelay-n,a=e.jitterBufferEmittedCount-r,c=o&&a?1e3*o/a:0;return {sumJitter:t.sumJitter+e.jitter,sumJitterBufferDelayMs:t.sumJitterBufferDelayMs+c,packetsLost:t.packetsLost+e.packetsLost,lastPacketsLost:t.lastPacketsLost+(s?.packetsLost||0)}}),{sumJitter:0,sumJitterBufferDelayMs:0,packetsLost:0,lastPacketsLost:0}),u=1e3*t.connection.currentRoundTripTime||0,{sumJitter:h,sumJitterBufferDelayMs:l}=d,p=h/r.length,f=l/r.length,m=a-c,g=d.packetsLost-d.lastPacketsLost,S=m&&g?Math.round(100*g/(m+g)):0,v=S>this.#o,k=p>=this.#i,y=u>=this.#c,w=f>this.#a,b=y&&!k&&!v,P=v&&k,T=k&&w,L={rtt:u,packetLossPct:S,avgJitter:p,avgJitterBufferDelay:f};return (k||v)&&n.push({statsSample:L,type:e.Network,reason:s.InboundNetworkQuality,iceCandidate:t.connection.local.id}),b&&n.push({statsSample:L,type:e.Server,reason:s.ServerIssue,iceCandidate:t.connection.remote.id}),P&&n.push({statsSample:L,type:e.Network,reason:s.InboundNetworkMediaLatency,iceCandidate:t.connection.local.id}),T&&n.push({statsSample:L,type:e.Network,reason:s.NetworkMediaSyncFailure,iceCandidate:t.connection.local.id}),n}}class P extends y{#d;constructor(t={}){super(),this.#d=t.correctedSamplesThresholdPct??5;}performDetection(t){return this.processData(t)}processData(t){const n=t.audio.inbound,r=[],o=this.getLastProcessedStats(t.connection.id)?.audio.inbound;return o?(n.forEach((t=>{const n=o.find((e=>e.ssrc===t.ssrc));if(!n)return;const i=t.track.insertedSamplesForDeceleration+t.track.removedSamplesForAcceleration,a=n.track.insertedSamplesForDeceleration+n.track.removedSamplesForAcceleration;if(i===a)return;const c=t.track.totalSamplesReceived-n.track.totalSamplesReceived,d=i-a,u=Math.round(100*d/c),h={correctedSamplesPct:u};u>this.#d&&r.push({statsSample:h,type:e.Network,reason:s.NetworkMediaSyncFailure,ssrc:t.ssrc});})),r):r}}class T extends y{#o;#i;constructor(t={}){super(),this.#o=t.highPacketLossThresholdPct??5,this.#i=t.highJitterThreshold??200;}performDetection(t){return this.processData(t)}processData(t){const n=[],r=[...t.remote?.audio.inbound||[],...t.remote?.video.inbound||[]];if(!r.length)return n;const o=this.getLastProcessedStats(t.connection.id);if(!o)return n;const i=[...o.remote?.audio.inbound||[],...o.remote?.video.inbound||[]],{packetsSent:a}=t.connection,c=o.connection.packetsSent,d=r.reduce(((t,e)=>{const s=i.find((t=>t.ssrc===e.ssrc));return {sumJitter:t.sumJitter+e.jitter,packetsLost:t.packetsLost+e.packetsLost,lastPacketsLost:t.lastPacketsLost+(s?.packetsLost||0)}}),{sumJitter:0,packetsLost:0,lastPacketsLost:0}),u=1e3*t.connection.currentRoundTripTime||0,{sumJitter:h}=d,l=h/r.length,p=a-c,f=d.packetsLost-d.lastPacketsLost,m=p&&f?Math.round(100*f/(p+f)):0,g=m>this.#o,S=l>=this.#i,v=!g&&S||S||g,k={rtt:u,avgJitter:l,packetLossPct:m};return g&&S&&n.push({statsSample:k,type:e.Network,reason:s.OutboundNetworkMediaLatency,iceCandidate:t.connection.local.id}),v&&n.push({statsSample:k,type:e.Network,reason:s.OutboundNetworkQuality,iceCandidate:t.connection.local.id}),n}}class L extends y{performDetection(t){return this.processData(t)}processData(t){const n=t.video.outbound.filter((t=>\"none\"!==t.qualityLimitationReason)),r=[],o=this.getLastProcessedStats(t.connection.id)?.video.outbound;return o?(n.forEach((t=>{const n=o.find((e=>e.ssrc===t.ssrc));if(!n)return;const i={qualityLimitationReason:t.qualityLimitationReason};t.framesSent>n.framesSent||(\"cpu\"===t.qualityLimitationReason&&r.push({statsSample:i,type:e.CPU,reason:s.EncoderCPUThrottling,ssrc:t.ssrc}),\"bandwidth\"===t.qualityLimitationReason&&r.push({statsSample:i,type:e.Network,reason:s.OutboundNetworkThroughput,ssrc:t.ssrc}));})),r):r}}class D extends y{UNKNOWN_DECODER=\"unknown\";#u={};performDetection(t){return this.processData(t)}performPrevStatsCleanup(t){const{connectionId:e,cleanupCallback:s}=t;super.performPrevStatsCleanup({...t,cleanupCallback:()=>{delete this.#u[e],\"function\"==typeof s&&s();}});}processData(t){const n=[],{id:r}=t.connection,o=this.getLastProcessedStats(r)?.video.inbound;return t.video.inbound.forEach((t=>{const{decoderImplementation:i,ssrc:a}=t,c=o?.find((t=>t.ssrc===a));if(c)if(i===this.UNKNOWN_DECODER){if(!this.hadLastDecoderWithIssue(r,a)){this.setLastDecoderWithIssue(r,a,this.UNKNOWN_DECODER);const o={mimeType:t.mimeType,decoderImplementation:i};n.push({ssrc:a,statsSample:o,type:e.Stream,reason:s.UnknownVideoDecoderIssue,trackIdentifier:t.track.trackIdentifier});}}else this.setLastDecoderWithIssue(r,a,void 0);})),n}setLastDecoderWithIssue(t,e,s){const n=this.#u[t]??{};void 0===s?delete n[e]:n[e]=s,this.#u[t]=n;}hadLastDecoderWithIssue(t,e){const s=this.#u[t];return (s&&s[e])===this.UNKNOWN_DECODER}}const C=t=>t.reduce(((t,e)=>t+e),0)/t.length,R=(t,e,s=30)=>{const n=[];for(let s=1;s<e.length-1;s+=1){const r=e[s]?.video?.inbound.find((e=>e.ssrc===t));if(!r)continue;const o=e[s-1]?.video?.inbound?.find((e=>e.ssrc===t));if(!r||!o)continue;const i=r.timestamp-o.timestamp,a=r.framesDecoded-o.framesDecoded;if(a>0){const t=i/a;n.push(t);}}if(n.length<=1)return !1;return (t=>{const e=((t,e)=>e.reduce(((e,s)=>e+(s-t)**2),0)/e.length)(C(t),t);return Math.sqrt(e)})(n)>s},M=(t,e)=>{for(let s=1;s<e.length;s+=1){const n=e[s].video.inbound.find((e=>e.ssrc===t));if(!n)continue;const r=e[s-1].video.inbound.find((e=>e.ssrc===t)),o=n.frameWidth!==r?.frameWidth,i=n.frameHeight!==r?.frameHeight;if(o||i)return !0}return !1};class I extends y{#h;#l;#p;constructor(t={}){super(),this.#h=t.avgFreezeDurationThresholdMs??1e3,this.#l=t.frozenDurationThresholdPct??30,this.#p=t.minMosQuality??n.BAD;}performDetection(t){const e=t.networkScores.inbound;return void 0!==e&&e<=this.#p?[]:this.processData(t)}processData(t){const n=[],r=this.getAllLastProcessedStats(t.connection.id);if(0===r.length)return [];const o=t.video.inbound.map((e=>{const s=r[r.length-1].video.inbound.find((t=>t.ssrc===e.ssrc));if(!s)return;if(M(e.ssrc,[r[r.length-1],t]))return;if(R(e.ssrc,r))return;const n=e.freezeCount-(s.freezeCount??0),o=1e3*(e.totalFreezesDuration-(s.totalFreezesDuration??0)),i=n>0?o/n:0,a=o/(e.timestamp-s.timestamp)*100;return a>this.#l||i>this.#h?{ssrc:e.ssrc,avgFreezeDurationMs:i,frozenDurationPct:a}:void 0})).filter((t=>void 0!==t));return o.length>0&&(n.push({type:e.Stream,reason:s.FrozenVideoTrack,statsSample:{ssrcs:o.map((t=>t.ssrc))}}),this.deleteLastProcessedStats(t.connection.id)),n}}class E extends y{#f;#m;#p;constructor(t={}){super(t),this.#f=t.volatilityThreshold??8,this.#m=t.affectedStreamsPercentThreshold??30,this.#p=t.minMosQuality??n.BAD;}performDetection(t){return [...this.getAllLastProcessedStats(t.connection.id),t].find((t=>void 0!==t.networkScores.inbound&&t.networkScores.inbound<=this.#p))?[]:this.processData(t)}processData(t){const n=[],r=[...this.getAllLastProcessedStats(t.connection.id),t],o=t.video.inbound.map((t=>{if(r.length<5)return;if(M(t.ssrc,r))return;const e=[];for(let s=0;s<r.length-1;s+=1){const n=r[s].video.inbound.find((e=>e.ssrc===t.ssrc));void 0!==n?.framesPerSecond&&e.push(n.framesPerSecond);}if(e.length<5)return;if(R(t.ssrc,r))return;const s=(t=>{if(0===t.length)throw new Error(\"Cannot calculate volatility for empty array\");const e=C(t);return t.reduce(((t,s)=>t+Math.abs(s-e)),0)/t.length*100/e})(e);return s>this.#f?{ssrc:t.ssrc,allFps:e,volatility:s}:void 0})).filter((t=>Boolean(t)));if(0===o.length)return n;const i=o.length/(t.video.inbound.length/100);return i>this.#m&&(n.push({type:e.CPU,reason:s.DecoderCPUThrottling,statsSample:{affectedStreamsPercent:i,throtthedStreams:o}}),this.deleteLastProcessedStats(t.connection.id)),n}}const N=t=>\"closed\"===t.iceConnectionState||\"closed\"===t.connectionState,_=(t,e,s)=>8*((t,e,s)=>{if(!e)return 0;const n=t[s],r=e[s];if(null==n||null==r)return 0;const o=Math.floor(t.timestamp)-Math.floor(e.timestamp);return 0===o?0:(Number(n)-Number(r))/o*1e3})(t,e,s);class A{connections=[];statsParser;constructor(t){this.statsParser=t.statsParser;}listConnections(){return [...this.connections]}addPeerConnection(t){this.connections.push({id:t.id??String(Date.now()+Math.random().toString(32)),pc:t.pc});}removePeerConnection(t){const e=this.connections.findIndex((({pc:e})=>e===t.pc));e>=0&&this.removeConnectionsByIndexes([e]);}async parse(){const t=[],e=this.connections.map((async(e,s)=>{if(!N(e.pc))return this.statsParser.parse(e);t.unshift(s);}));t.length&&this.removeConnectionsByIndexes(t);return (await Promise.all(e)).filter((t=>void 0!==t))}removeConnectionsByIndexes(t){t.forEach((t=>{this.connections.splice(t,1);}));}}class O{prevStats=new Map;allowedReportTypes=new Set([\"candidate-pair\",\"inbound-rtp\",\"outbound-rtp\",\"remote-outbound-rtp\",\"remote-inbound-rtp\",\"track\",\"transport\"]);ignoreSSRCList;logger;constructor(t){this.ignoreSSRCList=t.ignoreSSRCList??[],this.logger=t.logger;}get previouslyParsedStatsConnectionsIds(){return [...this.prevStats.keys()]}async parse(t){if(!N(t.pc))return this.getConnectionStats(t);this.logger.debug(\"Skip stats parsing. Connection is closed.\",{connection:t});}async getConnectionStats(t){const{pc:e,id:s}=t;try{const n=Date.now(),r=e.getReceivers().filter((t=>t.track?.enabled)),o=e.getSenders().filter((t=>t.track?.enabled)),i=await Promise.all(r.map((t=>t.getStats()))),a=await Promise.all(o.map((t=>t.getStats())));return {id:s,stats:this.mapReportsStats([...i,...a],t),timeTaken:Date.now()-n}}catch(t){return void this.logger.error(\"Failed to get stats for PC\",{id:s,pc:e,error:t})}}mapReportsStats(t,e){const s={audio:{inbound:[],outbound:[]},video:{inbound:[],outbound:[]},connection:{},remote:{video:{inbound:[],outbound:[]},audio:{inbound:[],outbound:[]}}};t.forEach((t=>{t.forEach((e=>{this.allowedReportTypes.has(e.type)&&this.updateMappedStatsWithReportItemData(e,s,t);}));}));const{id:n}=e,r=this.prevStats.get(n);return r&&this.propagateStatsWithRateValues(s,r.stats),this.prevStats.set(n,{stats:s,ts:Date.now()}),v({taskId:n,delayMs:35e3,callback:()=>this.prevStats.delete(n)}),s}updateMappedStatsWithReportItemData(t,e,s){const n=t.type;if(\"candidate-pair\"===n&&\"succeeded\"===t.state&&t.nominated)return void(e.connection=this.prepareConnectionStats(t,s));const r=this.getMediaType(t);if(!r)return;const o=t.ssrc;if(!o||!this.ignoreSSRCList.includes(o))if(\"outbound-rtp\"!==n)if(\"inbound-rtp\"!==n)\"remote-outbound-rtp\"!==n?\"remote-inbound-rtp\"===n&&(this.mapConnectionStatsIfNecessary(e,t,s),e.remote[r].inbound.push({...t})):e.remote[r].outbound.push({...t});else {const n=s.get(t.trackId)||s.get(t.mediaSourceId)||{};this.mapConnectionStatsIfNecessary(e,t,s);const o={...t,track:{...n}};e[r].inbound.push(o);}else {const n=s.get(t.trackId)||s.get(t.mediaSourceId)||{},o={...t,track:{...n}};e[r].outbound.push(o);}}getMediaType(t){const e=t.mediaType||t.kind;if(![\"audio\",\"video\"].includes(e)){const{id:e}=t;if(!e)return;return String(e).includes(\"Video\")?\"video\":String(e).includes(\"Audio\")?\"audio\":void 0}return e}propagateStatsWithRateValues(t,e){t.audio.inbound.forEach((t=>{const s=e.audio.inbound.find((({id:e})=>e===t.id));t.bitrate=_(t,s,\"bytesReceived\"),t.packetRate=_(t,s,\"packetsReceived\");})),t.audio.outbound.forEach((t=>{const s=e.audio.outbound.find((({id:e})=>e===t.id));t.bitrate=_(t,s,\"bytesSent\"),t.packetRate=_(t,s,\"packetsSent\");})),t.video.inbound.forEach((t=>{const s=e.video.inbound.find((({id:e})=>e===t.id));t.bitrate=_(t,s,\"bytesReceived\"),t.packetRate=_(t,s,\"packetsReceived\");})),t.video.outbound.forEach((t=>{const s=e.video.outbound.find((({id:e})=>e===t.id));t.bitrate=_(t,s,\"bytesSent\"),t.packetRate=_(t,s,\"packetsSent\");}));}mapConnectionStatsIfNecessary(t,e,s){if(t.connection.id||!e.transportId)return;const n=s.get(e.transportId);if(n&&n.selectedCandidatePairId){const e=s.get(n.selectedCandidatePairId);t.connection=this.prepareConnectionStats(e,s);}}prepareConnectionStats(t,e){if(!t||!e)return {};const s={...t};if(s.remoteCandidateId){const t=e.get(s.remoteCandidateId);s.remote={...t};}if(s.localCandidateId){const t=e.get(s.localCandidateId);s.local={...t};}return s}}class J extends y{#g=new Map;#S;#v;constructor(t={}){super(),this.#S=t.timeoutMs??15e3,this.#v=t.steps??3;}performDetection(t){return this.processData(t)}processData(t){const n=[],r=[...this.getAllLastProcessedStats(t.connection.id),t];if(r.length<this.#v)return n;const o=r.slice(-this.#v),i=o.map((t=>t.video.inbound)),a=o.map((t=>t.audio.inbound));n.push(...this.detectMissingData(a,e.Stream,s.MissingAudioStreamData)),n.push(...this.detectMissingData(i,e.Stream,s.MissingVideoStreamData));return new Set(this.#g.keys()).forEach((t=>{const e=this.#g.get(t);e&&Date.now()-e>this.#S&&this.removeMarkedIssue(t);})),n}detectMissingData(t,e,s){const n=[],r=t.pop(),o=J.mapStatsByTrackId(t);return r.forEach((t=>{const r=t.track.trackIdentifier,i=o.get(r);if(!Array.isArray(i)||0===i.length)return;if(t.track.detached||t.track.ended)return;if(!J.isAllBytesReceivedDidntChange(t.bytesReceived,i))return void this.removeMarkedIssue(r);if(!this.markIssue(r))return;const a={bytesReceived:t.bytesReceived};n.push({type:e,reason:s,statsSample:a,trackIdentifier:r});})),n}static mapStatsByTrackId(t){const e=new Map;return t.forEach((t=>{t.forEach((t=>{const s=e.get(t.track.trackIdentifier)||[];s.push(t),e.set(t.track.trackIdentifier,s);}));})),e}static isAllBytesReceivedDidntChange(t,e){for(let s=0;s<e.length;s+=1){if(e[s].bytesReceived!==t)return !1}return !0}markIssue(t){const e=Date.now(),s=this.#g.get(t);return (!s||e-s>this.#S)&&(this.#g.set(t,e),!0)}removeMarkedIssue(t){this.#g.delete(t);}}class x{eventEmitter;#k=!1;detectors=[];networkScoresCalculator;statsReporter;compositeStatsParser;logger;autoAddPeerConnections;constructor(e){this.logger=e.logger??{debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},this.eventEmitter=e.issueEmitter??new g,e.onIssues&&this.eventEmitter.on(t.Issue,e.onIssues),e.onNetworkScoresUpdated&&this.eventEmitter.on(t.NetworkScoresUpdated,e.onNetworkScoresUpdated),this.detectors=e.detectors??[new L,new b,new T,new P,new w,new D,new I,new E,new J],this.networkScoresCalculator=e.networkScoresCalculator??new k,this.compositeStatsParser=e.compositeStatsParser??new A({statsParser:new O({ignoreSSRCList:e.ignoreSSRCList,logger:this.logger})}),this.statsReporter=e.statsReporter??new S({compositeStatsParser:this.compositeStatsParser,getStatsInterval:e.getStatsInterval??5e3}),window.wid=this,this.autoAddPeerConnections=e.autoAddPeerConnections??!0,this.autoAddPeerConnections&&this.wrapRTCPeerConnection(),this.statsReporter.on(S.STATS_REPORT_READY_EVENT,(t=>{const e=this.calculateNetworkScores(t.stats);this.detectIssues({data:t.stats},e);})),this.statsReporter.on(S.STATS_REPORTS_PARSED,(s=>{const n={timeTaken:s.timeTaken,ts:Date.now()};e.onStats&&e.onStats(s.reportItems),this.eventEmitter.emit(t.StatsParsingFinished,n);}));}watchNewPeerConnections(){if(!this.autoAddPeerConnections)throw new Error(\"Auto add peer connections was disabled in the constructor.\");this.#k?this.logger.warn(\"WebRTCIssueDetector is already started. Skip processing\"):(this.logger.info(\"Start watching peer connections\"),this.#k=!0,this.statsReporter.startReporting());}stopWatchingNewPeerConnections(){this.#k?(this.logger.info(\"Stop watching peer connections\"),this.#k=!1,this.statsReporter.stopReporting()):this.logger.warn(\"WebRTCIssueDetector is already stopped. Skip processing\");}handleNewPeerConnection(t,e){this.#k||!this.autoAddPeerConnections?(this.#k||!1!==this.autoAddPeerConnections||(this.logger.info(\"Starting stats reporting for new peer connection\"),this.#k=!0,this.statsReporter.startReporting()),this.logger.debug(\"Handling new peer connection\",t),this.compositeStatsParser.addPeerConnection({pc:t,id:e})):this.logger.debug(\"Skip handling new peer connection. Detector is not running\",t);}emitIssues(e){this.eventEmitter.emit(t.Issue,e);}detectIssues({data:t},e){const s=this.detectors.reduce(((s,n)=>[...s,...n.detect(t,e)]),[]);s.length>0&&this.emitIssues(s);}calculateNetworkScores(e){const s=this.networkScoresCalculator.calculate(e);return this.eventEmitter.emit(t.NetworkScoresUpdated,s),s}wrapRTCPeerConnection(){if(!window.RTCPeerConnection)return void this.logger.warn(\"No RTCPeerConnection found in browser window. Skipping\");const t=window.RTCPeerConnection,e=t=>this.handleNewPeerConnection(t);function s(s){const n=new t(s);return e(n),n}s.prototype=t.prototype,window.RTCPeerConnection=s;}}\n\nvar WebRTCConnectionQualityIndicator = /** @class */ (function (_super) {\n    __extends(WebRTCConnectionQualityIndicator, _super);\n    function WebRTCConnectionQualityIndicator() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.issueDetector = null;\n        _this.mosScores = null;\n        return _this;\n    }\n    WebRTCConnectionQualityIndicator.prototype._start = function (peerConnection) {\n        var _this = this;\n        this.issueDetector = new x({\n            autoAddPeerConnections: false,\n            getStatsInterval: 3000,\n            onNetworkScoresUpdated: function (scores) {\n                _this.mosScores = scores;\n                _this.handleStatsChanged();\n            },\n        });\n        this.issueDetector.handleNewPeerConnection(peerConnection);\n    };\n    WebRTCConnectionQualityIndicator.prototype._stop = function () {\n        if (this.issueDetector) {\n            this.issueDetector.stopWatchingNewPeerConnections();\n            this.issueDetector = null;\n        }\n        this.mosScores = null;\n    };\n    WebRTCConnectionQualityIndicator.prototype.calculateConnectionQuality = function () {\n        if (!this.mosScores || (this.mosScores.inbound && this.mosScores.outbound)) {\n            return ConnectionQuality.UNKNOWN;\n        }\n        if ((this.mosScores.inbound && this.mosScores.inbound < 3) ||\n            (this.mosScores.outbound && this.mosScores.outbound < 3)) {\n            return ConnectionQuality.BAD;\n        }\n        return ConnectionQuality.GOOD;\n    };\n    return WebRTCConnectionQualityIndicator;\n}(AbstractConnectionQualityIndicator));\n\nvar VoiceChatState;\n(function (VoiceChatState) {\n    VoiceChatState[\"INACTIVE\"] = \"inactive\";\n    VoiceChatState[\"STARTING\"] = \"starting\";\n    VoiceChatState[\"ACTIVE\"] = \"started\";\n    VoiceChatState[\"STOPPING\"] = \"stopping\";\n})(VoiceChatState || (VoiceChatState = {}));\nvar AbstractVoiceChat = /** @class */ (function () {\n    function AbstractVoiceChat() {\n    }\n    return AbstractVoiceChat;\n}());\nvar AbstractVoiceChatImplementation = /** @class */ (function (_super) {\n    __extends(AbstractVoiceChatImplementation, _super);\n    function AbstractVoiceChatImplementation() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._isMuted = true;\n        _this.state = VoiceChatState.INACTIVE;\n        return _this;\n    }\n    Object.defineProperty(AbstractVoiceChatImplementation.prototype, \"isMuted\", {\n        get: function () {\n            return this._isMuted;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(AbstractVoiceChatImplementation.prototype, \"isVoiceChatting\", {\n        get: function () {\n            return this.state !== VoiceChatState.INACTIVE;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    AbstractVoiceChatImplementation.prototype.startVoiceChat = function (voiceChatConfig) {\n        return __awaiter(this, void 0, void 0, function () {\n            var e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(this.state !== VoiceChatState.INACTIVE)) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.stopVoiceChat()];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        _a.trys.push([2, 4, , 6]);\n                        this.state = VoiceChatState.STARTING;\n                        return [4 /*yield*/, this._startVoiceChat(voiceChatConfig)];\n                    case 3:\n                        _a.sent();\n                        this.state = VoiceChatState.ACTIVE;\n                        return [3 /*break*/, 6];\n                    case 4:\n                        e_1 = _a.sent();\n                        return [4 /*yield*/, this.stopVoiceChat()];\n                    case 5:\n                        _a.sent();\n                        throw e_1;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AbstractVoiceChatImplementation.prototype.stopVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.state === VoiceChatState.INACTIVE) {\n                            return [2 /*return*/];\n                        }\n                        this.state = VoiceChatState.STOPPING;\n                        return [4 /*yield*/, this._stopVoiceChat()];\n                    case 1:\n                        _a.sent();\n                        this._isMuted = true;\n                        this.state = VoiceChatState.INACTIVE;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AbstractVoiceChatImplementation.prototype._mute = function () {\n        return;\n    };\n    AbstractVoiceChatImplementation.prototype._unmute = function () {\n        return;\n    };\n    AbstractVoiceChatImplementation.prototype.mute = function () {\n        if (!this.isVoiceChatting) {\n            return;\n        }\n        this._mute();\n        this._isMuted = true;\n    };\n    AbstractVoiceChatImplementation.prototype.unmute = function () {\n        if (!this.isVoiceChatting) {\n            return;\n        }\n        this._unmute();\n        this._isMuted = false;\n    };\n    return AbstractVoiceChatImplementation;\n}(AbstractVoiceChat));\n\nfunction sleep(ms) {\n    return new Promise(function (resolve) { return setTimeout(resolve, ms); });\n}\nfunction convertFloat32ToS16PCM(float32Array) {\n    var int16Array = new Int16Array(float32Array.length);\n    for (var i = 0; i < float32Array.length; i++) {\n        var clampedValue = Math.max(-1, Math.min(1, float32Array[i]));\n        int16Array[i] = clampedValue < 0 ? clampedValue * 32768 : clampedValue * 32767;\n    }\n    return int16Array;\n}\n\nvar LivekitVoiceChat = /** @class */ (function (_super) {\n    __extends(LivekitVoiceChat, _super);\n    function LivekitVoiceChat() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.room = null;\n        _this.track = null;\n        return _this;\n    }\n    LivekitVoiceChat.prototype._startVoiceChat = function (voiceChatConfig) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a;\n            var _b;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        this.room = voiceChatConfig.room;\n                        _a = this;\n                        return [4 /*yield*/, (0,livekit_client__WEBPACK_IMPORTED_MODULE_0__.createLocalAudioTrack)({\n                                echoCancellation: true,\n                                noiseSuppression: true,\n                                autoGainControl: true,\n                            })];\n                    case 1:\n                        _a.track = _c.sent();\n                        return [4 /*yield*/, this.room.localParticipant.publishTrack(this.track)];\n                    case 2:\n                        _c.sent();\n                        if (!((_b = voiceChatConfig.config) === null || _b === void 0 ? void 0 : _b.defaultMuted)) {\n                            this.unmute();\n                        }\n                        else {\n                            this.mute();\n                        }\n                        return [4 /*yield*/, sleep(4000)];\n                    case 3:\n                        _c.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    LivekitVoiceChat.prototype._stopVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                if ((_a = this.room) === null || _a === void 0 ? void 0 : _a.localParticipant) {\n                    this.room.localParticipant.getTrackPublications().forEach(function (publication) {\n                        if (publication.track && publication.track.kind === livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Kind.Audio) {\n                            publication.track.stop();\n                        }\n                    });\n                }\n                if (this.track) {\n                    this.track.stop();\n                    this.track = null;\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    LivekitVoiceChat.prototype._mute = function () {\n        if (this.track && !this.track.isMuted) {\n            this.track.mute();\n        }\n    };\n    LivekitVoiceChat.prototype._unmute = function () {\n        if (this.track && this.track.isMuted) {\n            this.track.unmute();\n        }\n    };\n    return LivekitVoiceChat;\n}(AbstractVoiceChatImplementation));\n\nvar WebSocketVoiceChat = /** @class */ (function (_super) {\n    __extends(WebSocketVoiceChat, _super);\n    function WebSocketVoiceChat() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.audioContext = null;\n        _this.webSocket = null;\n        _this.scriptProcessor = null;\n        _this.mediaStreamAudioSource = null;\n        _this.mediaDevicesStream = null;\n        _this.audioRawFrame = null;\n        return _this;\n    }\n    WebSocketVoiceChat.prototype._startVoiceChat = function (voiceChatConfig) {\n        return __awaiter(this, void 0, void 0, function () {\n            var devicesStream;\n            var _this = this;\n            var _a, _b, _c, _d;\n            return __generator(this, function (_e) {\n                switch (_e.label) {\n                    case 0:\n                        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n                            throw new Error('Cannot start voice chat without media devices');\n                        }\n                        this.webSocket = voiceChatConfig.webSocket;\n                        this.audioRawFrame = voiceChatConfig.audioRawFrame;\n                        this.audioContext = new window.AudioContext({\n                            latencyHint: 'interactive',\n                            sampleRate: 16000,\n                        });\n                        if (!((_a = voiceChatConfig.config) === null || _a === void 0 ? void 0 : _a.defaultMuted)) {\n                            this.unmute();\n                        }\n                        return [4 /*yield*/, navigator.mediaDevices.getUserMedia({\n                                audio: {\n                                    sampleRate: 16000,\n                                    channelCount: 1,\n                                    autoGainControl: true,\n                                    echoCancellation: true,\n                                    noiseSuppression: true,\n                                },\n                            })];\n                    case 1:\n                        devicesStream = _e.sent();\n                        this.mediaDevicesStream = devicesStream;\n                        this.mediaStreamAudioSource =\n                            (_b = this.audioContext) === null || _b === void 0 ? void 0 : _b.createMediaStreamSource(devicesStream);\n                        this.scriptProcessor = (_c = this.audioContext) === null || _c === void 0 ? void 0 : _c.createScriptProcessor(512, 1, 1);\n                        this.mediaStreamAudioSource.connect(this.scriptProcessor);\n                        this.scriptProcessor.connect((_d = this.audioContext) === null || _d === void 0 ? void 0 : _d.destination);\n                        this.scriptProcessor.onaudioprocess = function (event) {\n                            var _a;\n                            if (!_this.webSocket || !_this.audioRawFrame) {\n                                return;\n                            }\n                            var audioData;\n                            if (_this.isMuted) {\n                                audioData = new Float32Array(512);\n                            }\n                            else {\n                                audioData = event.inputBuffer.getChannelData(0);\n                            }\n                            var pcmS16Array = convertFloat32ToS16PCM(audioData);\n                            var pcmByteArray = new Uint8Array(pcmS16Array.buffer);\n                            var frame = _this.audioRawFrame.create({\n                                audio: {\n                                    audio: Array.from(pcmByteArray),\n                                    sampleRate: 16000,\n                                    numChannels: 1,\n                                },\n                            });\n                            var encodedFrame = new Uint8Array(_this.audioRawFrame.encode(frame).finish());\n                            (_a = _this.webSocket) === null || _a === void 0 ? void 0 : _a.send(encodedFrame);\n                        };\n                        // though room has been connected, but the stream may not be ready.\n                        return [4 /*yield*/, sleep(2000)];\n                    case 2:\n                        // though room has been connected, but the stream may not be ready.\n                        _e.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WebSocketVoiceChat.prototype._stopVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b;\n            return __generator(this, function (_c) {\n                if (this.audioContext) {\n                    this.audioContext = null;\n                }\n                if (this.scriptProcessor) {\n                    this.scriptProcessor.disconnect();\n                    this.scriptProcessor = null;\n                }\n                if (this.mediaStreamAudioSource) {\n                    this.mediaStreamAudioSource.disconnect();\n                    this.mediaStreamAudioSource = null;\n                }\n                if (this.mediaDevicesStream) {\n                    (_b = (_a = this.mediaDevicesStream) === null || _a === void 0 ? void 0 : _a.getTracks()) === null || _b === void 0 ? void 0 : _b.forEach(function (track) { return track.stop(); });\n                    this.mediaDevicesStream = null;\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    return WebSocketVoiceChat;\n}(AbstractVoiceChatImplementation));\n\nvar VoiceChatTransport;\n(function (VoiceChatTransport) {\n    VoiceChatTransport[\"LIVEKIT\"] = \"livekit\";\n    VoiceChatTransport[\"WEBSOCKET\"] = \"websocket\";\n})(VoiceChatTransport || (VoiceChatTransport = {}));\nvar VoiceChatFactory = /** @class */ (function (_super) {\n    __extends(VoiceChatFactory, _super);\n    function VoiceChatFactory(_a) {\n        var voiceChatInstance = _a.voiceChatInstance, initialConfig = _a.initialConfig;\n        var _this = _super.call(this) || this;\n        _this.initialConfig = initialConfig;\n        _this.voiceChat = voiceChatInstance;\n        return _this;\n    }\n    Object.defineProperty(VoiceChatFactory.prototype, \"isMuted\", {\n        get: function () {\n            return this.voiceChat.isMuted;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(VoiceChatFactory.prototype, \"isVoiceChatting\", {\n        get: function () {\n            return this.voiceChat.isVoiceChatting;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    VoiceChatFactory.prototype.startVoiceChat = function (_a) {\n        return __awaiter(this, arguments, void 0, function (_b) {\n            var config = _b.config;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.voiceChat.startVoiceChat(__assign(__assign({}, this.initialConfig), { config: config }))];\n                    case 1:\n                        _c.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    VoiceChatFactory.prototype.stopVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.voiceChat.stopVoiceChat()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    VoiceChatFactory.prototype.mute = function () {\n        this.voiceChat.mute();\n    };\n    VoiceChatFactory.prototype.unmute = function () {\n        this.voiceChat.unmute();\n    };\n    VoiceChatFactory.createLiveKitVoiceChat = function (voiceChatConfig) {\n        return new this({\n            voiceChatInstance: new LivekitVoiceChat(),\n            initialConfig: voiceChatConfig,\n        });\n    };\n    VoiceChatFactory.createWebSocketVoiceChat = function (voiceChatConfig) {\n        return new this({\n            voiceChatInstance: new WebSocketVoiceChat(),\n            initialConfig: voiceChatConfig,\n        });\n    };\n    return VoiceChatFactory;\n}(AbstractVoiceChat));\n\nvar AvatarQuality;\n(function (AvatarQuality) {\n    AvatarQuality[\"Low\"] = \"low\";\n    AvatarQuality[\"Medium\"] = \"medium\";\n    AvatarQuality[\"High\"] = \"high\";\n})(AvatarQuality || (AvatarQuality = {}));\nvar VoiceEmotion;\n(function (VoiceEmotion) {\n    VoiceEmotion[\"EXCITED\"] = \"excited\";\n    VoiceEmotion[\"SERIOUS\"] = \"serious\";\n    VoiceEmotion[\"FRIENDLY\"] = \"friendly\";\n    VoiceEmotion[\"SOOTHING\"] = \"soothing\";\n    VoiceEmotion[\"BROADCASTER\"] = \"broadcaster\";\n})(VoiceEmotion || (VoiceEmotion = {}));\nvar ElevenLabsModel;\n(function (ElevenLabsModel) {\n    ElevenLabsModel[\"eleven_flash_v2_5\"] = \"eleven_flash_v2_5\";\n    ElevenLabsModel[\"eleven_multilingual_v2\"] = \"eleven_multilingual_v2\";\n})(ElevenLabsModel || (ElevenLabsModel = {}));\nvar STTProvider;\n(function (STTProvider) {\n    STTProvider[\"DEEPGRAM\"] = \"deepgram\";\n    STTProvider[\"GLADIA\"] = \"gladia\";\n})(STTProvider || (STTProvider = {}));\nvar TaskType;\n(function (TaskType) {\n    TaskType[\"TALK\"] = \"talk\";\n    TaskType[\"REPEAT\"] = \"repeat\";\n})(TaskType || (TaskType = {}));\nvar TaskMode;\n(function (TaskMode) {\n    TaskMode[\"SYNC\"] = \"sync\";\n    TaskMode[\"ASYNC\"] = \"async\";\n})(TaskMode || (TaskMode = {}));\n// event types --------------------------------\nvar StreamingEvents;\n(function (StreamingEvents) {\n    StreamingEvents[\"AVATAR_START_TALKING\"] = \"avatar_start_talking\";\n    StreamingEvents[\"AVATAR_STOP_TALKING\"] = \"avatar_stop_talking\";\n    StreamingEvents[\"AVATAR_TALKING_MESSAGE\"] = \"avatar_talking_message\";\n    StreamingEvents[\"AVATAR_END_MESSAGE\"] = \"avatar_end_message\";\n    StreamingEvents[\"USER_TALKING_MESSAGE\"] = \"user_talking_message\";\n    StreamingEvents[\"USER_END_MESSAGE\"] = \"user_end_message\";\n    StreamingEvents[\"USER_START\"] = \"user_start\";\n    StreamingEvents[\"USER_STOP\"] = \"user_stop\";\n    StreamingEvents[\"USER_SILENCE\"] = \"user_silence\";\n    StreamingEvents[\"STREAM_READY\"] = \"stream_ready\";\n    StreamingEvents[\"STREAM_DISCONNECTED\"] = \"stream_disconnected\";\n    StreamingEvents[\"CONNECTION_QUALITY_CHANGED\"] = \"connection_quality_changed\";\n})(StreamingEvents || (StreamingEvents = {}));\nvar APIError = /** @class */ (function (_super) {\n    __extends(APIError, _super);\n    function APIError(message, status, responseText) {\n        var _this = _super.call(this, message) || this;\n        _this.name = 'APIError';\n        _this.status = status;\n        _this.responseText = responseText;\n        return _this;\n    }\n    return APIError;\n}(Error));\nvar ConnectionQualityIndicatorClass = QualityIndicatorMixer({\n    TrackerClass: LiveKitConnectionQualityIndicator,\n    getParams: function (room) { return room; },\n}, {\n    TrackerClass: WebRTCConnectionQualityIndicator,\n    getParams: function (room) { var _a; return ((_a = room.engine.pcManager) === null || _a === void 0 ? void 0 : _a.subscriber)._pc; },\n});\nvar StreamingAvatar = /** @class */ (function () {\n    function StreamingAvatar(_a) {\n        var token = _a.token, _b = _a.basePath, basePath = _b === void 0 ? 'https://api.heygen.com' : _b;\n        var _this = this;\n        this.room = null;\n        this.mediaStream = null;\n        this.eventTarget = new EventTarget();\n        this.webSocket = null;\n        this.sessionId = null;\n        this.voiceChat = null;\n        this.isLiveKitTransport = false;\n        this.token = token;\n        this.basePath = basePath;\n        this.connectionQualityIndicator = new ConnectionQualityIndicatorClass(function (quality) {\n            return _this.emit(StreamingEvents.CONNECTION_QUALITY_CHANGED, quality);\n        });\n    }\n    Object.defineProperty(StreamingAvatar.prototype, \"connectionQuality\", {\n        get: function () {\n            return this.connectionQualityIndicator.connectionQuality;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(StreamingAvatar.prototype, \"isInputAudioMuted\", {\n        get: function () {\n            var _a, _b;\n            return (_b = (_a = this.voiceChat) === null || _a === void 0 ? void 0 : _a.isMuted) !== null && _b !== void 0 ? _b : true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    StreamingAvatar.prototype.muteInputAudio = function () {\n        var _a;\n        (_a = this.voiceChat) === null || _a === void 0 ? void 0 : _a.mute();\n    };\n    StreamingAvatar.prototype.unmuteInputAudio = function () {\n        var _a;\n        (_a = this.voiceChat) === null || _a === void 0 ? void 0 : _a.unmute();\n    };\n    StreamingAvatar.prototype.createStartAvatar = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var sessionInfo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.newSession(requestData)];\n                    case 1:\n                        sessionInfo = _a.sent();\n                        return [2 /*return*/, this.startAvatar(requestData, sessionInfo)];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.startAvatar = function (requestData, sessionInfo) {\n        return __awaiter(this, void 0, void 0, function () {\n            var room, mediaStream;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.sessionId = sessionInfo.session_id;\n                        this.isLiveKitTransport =\n                            requestData.voiceChatTransport === VoiceChatTransport.LIVEKIT;\n                        room = new livekit_client__WEBPACK_IMPORTED_MODULE_0__.Room({\n                            adaptiveStream: true,\n                            dynacast: true,\n                            videoCaptureDefaults: {\n                                resolution: livekit_client__WEBPACK_IMPORTED_MODULE_0__.VideoPresets.h720.resolution,\n                            },\n                        });\n                        this.room = room;\n                        this.mediaStream = null;\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.DataReceived, function (roomMessage) {\n                            var eventMsg = null;\n                            try {\n                                var messageString = new TextDecoder().decode(roomMessage);\n                                eventMsg = JSON.parse(messageString);\n                            }\n                            catch (e) {\n                                console.error(e);\n                            }\n                            if (!eventMsg) {\n                                return;\n                            }\n                            _this.emit(eventMsg.type, eventMsg);\n                        });\n                        mediaStream = new MediaStream();\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackSubscribed, function (track) {\n                            if (track.kind === 'video' || track.kind === 'audio') {\n                                mediaStream.addTrack(track.mediaStreamTrack);\n                                var hasVideoTrack = mediaStream.getVideoTracks().length > 0;\n                                var hasAudioTrack = mediaStream.getAudioTracks().length > 0;\n                                if (hasVideoTrack && hasAudioTrack && !_this.mediaStream) {\n                                    _this.mediaStream = mediaStream;\n                                    _this.emit(StreamingEvents.STREAM_READY, _this.mediaStream);\n                                }\n                            }\n                        });\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackUnsubscribed, function (track) {\n                            var mediaTrack = track.mediaStreamTrack;\n                            if (mediaTrack) {\n                                mediaStream.removeTrack(mediaTrack);\n                            }\n                        });\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.Disconnected, function (reason) {\n                            _this.emit(StreamingEvents.STREAM_DISCONNECTED, reason);\n                        });\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, room.prepareConnection(sessionInfo.url, sessionInfo.access_token)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 4: return [4 /*yield*/, this.startSession()];\n                    case 5:\n                        _a.sent();\n                        return [4 /*yield*/, room.connect(sessionInfo.url, sessionInfo.access_token)];\n                    case 6:\n                        _a.sent();\n                        return [4 /*yield*/, this.connectWebSocket({ useSilencePrompt: !!requestData.useSilencePrompt })];\n                    case 7:\n                        _a.sent();\n                        this.initVoiceChat(requestData.voiceChatTransport || VoiceChatTransport.WEBSOCKET);\n                        this.connectionQualityIndicator.start(room);\n                        return [2 /*return*/, sessionInfo];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.startVoiceChat = function () {\n        return __awaiter(this, arguments, void 0, function (_a) {\n            var _b;\n            var _c = _a === void 0 ? {} : _a, isInputAudioMuted = _c.isInputAudioMuted;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0: return [4 /*yield*/, ((_b = this.voiceChat) === null || _b === void 0 ? void 0 : _b.startVoiceChat({ config: { defaultMuted: isInputAudioMuted } }))];\n                    case 1:\n                        _d.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.closeVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, ((_a = this.voiceChat) === null || _a === void 0 ? void 0 : _a.stopVoiceChat())];\n                    case 1:\n                        _b.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.newSession = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, _d, _e;\n            return __generator(this, function (_f) {\n                return [2 /*return*/, this.request('/v1/streaming.new', {\n                        avatar_name: requestData.avatarName,\n                        quality: requestData.quality,\n                        knowledge_base_id: requestData.knowledgeId,\n                        knowledge_base: requestData.knowledgeBase,\n                        voice: {\n                            voice_id: (_a = requestData.voice) === null || _a === void 0 ? void 0 : _a.voiceId,\n                            rate: (_b = requestData.voice) === null || _b === void 0 ? void 0 : _b.rate,\n                            emotion: (_c = requestData.voice) === null || _c === void 0 ? void 0 : _c.emotion,\n                            elevenlabs_settings: __assign(__assign({}, (_d = requestData === null || requestData === void 0 ? void 0 : requestData.voice) === null || _d === void 0 ? void 0 : _d.elevenlabsSettings), { model_id: (_e = requestData.voice) === null || _e === void 0 ? void 0 : _e.model }),\n                        },\n                        language: requestData.language,\n                        version: 'v2',\n                        video_encoding: 'H264',\n                        source: 'sdk',\n                        disable_idle_timeout: requestData.disableIdleTimeout,\n                        stt_settings: requestData.sttSettings,\n                        ia_is_livekit_transport: requestData.voiceChatTransport === VoiceChatTransport.LIVEKIT,\n                        silence_response: requestData.useSilencePrompt,\n                        activity_idle_timeout: requestData.activityIdleTimeout,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.startSession = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.start', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.speak = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var taskType, taskMode;\n            return __generator(this, function (_a) {\n                taskType = requestData.taskType || requestData.task_type || TaskType.TALK;\n                taskMode = requestData.taskMode || TaskMode.ASYNC;\n                // livekit/websocket text transport supports only async talk task\n                if (taskType === TaskType.TALK && taskMode === TaskMode.ASYNC) {\n                    if (this.isLiveKitTransport && this.room) {\n                        this.sendLivekitMessage(requestData.text);\n                        return [2 /*return*/];\n                    }\n                    if (!this.isLiveKitTransport && this.webSocket && this.audioRawFrame) {\n                        this.sendWebsocketMessage(requestData.text);\n                        return [2 /*return*/];\n                    }\n                }\n                return [2 /*return*/, this.request('/v1/streaming.task', {\n                        text: requestData.text,\n                        session_id: this.sessionId,\n                        task_mode: requestData.taskMode,\n                        task_type: requestData.taskType,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.startListening = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.start_listening', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.stopListening = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.stop_listening', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.interrupt = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.interrupt', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.stopAvatar = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                // clear some resources\n                this.closeVoiceChat();\n                this.connectionQualityIndicator.stop();\n                this.voiceChat = null;\n                if (this.webSocket) {\n                    this.webSocket.close();\n                    this.webSocket = null;\n                }\n                return [2 /*return*/, this.request('/v1/streaming.stop', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.keepAlive = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.keep_alive', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.on = function (eventType, listener) {\n        this.eventTarget.addEventListener(eventType, listener);\n        return this;\n    };\n    StreamingAvatar.prototype.off = function (eventType, listener) {\n        this.eventTarget.removeEventListener(eventType, listener);\n        return this;\n    };\n    StreamingAvatar.prototype.sendLivekitMessage = function (message) {\n        return __awaiter(this, void 0, void 0, function () {\n            var data;\n            return __generator(this, function (_a) {\n                if (!this.room) {\n                    return [2 /*return*/];\n                }\n                data = new TextEncoder().encode(JSON.stringify(message));\n                this.room.localParticipant.publishData(data, { reliable: true });\n                return [2 /*return*/];\n            });\n        });\n    };\n    StreamingAvatar.prototype.sendWebsocketMessage = function (message) {\n        return __awaiter(this, void 0, void 0, function () {\n            var frame, encodedFrame;\n            var _a, _b;\n            return __generator(this, function (_c) {\n                if (!this.webSocket || !this.audioRawFrame) {\n                    return [2 /*return*/];\n                }\n                frame = (_a = this.audioRawFrame) === null || _a === void 0 ? void 0 : _a.create({\n                    text: {\n                        text: message,\n                    },\n                });\n                encodedFrame = new Uint8Array((_b = this.audioRawFrame) === null || _b === void 0 ? void 0 : _b.encode(frame).finish());\n                this.webSocket.send(encodedFrame);\n                return [2 /*return*/];\n            });\n        });\n    };\n    StreamingAvatar.prototype.initVoiceChat = function (transport) {\n        if (transport === VoiceChatTransport.WEBSOCKET) {\n            this.loadAudioRawFrame();\n            if (!this.audioRawFrame || !this.webSocket) {\n                return;\n            }\n            this.voiceChat = VoiceChatFactory.createWebSocketVoiceChat({\n                webSocket: this.webSocket,\n                audioRawFrame: this.audioRawFrame,\n            });\n        }\n        else {\n            if (!this.room) {\n                return;\n            }\n            this.voiceChat = VoiceChatFactory.createLiveKitVoiceChat({\n                room: this.room,\n            });\n        }\n    };\n    StreamingAvatar.prototype.request = function (path, params, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var response, errorText, jsonData, error_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 5, , 6]);\n                        return [4 /*yield*/, fetch(this.getRequestUrl(path), {\n                                method: 'POST',\n                                headers: {\n                                    Authorization: \"Bearer \".concat(this.token),\n                                    'Content-Type': 'application/json',\n                                },\n                                body: JSON.stringify(params),\n                            })];\n                    case 1:\n                        response = _a.sent();\n                        if (!!response.ok) return [3 /*break*/, 3];\n                        return [4 /*yield*/, response.text()];\n                    case 2:\n                        errorText = _a.sent();\n                        throw new APIError(\"API request failed with status \".concat(response.status), response.status, errorText);\n                    case 3: return [4 /*yield*/, response.json()];\n                    case 4:\n                        jsonData = _a.sent();\n                        return [2 /*return*/, jsonData.data];\n                    case 5:\n                        error_2 = _a.sent();\n                        throw error_2;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.emit = function (eventType, detail) {\n        var event = new CustomEvent(eventType, { detail: detail });\n        this.eventTarget.dispatchEvent(event);\n    };\n    StreamingAvatar.prototype.getRequestUrl = function (endpoint) {\n        return \"\".concat(this.basePath).concat(endpoint);\n    };\n    StreamingAvatar.prototype.connectWebSocket = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var websocketUrl;\n            var _this = this;\n            return __generator(this, function (_a) {\n                websocketUrl = \"wss://\".concat(new URL(this.basePath).hostname, \"/v1/ws/streaming.chat?session_id=\").concat(this.sessionId, \"&session_token=\").concat(this.token).concat(this.isLiveKitTransport ? '&arch_version=v2' : '', \"&silence_response=\").concat(requestData.useSilencePrompt);\n                this.webSocket = new WebSocket(websocketUrl);\n                this.webSocket.addEventListener('message', function (event) {\n                    var eventData = null;\n                    try {\n                        eventData = JSON.parse(event.data);\n                    }\n                    catch (e) {\n                        console.error(e);\n                        return;\n                    }\n                    if (eventData) {\n                        _this.emit(eventData.event_type, eventData);\n                    }\n                });\n                this.webSocket.addEventListener('close', function (event) {\n                    _this.webSocket = null;\n                });\n                return [2 /*return*/, new Promise(function (resolve, reject) {\n                        var _a, _b;\n                        (_a = _this.webSocket) === null || _a === void 0 ? void 0 : _a.addEventListener('error', function (event) {\n                            _this.webSocket = null;\n                            reject(event);\n                        });\n                        (_b = _this.webSocket) === null || _b === void 0 ? void 0 : _b.addEventListener('open', function () {\n                            resolve(true);\n                        });\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.loadAudioRawFrame = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var root;\n            return __generator(this, function (_a) {\n                if (!this.audioRawFrame) {\n                    root = protobufjs__WEBPACK_IMPORTED_MODULE_1__.Root.fromJSON(jsonDescriptor);\n                    this.audioRawFrame = root === null || root === void 0 ? void 0 : root.lookupType('pipecat.Frame');\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    return StreamingAvatar;\n}());\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGhleWdlbi9zdHJlYW1pbmctYXZhdGFyL2xpYi9pbmRleC5lc20uanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQTBLO0FBQ3hJOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGdCQUFnQixzQ0FBc0Msa0JBQWtCO0FBQ25GLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELE9BQU87QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsY0FBYyw2QkFBNkIsMEJBQTBCLGNBQWMscUJBQXFCO0FBQ3hHLGlCQUFpQixvREFBb0QscUVBQXFFLGNBQWM7QUFDeEosdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEMsbUNBQW1DLFNBQVM7QUFDNUMsbUNBQW1DLFdBQVcsVUFBVTtBQUN4RCwwQ0FBMEMsY0FBYztBQUN4RDtBQUNBLDhHQUE4RyxPQUFPO0FBQ3JILGlGQUFpRixpQkFBaUI7QUFDbEcseURBQXlELGdCQUFnQixRQUFRO0FBQ2pGLCtDQUErQyxnQkFBZ0IsZ0JBQWdCO0FBQy9FO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQSxVQUFVLFlBQVksYUFBYSxTQUFTLFVBQVU7QUFDdEQsb0NBQW9DLFNBQVM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsOENBQThDO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLHFCQUFxQix1QkFBdUI7QUFDNUM7QUFDQTtBQUNBO0FB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLGlEQUFpRCxnQkFBZ0I7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHFCQUFxQjtBQUNyQixhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw0Q0FBYTtBQUN4QztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSxDQUFDOztBQUU0SyIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxTdWxhaW1hbiBBYnVrYWthclxcRGVza3RvcFxcQUktSU5URVJWSUVXRVJcXG5vZGVfbW9kdWxlc1xcQGhleWdlblxcc3RyZWFtaW5nLWF2YXRhclxcbGliXFxpbmRleC5lc20uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29ubmVjdGlvblF1YWxpdHkgYXMgQ29ubmVjdGlvblF1YWxpdHkkMSwgUGFydGljaXBhbnRFdmVudCwgUm9vbUV2ZW50LCBDb25uZWN0aW9uU3RhdGUsIGNyZWF0ZUxvY2FsQXVkaW9UcmFjaywgVHJhY2ssIFJvb20sIFZpZGVvUHJlc2V0cyB9IGZyb20gJ2xpdmVraXQtY2xpZW50JztcbmltcG9ydCBwcm90b2J1ZiBmcm9tICdwcm90b2J1ZmpzJztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlLCBTdXBwcmVzc2VkRXJyb3IsIFN5bWJvbCAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxyXG5cclxudmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoZyAmJiAoZyA9IDAsIG9wWzBdICYmIChfID0gMCkpLCBfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbnR5cGVvZiBTdXBwcmVzc2VkRXJyb3IgPT09IFwiZnVuY3Rpb25cIiA/IFN1cHByZXNzZWRFcnJvciA6IGZ1bmN0aW9uIChlcnJvciwgc3VwcHJlc3NlZCwgbWVzc2FnZSkge1xyXG4gICAgdmFyIGUgPSBuZXcgRXJyb3IobWVzc2FnZSk7XHJcbiAgICByZXR1cm4gZS5uYW1lID0gXCJTdXBwcmVzc2VkRXJyb3JcIiwgZS5lcnJvciA9IGVycm9yLCBlLnN1cHByZXNzZWQgPSBzdXBwcmVzc2VkLCBlO1xyXG59O1xuXG52YXIgb3B0aW9ucyA9IHtcblx0c3ludGF4OiBcInByb3RvM1wiXG59O1xudmFyIG5lc3RlZCA9IHtcblx0cGlwZWNhdDoge1xuXHRcdG5lc3RlZDoge1xuXHRcdFx0VGV4dEZyYW1lOiB7XG5cdFx0XHRcdGZpZWxkczoge1xuXHRcdFx0XHRcdGlkOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInVpbnQ2NFwiLFxuXHRcdFx0XHRcdFx0aWQ6IDFcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdG5hbWU6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwic3RyaW5nXCIsXG5cdFx0XHRcdFx0XHRpZDogMlxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0dGV4dDoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJzdHJpbmdcIixcblx0XHRcdFx0XHRcdGlkOiAzXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0QXVkaW9SYXdGcmFtZToge1xuXHRcdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0XHRpZDoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJ1aW50NjRcIixcblx0XHRcdFx0XHRcdGlkOiAxXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRuYW1lOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInN0cmluZ1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDJcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGF1ZGlvOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcImJ5dGVzXCIsXG5cdFx0XHRcdFx0XHRpZDogM1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0c2FtcGxlUmF0ZToge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJ1aW50MzJcIixcblx0XHRcdFx0XHRcdGlkOiA0XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRudW1DaGFubmVsczoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJ1aW50MzJcIixcblx0XHRcdFx0XHRcdGlkOiA1XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0VHJhbnNjcmlwdGlvbkZyYW1lOiB7XG5cdFx0XHRcdGZpZWxkczoge1xuXHRcdFx0XHRcdGlkOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInVpbnQ2NFwiLFxuXHRcdFx0XHRcdFx0aWQ6IDFcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdG5hbWU6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwic3RyaW5nXCIsXG5cdFx0XHRcdFx0XHRpZDogMlxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0dGV4dDoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJzdHJpbmdcIixcblx0XHRcdFx0XHRcdGlkOiAzXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR1c2VySWQ6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwic3RyaW5nXCIsXG5cdFx0XHRcdFx0XHRpZDogNFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0dGltZXN0YW1wOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInN0cmluZ1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDVcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHRGcmFtZToge1xuXHRcdFx0XHRvbmVvZnM6IHtcblx0XHRcdFx0XHRmcmFtZToge1xuXHRcdFx0XHRcdFx0b25lb2Y6IFtcblx0XHRcdFx0XHRcdFx0XCJ0ZXh0XCIsXG5cdFx0XHRcdFx0XHRcdFwiYXVkaW9cIixcblx0XHRcdFx0XHRcdFx0XCJ0cmFuc2NyaXB0aW9uXCJcblx0XHRcdFx0XHRcdF1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sXG5cdFx0XHRcdGZpZWxkczoge1xuXHRcdFx0XHRcdHRleHQ6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwiVGV4dEZyYW1lXCIsXG5cdFx0XHRcdFx0XHRpZDogMVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0YXVkaW86IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwiQXVkaW9SYXdGcmFtZVwiLFxuXHRcdFx0XHRcdFx0aWQ6IDJcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHRyYW5zY3JpcHRpb246IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwiVHJhbnNjcmlwdGlvbkZyYW1lXCIsXG5cdFx0XHRcdFx0XHRpZDogM1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxufTtcbnZhciBqc29uRGVzY3JpcHRvciA9IHtcblx0b3B0aW9uczogb3B0aW9ucyxcblx0bmVzdGVkOiBuZXN0ZWRcbn07XG5cbnZhciBDb25uZWN0aW9uUXVhbGl0eTtcbihmdW5jdGlvbiAoQ29ubmVjdGlvblF1YWxpdHkpIHtcbiAgICBDb25uZWN0aW9uUXVhbGl0eVtcIlVOS05PV05cIl0gPSBcIlVOS05PV05cIjtcbiAgICBDb25uZWN0aW9uUXVhbGl0eVtcIkdPT0RcIl0gPSBcIkdPT0RcIjtcbiAgICBDb25uZWN0aW9uUXVhbGl0eVtcIkJBRFwiXSA9IFwiQkFEXCI7XG59KShDb25uZWN0aW9uUXVhbGl0eSB8fCAoQ29ubmVjdGlvblF1YWxpdHkgPSB7fSkpO1xudmFyIEFic3RyYWN0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQWJzdHJhY3RDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcihvbkNvbm5lY3Rpb25RdWFsaXR5Q2hhbmdlZCkge1xuICAgICAgICB0aGlzLl9jb25uZWN0aW9uUXVhbGl0eSA9IENvbm5lY3Rpb25RdWFsaXR5LlVOS05PV047XG4gICAgICAgIHRoaXMub25Db25uZWN0aW9uUXVhbGl0eUNoYW5nZWQgPSBvbkNvbm5lY3Rpb25RdWFsaXR5Q2hhbmdlZDtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFic3RyYWN0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IucHJvdG90eXBlLCBcImNvbm5lY3Rpb25RdWFsaXR5XCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvblF1YWxpdHk7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBBYnN0cmFjdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZS5oYW5kbGVTdGF0c0NoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBuZXdDb25uZWN0aW9uUXVhbGl0eSA9IHRoaXMuY2FsY3VsYXRlQ29ubmVjdGlvblF1YWxpdHkoKTtcbiAgICAgICAgaWYgKG5ld0Nvbm5lY3Rpb25RdWFsaXR5ICE9PSB0aGlzLl9jb25uZWN0aW9uUXVhbGl0eSkge1xuICAgICAgICAgICAgdGhpcy5fY29ubmVjdGlvblF1YWxpdHkgPSBuZXdDb25uZWN0aW9uUXVhbGl0eTtcbiAgICAgICAgICAgIHRoaXMub25Db25uZWN0aW9uUXVhbGl0eUNoYW5nZWQobmV3Q29ubmVjdGlvblF1YWxpdHkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBYnN0cmFjdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdGhpcy5zdG9wKHRydWUpO1xuICAgICAgICB0aGlzLl9zdGFydChwYXJhbXMpO1xuICAgIH07XG4gICAgQWJzdHJhY3RDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uIChtdXRlZCkge1xuICAgICAgICBpZiAobXV0ZWQgPT09IHZvaWQgMCkgeyBtdXRlZCA9IGZhbHNlOyB9XG4gICAgICAgIHRoaXMuX3N0b3AoKTtcbiAgICAgICAgdGhpcy5fY29ubmVjdGlvblF1YWxpdHkgPSBDb25uZWN0aW9uUXVhbGl0eS5VTktOT1dOO1xuICAgICAgICBpZiAoIW11dGVkKSB7XG4gICAgICAgICAgICB0aGlzLm9uQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkKENvbm5lY3Rpb25RdWFsaXR5LlVOS05PV04pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gQWJzdHJhY3RDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcjtcbn0oKSk7XG5mdW5jdGlvbiBRdWFsaXR5SW5kaWNhdG9yTWl4ZXIoKSB7XG4gICAgdmFyIGNvbmZpZ3MgPSBbXTtcbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICBjb25maWdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgfVxuICAgIHZhciBDb21iaW5lZFF1YWxpdHlJbmRpY2F0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhDb21iaW5lZFF1YWxpdHlJbmRpY2F0b3IsIF9zdXBlcik7XG4gICAgICAgIGZ1bmN0aW9uIENvbWJpbmVkUXVhbGl0eUluZGljYXRvcihvbkNvbm5lY3Rpb25RdWFsaXR5Q2hhbmdlZCkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgb25Db25uZWN0aW9uUXVhbGl0eUNoYW5nZWQpIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy5jaGlsZFRyYWNrZXJzID0gY29uZmlncy5tYXAoZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgdmFyIGdldFBhcmFtcyA9IF9hLmdldFBhcmFtcywgVHJhY2tlckNsYXNzID0gX2EuVHJhY2tlckNsYXNzO1xuICAgICAgICAgICAgICAgIHJldHVybiAoe1xuICAgICAgICAgICAgICAgICAgICB0cmFja2VyOiBuZXcgVHJhY2tlckNsYXNzKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmhhbmRsZVN0YXRzQ2hhbmdlZCgpOyB9KSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0UGFyYW1zOiBnZXRQYXJhbXMsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICBDb21iaW5lZFF1YWxpdHlJbmRpY2F0b3IucHJvdG90eXBlLmNhbGN1bGF0ZUNvbm5lY3Rpb25RdWFsaXR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvbm5lY3Rpb25RdWFsaXRpZXMgPSB0aGlzLmNoaWxkVHJhY2tlcnMubWFwKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHZhciB0cmFja2VyID0gX2EudHJhY2tlcjtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhY2tlci5jb25uZWN0aW9uUXVhbGl0eTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb25RdWFsaXRpZXMuc29tZShmdW5jdGlvbiAocXVhbGl0eSkgeyByZXR1cm4gcXVhbGl0eSA9PT0gQ29ubmVjdGlvblF1YWxpdHkuQkFEOyB9KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBDb25uZWN0aW9uUXVhbGl0eS5CQUQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29ubmVjdGlvblF1YWxpdGllcy5ldmVyeShmdW5jdGlvbiAocXVhbGl0eSkgeyByZXR1cm4gcXVhbGl0eSA9PT0gQ29ubmVjdGlvblF1YWxpdHkuVU5LTk9XTjsgfSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29ubmVjdGlvblF1YWxpdHkuVU5LTk9XTjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBDb25uZWN0aW9uUXVhbGl0eS5HT09EO1xuICAgICAgICB9O1xuICAgICAgICBDb21iaW5lZFF1YWxpdHlJbmRpY2F0b3IucHJvdG90eXBlLl9zdGFydCA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRUcmFja2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHZhciB0cmFja2VyID0gX2EudHJhY2tlciwgZ2V0UGFyYW1zID0gX2EuZ2V0UGFyYW1zO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cmFja2VyLnN0YXJ0KGdldFBhcmFtcyhwYXJhbXMpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBDb21iaW5lZFF1YWxpdHlJbmRpY2F0b3IucHJvdG90eXBlLl9zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5jaGlsZFRyYWNrZXJzLmZvckVhY2goZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRyYWNrZXIgPSBfYS50cmFja2VyO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cmFja2VyLnN0b3AodHJ1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIENvbWJpbmVkUXVhbGl0eUluZGljYXRvcjtcbiAgICB9KEFic3RyYWN0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IpKTtcbiAgICByZXR1cm4gQ29tYmluZWRRdWFsaXR5SW5kaWNhdG9yO1xufVxuXG52YXIgTGl2ZUtpdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhMaXZlS2l0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTGl2ZUtpdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMucm9vbSA9IG51bGw7XG4gICAgICAgIF90aGlzLmxpdmVLaXRDb25uZWN0aW9uUXVhbGl0eSA9IENvbm5lY3Rpb25RdWFsaXR5JDEuVW5rbm93bjtcbiAgICAgICAgX3RoaXMubGl2ZUtpdENvbm5lY3Rpb25TdGF0ZSA9IG51bGw7XG4gICAgICAgIF90aGlzLmhhbmRsZUNvbm5lY3Rpb25RdWFsaXR5Q2hhbmdlZCA9IGZ1bmN0aW9uIChxdWFsaXR5KSB7XG4gICAgICAgICAgICBfdGhpcy5saXZlS2l0Q29ubmVjdGlvblF1YWxpdHkgPSBxdWFsaXR5O1xuICAgICAgICAgICAgX3RoaXMuaGFuZGxlU3RhdHNDaGFuZ2VkKCk7XG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLmhhbmRsZUNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIF90aGlzLmxpdmVLaXRDb25uZWN0aW9uU3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVN0YXRzQ2hhbmdlZCgpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIExpdmVLaXRDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5wcm90b3R5cGUuX3N0YXJ0ID0gZnVuY3Rpb24gKHJvb20pIHtcbiAgICAgICAgdGhpcy5yb29tID0gcm9vbTtcbiAgICAgICAgdGhpcy5yb29tLmxvY2FsUGFydGljaXBhbnQub24oUGFydGljaXBhbnRFdmVudC5Db25uZWN0aW9uUXVhbGl0eUNoYW5nZWQsIHRoaXMuaGFuZGxlQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkKTtcbiAgICAgICAgdGhpcy5yb29tLm9uKFJvb21FdmVudC5Db25uZWN0aW9uU3RhdGVDaGFuZ2VkLCB0aGlzLmhhbmRsZUNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQpO1xuICAgIH07XG4gICAgTGl2ZUtpdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZS5fc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucm9vbSkge1xuICAgICAgICAgICAgdGhpcy5yb29tLmxvY2FsUGFydGljaXBhbnQub2ZmKFJvb21FdmVudC5Db25uZWN0aW9uUXVhbGl0eUNoYW5nZWQsIHRoaXMuaGFuZGxlQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkKTtcbiAgICAgICAgICAgIHRoaXMucm9vbS5vZmYoUm9vbUV2ZW50LkNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQsIHRoaXMuaGFuZGxlQ29ubmVjdGlvblN0YXRlQ2hhbmdlZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIExpdmVLaXRDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5wcm90b3R5cGUuY2FsY3VsYXRlQ29ubmVjdGlvblF1YWxpdHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChbQ29ubmVjdGlvblF1YWxpdHkkMS5Mb3N0LCBDb25uZWN0aW9uUXVhbGl0eSQxLlBvb3JdLmluY2x1ZGVzKHRoaXMubGl2ZUtpdENvbm5lY3Rpb25RdWFsaXR5KSkge1xuICAgICAgICAgICAgcmV0dXJuIENvbm5lY3Rpb25RdWFsaXR5LkJBRDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5saXZlS2l0Q29ubmVjdGlvblN0YXRlICYmXG4gICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgQ29ubmVjdGlvblN0YXRlLkRpc2Nvbm5lY3RlZCxcbiAgICAgICAgICAgICAgICBDb25uZWN0aW9uU3RhdGUuUmVjb25uZWN0aW5nLFxuICAgICAgICAgICAgICAgIENvbm5lY3Rpb25TdGF0ZS5TaWduYWxSZWNvbm5lY3RpbmcsXG4gICAgICAgICAgICBdLmluY2x1ZGVzKHRoaXMubGl2ZUtpdENvbm5lY3Rpb25TdGF0ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBDb25uZWN0aW9uUXVhbGl0eS5CQUQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbm5lY3Rpb25RdWFsaXR5LkdPT0Q7XG4gICAgfTtcbiAgICByZXR1cm4gTGl2ZUtpdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yO1xufShBYnN0cmFjdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yKSk7XG5cbnZhciB0LGUscyxuO2Z1bmN0aW9uIHIoKXt9ZnVuY3Rpb24gbygpe28uaW5pdC5jYWxsKHRoaXMpO31mdW5jdGlvbiBpKHQpe3JldHVybiB2b2lkIDA9PT10Ll9tYXhMaXN0ZW5lcnM/by5kZWZhdWx0TWF4TGlzdGVuZXJzOnQuX21heExpc3RlbmVyc31mdW5jdGlvbiBhKHQsZSxzKXtpZihlKXQuY2FsbChzKTtlbHNlIGZvcih2YXIgbj10Lmxlbmd0aCxyPW0odCxuKSxvPTA7bzxuOysrbylyW29dLmNhbGwocyk7fWZ1bmN0aW9uIGModCxlLHMsbil7aWYoZSl0LmNhbGwocyxuKTtlbHNlIGZvcih2YXIgcj10Lmxlbmd0aCxvPW0odCxyKSxpPTA7aTxyOysraSlvW2ldLmNhbGwocyxuKTt9ZnVuY3Rpb24gZCh0LGUscyxuLHIpe2lmKGUpdC5jYWxsKHMsbixyKTtlbHNlIGZvcih2YXIgbz10Lmxlbmd0aCxpPW0odCxvKSxhPTA7YTxvOysrYSlpW2FdLmNhbGwocyxuLHIpO31mdW5jdGlvbiB1KHQsZSxzLG4scixvKXtpZihlKXQuY2FsbChzLG4scixvKTtlbHNlIGZvcih2YXIgaT10Lmxlbmd0aCxhPW0odCxpKSxjPTA7YzxpOysrYylhW2NdLmNhbGwocyxuLHIsbyk7fWZ1bmN0aW9uIGgodCxlLHMsbil7aWYoZSl0LmFwcGx5KHMsbik7ZWxzZSBmb3IodmFyIHI9dC5sZW5ndGgsbz1tKHQsciksaT0wO2k8cjsrK2kpb1tpXS5hcHBseShzLG4pO31mdW5jdGlvbiBsKHQsZSxzLG4pe3ZhciBvLGEsYyxkO2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIHMpdGhyb3cgbmV3IFR5cGVFcnJvcignXCJsaXN0ZW5lclwiIGFyZ3VtZW50IG11c3QgYmUgYSBmdW5jdGlvbicpO2lmKChhPXQuX2V2ZW50cyk/KGEubmV3TGlzdGVuZXImJih0LmVtaXQoXCJuZXdMaXN0ZW5lclwiLGUscy5saXN0ZW5lcj9zLmxpc3RlbmVyOnMpLGE9dC5fZXZlbnRzKSxjPWFbZV0pOihhPXQuX2V2ZW50cz1uZXcgcix0Ll9ldmVudHNDb3VudD0wKSxjKXtpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBjP2M9YVtlXT1uP1tzLGNdOltjLHNdOm4/Yy51bnNoaWZ0KHMpOmMucHVzaChzKSwhYy53YXJuZWQmJihvPWkodCkpJiZvPjAmJmMubGVuZ3RoPm8pe2Mud2FybmVkPSEwO3ZhciB1PW5ldyBFcnJvcihcIlBvc3NpYmxlIEV2ZW50RW1pdHRlciBtZW1vcnkgbGVhayBkZXRlY3RlZC4gXCIrYy5sZW5ndGgrXCIgXCIrZStcIiBsaXN0ZW5lcnMgYWRkZWQuIFVzZSBlbWl0dGVyLnNldE1heExpc3RlbmVycygpIHRvIGluY3JlYXNlIGxpbWl0XCIpO3UubmFtZT1cIk1heExpc3RlbmVyc0V4Y2VlZGVkV2FybmluZ1wiLHUuZW1pdHRlcj10LHUudHlwZT1lLHUuY291bnQ9Yy5sZW5ndGgsZD11LFwiZnVuY3Rpb25cIj09dHlwZW9mIGNvbnNvbGUud2Fybj9jb25zb2xlLndhcm4oZCk6Y29uc29sZS5sb2coZCk7fX1lbHNlIGM9YVtlXT1zLCsrdC5fZXZlbnRzQ291bnQ7cmV0dXJuIHR9ZnVuY3Rpb24gcCh0LGUscyl7dmFyIG49ITE7ZnVuY3Rpb24gcigpe3QucmVtb3ZlTGlzdGVuZXIoZSxyKSxufHwobj0hMCxzLmFwcGx5KHQsYXJndW1lbnRzKSk7fXJldHVybiByLmxpc3RlbmVyPXMscn1mdW5jdGlvbiBmKHQpe3ZhciBlPXRoaXMuX2V2ZW50cztpZihlKXt2YXIgcz1lW3RdO2lmKFwiZnVuY3Rpb25cIj09dHlwZW9mIHMpcmV0dXJuIDE7aWYocylyZXR1cm4gcy5sZW5ndGh9cmV0dXJuIDB9ZnVuY3Rpb24gbSh0LGUpe2Zvcih2YXIgcz1uZXcgQXJyYXkoZSk7ZS0tOylzW2VdPXRbZV07cmV0dXJuIHN9ci5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShudWxsKSxvLkV2ZW50RW1pdHRlcj1vLG8udXNpbmdEb21haW5zPSExLG8ucHJvdG90eXBlLmRvbWFpbj12b2lkIDAsby5wcm90b3R5cGUuX2V2ZW50cz12b2lkIDAsby5wcm90b3R5cGUuX21heExpc3RlbmVycz12b2lkIDAsby5kZWZhdWx0TWF4TGlzdGVuZXJzPTEwLG8uaW5pdD1mdW5jdGlvbigpe3RoaXMuZG9tYWluPW51bGwsby51c2luZ0RvbWFpbnMmJnVuZGVmaW5lZC5hY3RpdmUsdGhpcy5fZXZlbnRzJiZ0aGlzLl9ldmVudHMhPT1PYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykuX2V2ZW50c3x8KHRoaXMuX2V2ZW50cz1uZXcgcix0aGlzLl9ldmVudHNDb3VudD0wKSx0aGlzLl9tYXhMaXN0ZW5lcnM9dGhpcy5fbWF4TGlzdGVuZXJzfHx2b2lkIDA7fSxvLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnM9ZnVuY3Rpb24odCl7aWYoXCJudW1iZXJcIiE9dHlwZW9mIHR8fHQ8MHx8aXNOYU4odCkpdGhyb3cgbmV3IFR5cGVFcnJvcignXCJuXCIgYXJndW1lbnQgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpO3JldHVybiB0aGlzLl9tYXhMaXN0ZW5lcnM9dCx0aGlzfSxvLnByb3RvdHlwZS5nZXRNYXhMaXN0ZW5lcnM9ZnVuY3Rpb24oKXtyZXR1cm4gaSh0aGlzKX0sby5wcm90b3R5cGUuZW1pdD1mdW5jdGlvbih0KXt2YXIgZSxzLG4scixvLGksbCxwPVwiZXJyb3JcIj09PXQ7aWYoaT10aGlzLl9ldmVudHMpcD1wJiZudWxsPT1pLmVycm9yO2Vsc2UgaWYoIXApcmV0dXJuICExO2lmKGw9dGhpcy5kb21haW4scCl7aWYoZT1hcmd1bWVudHNbMV0sIWwpe2lmKGUgaW5zdGFuY2VvZiBFcnJvcil0aHJvdyBlO3ZhciBmPW5ldyBFcnJvcignVW5jYXVnaHQsIHVuc3BlY2lmaWVkIFwiZXJyb3JcIiBldmVudC4gKCcrZStcIilcIik7dGhyb3cgZi5jb250ZXh0PWUsZn1yZXR1cm4gZXx8KGU9bmV3IEVycm9yKCdVbmNhdWdodCwgdW5zcGVjaWZpZWQgXCJlcnJvclwiIGV2ZW50JykpLGUuZG9tYWluRW1pdHRlcj10aGlzLGUuZG9tYWluPWwsZS5kb21haW5UaHJvd249ITEsbC5lbWl0KFwiZXJyb3JcIixlKSwhMX1pZighKHM9aVt0XSkpcmV0dXJuICExO3ZhciBtPVwiZnVuY3Rpb25cIj09dHlwZW9mIHM7c3dpdGNoKG49YXJndW1lbnRzLmxlbmd0aCl7Y2FzZSAxOmEocyxtLHRoaXMpO2JyZWFrO2Nhc2UgMjpjKHMsbSx0aGlzLGFyZ3VtZW50c1sxXSk7YnJlYWs7Y2FzZSAzOmQocyxtLHRoaXMsYXJndW1lbnRzWzFdLGFyZ3VtZW50c1syXSk7YnJlYWs7Y2FzZSA0OnUocyxtLHRoaXMsYXJndW1lbnRzWzFdLGFyZ3VtZW50c1syXSxhcmd1bWVudHNbM10pO2JyZWFrO2RlZmF1bHQ6Zm9yKHI9bmV3IEFycmF5KG4tMSksbz0xO288bjtvKyspcltvLTFdPWFyZ3VtZW50c1tvXTtoKHMsbSx0aGlzLHIpO31yZXR1cm4gITB9LG8ucHJvdG90eXBlLmFkZExpc3RlbmVyPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIGwodGhpcyx0LGUsITEpfSxvLnByb3RvdHlwZS5vbj1vLnByb3RvdHlwZS5hZGRMaXN0ZW5lcixvLnByb3RvdHlwZS5wcmVwZW5kTGlzdGVuZXI9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbCh0aGlzLHQsZSwhMCl9LG8ucHJvdG90eXBlLm9uY2U9ZnVuY3Rpb24odCxlKXtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBlKXRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtyZXR1cm4gdGhpcy5vbih0LHAodGhpcyx0LGUpKSx0aGlzfSxvLnByb3RvdHlwZS5wcmVwZW5kT25jZUxpc3RlbmVyPWZ1bmN0aW9uKHQsZSl7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7cmV0dXJuIHRoaXMucHJlcGVuZExpc3RlbmVyKHQscCh0aGlzLHQsZSkpLHRoaXN9LG8ucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyPWZ1bmN0aW9uKHQsZSl7dmFyIHMsbixvLGksYTtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBlKXRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtpZighKG49dGhpcy5fZXZlbnRzKSlyZXR1cm4gdGhpcztpZighKHM9blt0XSkpcmV0dXJuIHRoaXM7aWYocz09PWV8fHMubGlzdGVuZXImJnMubGlzdGVuZXI9PT1lKTA9PS0tdGhpcy5fZXZlbnRzQ291bnQ/dGhpcy5fZXZlbnRzPW5ldyByOihkZWxldGUgblt0XSxuLnJlbW92ZUxpc3RlbmVyJiZ0aGlzLmVtaXQoXCJyZW1vdmVMaXN0ZW5lclwiLHQscy5saXN0ZW5lcnx8ZSkpO2Vsc2UgaWYoXCJmdW5jdGlvblwiIT10eXBlb2Ygcyl7Zm9yKG89LTEsaT1zLmxlbmd0aDtpLS0gPjA7KWlmKHNbaV09PT1lfHxzW2ldLmxpc3RlbmVyJiZzW2ldLmxpc3RlbmVyPT09ZSl7YT1zW2ldLmxpc3RlbmVyLG89aTticmVha31pZihvPDApcmV0dXJuIHRoaXM7aWYoMT09PXMubGVuZ3RoKXtpZihzWzBdPXZvaWQgMCwwPT0tLXRoaXMuX2V2ZW50c0NvdW50KXJldHVybiB0aGlzLl9ldmVudHM9bmV3IHIsdGhpcztkZWxldGUgblt0XTt9ZWxzZSAhZnVuY3Rpb24odCxlKXtmb3IodmFyIHM9ZSxuPXMrMSxyPXQubGVuZ3RoO248cjtzKz0xLG4rPTEpdFtzXT10W25dO3QucG9wKCk7fShzLG8pO24ucmVtb3ZlTGlzdGVuZXImJnRoaXMuZW1pdChcInJlbW92ZUxpc3RlbmVyXCIsdCxhfHxlKTt9cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLm9mZj1mdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnJlbW92ZUxpc3RlbmVyKHQsZSl9LG8ucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycz1mdW5jdGlvbih0KXt2YXIgZSxzO2lmKCEocz10aGlzLl9ldmVudHMpKXJldHVybiB0aGlzO2lmKCFzLnJlbW92ZUxpc3RlbmVyKXJldHVybiAwPT09YXJndW1lbnRzLmxlbmd0aD8odGhpcy5fZXZlbnRzPW5ldyByLHRoaXMuX2V2ZW50c0NvdW50PTApOnNbdF0mJigwPT0tLXRoaXMuX2V2ZW50c0NvdW50P3RoaXMuX2V2ZW50cz1uZXcgcjpkZWxldGUgc1t0XSksdGhpcztpZigwPT09YXJndW1lbnRzLmxlbmd0aCl7Zm9yKHZhciBuLG89T2JqZWN0LmtleXMocyksaT0wO2k8by5sZW5ndGg7KytpKVwicmVtb3ZlTGlzdGVuZXJcIiE9PShuPW9baV0pJiZ0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhuKTtyZXR1cm4gdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoXCJyZW1vdmVMaXN0ZW5lclwiKSx0aGlzLl9ldmVudHM9bmV3IHIsdGhpcy5fZXZlbnRzQ291bnQ9MCx0aGlzfWlmKFwiZnVuY3Rpb25cIj09dHlwZW9mKGU9c1t0XSkpdGhpcy5yZW1vdmVMaXN0ZW5lcih0LGUpO2Vsc2UgaWYoZSlkb3t0aGlzLnJlbW92ZUxpc3RlbmVyKHQsZVtlLmxlbmd0aC0xXSk7fXdoaWxlKGVbMF0pO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5saXN0ZW5lcnM9ZnVuY3Rpb24odCl7dmFyIGUscz10aGlzLl9ldmVudHM7cmV0dXJuIHMmJihlPXNbdF0pP1wiZnVuY3Rpb25cIj09dHlwZW9mIGU/W2UubGlzdGVuZXJ8fGVdOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1uZXcgQXJyYXkodC5sZW5ndGgpLHM9MDtzPGUubGVuZ3RoOysrcyllW3NdPXRbc10ubGlzdGVuZXJ8fHRbc107cmV0dXJuIGV9KGUpOltdfSxvLmxpc3RlbmVyQ291bnQ9ZnVuY3Rpb24odCxlKXtyZXR1cm4gXCJmdW5jdGlvblwiPT10eXBlb2YgdC5saXN0ZW5lckNvdW50P3QubGlzdGVuZXJDb3VudChlKTpmLmNhbGwodCxlKX0sby5wcm90b3R5cGUubGlzdGVuZXJDb3VudD1mLG8ucHJvdG90eXBlLmV2ZW50TmFtZXM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZXZlbnRzQ291bnQ+MD9SZWZsZWN0Lm93bktleXModGhpcy5fZXZlbnRzKTpbXX07Y2xhc3MgZyBleHRlbmRzIG97fSFmdW5jdGlvbih0KXt0Lklzc3VlPVwiaXNzdWVcIix0Lk5ldHdvcmtTY29yZXNVcGRhdGVkPVwibmV0d29yay1zY29yZXMtdXBkYXRlZFwiLHQuU3RhdHNQYXJzaW5nRmluaXNoZWQ9XCJzdGF0cy1wYXJzaW5nLWZpbmlzaGVkXCI7fSh0fHwodD17fSkpLGZ1bmN0aW9uKHQpe3QuTmV0d29yaz1cIm5ldHdvcmtcIix0LkNQVT1cImNwdVwiLHQuU2VydmVyPVwic2VydmVyXCIsdC5TdHJlYW09XCJzdHJlYW1cIjt9KGV8fChlPXt9KSksZnVuY3Rpb24odCl7dC5PdXRib3VuZE5ldHdvcmtRdWFsaXR5PVwib3V0Ym91bmQtbmV0d29yay1xdWFsaXR5XCIsdC5JbmJvdW5kTmV0d29ya1F1YWxpdHk9XCJpbmJvdW5kLW5ldHdvcmstcXVhbGl0eVwiLHQuT3V0Ym91bmROZXR3b3JrTWVkaWFMYXRlbmN5PVwib3V0Ym91bmQtbmV0d29yay1tZWRpYS1sYXRlbmN5XCIsdC5JbmJvdW5kTmV0d29ya01lZGlhTGF0ZW5jeT1cImluYm91bmQtbmV0d29yay1tZWRpYS1sYXRlbmN5XCIsdC5OZXR3b3JrTWVkaWFTeW5jRmFpbHVyZT1cIm5ldHdvcmstbWVkaWEtc3luYy1mYWlsdXJlXCIsdC5PdXRib3VuZE5ldHdvcmtUaHJvdWdocHV0PVwib3V0Ym91bmQtbmV0d29yay10aHJvdWdocHV0XCIsdC5JbmJvdW5kTmV0d29ya1Rocm91Z2hwdXQ9XCJpbmJvdW5kLW5ldHdvcmstdGhyb3VnaHB1dFwiLHQuRW5jb2RlckNQVVRocm90dGxpbmc9XCJlbmNvZGVyLWNwdS10aHJvdHRsaW5nXCIsdC5EZWNvZGVyQ1BVVGhyb3R0bGluZz1cImRlY29kZXItY3B1LXRocm90dGxpbmdcIix0LlNlcnZlcklzc3VlPVwic2VydmVyLWlzc3VlXCIsdC5Vbmtub3duVmlkZW9EZWNvZGVySXNzdWU9XCJ1bmtub3duLXZpZGVvLWRlY29kZXJcIix0Lkxvd0luYm91bmRNT1M9XCJsb3ctaW5ib3VuZC1tZWFuLW9waW5pb24tc2NvcmVcIix0Lkxvd091dGJvdW5kTU9TPVwibG93LW91dGJvdW5kLW1lYW4tb3Bpbmlvbi1zY29yZVwiLHQuRnJvemVuVmlkZW9UcmFjaz1cImZyb3plbi12aWRlby10cmFja1wiLHQuTWlzc2luZ1ZpZGVvU3RyZWFtRGF0YT1cIm1pc3NpbmctdmlkZW8tc3RyZWFtLWRhdGFcIix0Lk1pc3NpbmdBdWRpb1N0cmVhbURhdGE9XCJtaXNzaW5nLWF1ZGlvLXN0cmVhbS1kYXRhXCI7fShzfHwocz17fSkpLGZ1bmN0aW9uKHQpe3RbdC5CQUQ9Mi4xXT1cIkJBRFwiLHRbdC5QT09SPTIuNl09XCJQT09SXCIsdFt0LkZBSVI9My4xXT1cIkZBSVJcIix0W3QuR09PRD0zLjhdPVwiR09PRFwiLHRbdC5FWENFTExFTlQ9NC4zXT1cIkVYQ0VMTEVOVFwiO30obnx8KG49e30pKTtjbGFzcyBTIGV4dGVuZHMgb3tzdGF0aWMgU1RBVFNfUkVQT1JUX1JFQURZX0VWRU5UPVwic3RhdHMtcmVwb3J0LXJlYWR5XCI7c3RhdGljIFNUQVRTX1JFUE9SVFNfUEFSU0VEPVwic3RhdHMtcmVwb3J0cy1wYXJzZWRcIjtpc1N0b3BwZWQ9ITE7cmVwb3J0VGltZXI7Z2V0U3RhdHNJbnRlcnZhbDtjb21wb3NpdGVTdGF0c1BhcnNlcjtjb25zdHJ1Y3Rvcih0KXtzdXBlcigpLHRoaXMuY29tcG9zaXRlU3RhdHNQYXJzZXI9dC5jb21wb3NpdGVTdGF0c1BhcnNlcix0aGlzLmdldFN0YXRzSW50ZXJ2YWw9dC5nZXRTdGF0c0ludGVydmFsPz8xZTQ7fWdldCBpc1J1bm5pbmcoKXtyZXR1cm4gISF0aGlzLnJlcG9ydFRpbWVyJiYhdGhpcy5pc1N0b3BwZWR9c3RhcnRSZXBvcnRpbmcoKXtpZih0aGlzLnJlcG9ydFRpbWVyKXJldHVybjtjb25zdCB0PSgpPT5zZXRUaW1lb3V0KCgoKT0+e3RoaXMuaXNTdG9wcGVkP3RoaXMucmVwb3J0VGltZXI9dm9pZCAwOnRoaXMucGFyc2VSZXBvcnRzKCkuZmluYWxseSgoKCk9Pnt0aGlzLnJlcG9ydFRpbWVyPXQoKTt9KSk7fSksdGhpcy5nZXRTdGF0c0ludGVydmFsKTt0aGlzLmlzU3RvcHBlZD0hMSx0aGlzLnJlcG9ydFRpbWVyPXQoKTt9c3RvcFJlcG9ydGluZygpe3RoaXMuaXNTdG9wcGVkPSEwLHRoaXMucmVwb3J0VGltZXImJihjbGVhclRpbWVvdXQodGhpcy5yZXBvcnRUaW1lciksdGhpcy5yZXBvcnRUaW1lcj12b2lkIDApO31hc3luYyBwYXJzZVJlcG9ydHMoKXtjb25zdCB0PURhdGUubm93KCksZT1hd2FpdCB0aGlzLmNvbXBvc2l0ZVN0YXRzUGFyc2VyLnBhcnNlKCkscz1EYXRlLm5vdygpLXQ7dGhpcy5lbWl0KFMuU1RBVFNfUkVQT1JUU19QQVJTRUQse3RpbWVUYWtlbjpzLHJlcG9ydEl0ZW1zOmV9KSxlLmZvckVhY2goKHQ9Pnt0aGlzLmVtaXQoUy5TVEFUU19SRVBPUlRfUkVBRFlfRVZFTlQsdCk7fSkpO319Y29uc3Qgdj0oKCk9Pntjb25zdCB0PW5ldyBNYXA7cmV0dXJuIGU9Pntjb25zdHt0YXNrSWQ6cyxkZWxheU1zOm4sbWF4Sml0dGVyTXM6cixjYWxsYmFjazpvfT1lLGk9TWF0aC5jZWlsKE1hdGgucmFuZG9tKCkqKHJ8fDApKSxhPXQuZ2V0KHMpO2EmJmNsZWFyVGltZW91dChhKTtjb25zdCBjPXNldFRpbWVvdXQoKCgpPT57bygpLHQuZGVsZXRlKHMpO30pLG4raSk7dC5zZXQocyxjKTt9fSkoKTtjbGFzcyBreyN0PXt9O2NhbGN1bGF0ZSh0KXtjb25zdHtjb25uZWN0aW9uOntpZDplfX09dCx7bW9zOnMsc3RhdHM6bn09dGhpcy5jYWxjdWxhdGVPdXRib3VuZFNjb3JlKHQpfHx7fSx7bW9zOnIsc3RhdHM6b309dGhpcy5jYWxjdWxhdGVJbmJvdW5kU2NvcmUodCl8fHt9O3JldHVybiB0aGlzLiN0W2VdPXQsdih7dGFza0lkOmUsZGVsYXlNczozNWUzLGNhbGxiYWNrOigpPT5kZWxldGUgdGhpcy4jdFtlXX0pLHtvdXRib3VuZDpzLGluYm91bmQ6cixjb25uZWN0aW9uSWQ6ZSxzdGF0c1NhbXBsZXM6e2luYm91bmRTdGF0c1NhbXBsZTpvLG91dGJvdW5kU3RhdHNTYW1wbGU6bn19fWNhbGN1bGF0ZU91dGJvdW5kU2NvcmUodCl7Y29uc3QgZT1bLi4udC5yZW1vdGU/LmF1ZGlvLmluYm91bmR8fFtdLC4uLnQucmVtb3RlPy52aWRlby5pbmJvdW5kfHxbXV07aWYoIWUubGVuZ3RoKXJldHVybjtjb25zdCBzPXRoaXMuI3RbdC5jb25uZWN0aW9uLmlkXTtpZighcylyZXR1cm47Y29uc3Qgbj1bLi4ucy5yZW1vdGU/LmF1ZGlvLmluYm91bmR8fFtdLC4uLnMucmVtb3RlPy52aWRlby5pbmJvdW5kfHxbXV0se3BhY2tldHNTZW50OnJ9PXQuY29ubmVjdGlvbixvPXMuY29ubmVjdGlvbi5wYWNrZXRzU2VudCxpPWUucmVkdWNlKCgodCxlKT0+e2NvbnN0IHM9bi5maW5kKCh0PT50LnNzcmM9PT1lLnNzcmMpKTtyZXR1cm4ge3N1bUppdHRlcjp0LnN1bUppdHRlcitlLmppdHRlcixwYWNrZXRzTG9zdDp0LnBhY2tldHNMb3N0K2UucGFja2V0c0xvc3QsbGFzdFBhY2tldHNMb3N0OnQubGFzdFBhY2tldHNMb3N0KyhzPy5wYWNrZXRzTG9zdHx8MCl9fSkse3N1bUppdHRlcjowLHBhY2tldHNMb3N0OjAsbGFzdFBhY2tldHNMb3N0OjB9KSxhPTFlMyp0LmNvbm5lY3Rpb24uY3VycmVudFJvdW5kVHJpcFRpbWV8fDAse3N1bUppdHRlcjpjfT1pLGQ9Yy9lLmxlbmd0aCx1PXItbyxoPWkucGFja2V0c0xvc3QtaS5sYXN0UGFja2V0c0xvc3QsbD11JiZoP01hdGgucm91bmQoMTAwKmgvKHUraCkpOjA7cmV0dXJuIHttb3M6dGhpcy5jYWxjdWxhdGVNT1Moe2F2Z0ppdHRlcjpkLHJ0dDphLHBhY2tldHNMb3NzOmx9KSxzdGF0czp7YXZnSml0dGVyOmQscnR0OmEscGFja2V0c0xvc3M6bH19fWNhbGN1bGF0ZUluYm91bmRTY29yZSh0KXtjb25zdCBlPVsuLi50LmF1ZGlvPy5pbmJvdW5kLC4uLnQudmlkZW8/LmluYm91bmRdO2lmKCFlLmxlbmd0aClyZXR1cm47Y29uc3Qgcz10aGlzLiN0W3QuY29ubmVjdGlvbi5pZF07aWYoIXMpcmV0dXJuO2NvbnN0IG49Wy4uLnMudmlkZW8/LmluYm91bmQsLi4ucy5hdWRpbz8uaW5ib3VuZF0se3BhY2tldHNSZWNlaXZlZDpyfT10LmNvbm5lY3Rpb24sbz1zLmNvbm5lY3Rpb24ucGFja2V0c1JlY2VpdmVkLGk9ZS5yZWR1Y2UoKCh0LGUpPT57Y29uc3Qgcz1uLmZpbmQoKHQ9PnQuc3NyYz09PWUuc3NyYykpO3JldHVybiB7c3VtSml0dGVyOnQuc3VtSml0dGVyK2Uuaml0dGVyLHBhY2tldHNMb3N0OnQucGFja2V0c0xvc3QrZS5wYWNrZXRzTG9zdCxsYXN0UGFja2V0c0xvc3Q6dC5sYXN0UGFja2V0c0xvc3QrKHM/LnBhY2tldHNMb3N0fHwwKX19KSx7c3VtSml0dGVyOjAscGFja2V0c0xvc3Q6MCxsYXN0UGFja2V0c0xvc3Q6MH0pLGE9MWUzKnQuY29ubmVjdGlvbi5jdXJyZW50Um91bmRUcmlwVGltZXx8MCx7c3VtSml0dGVyOmN9PWksZD1jL2UubGVuZ3RoLHU9ci1vLGg9aS5wYWNrZXRzTG9zdC1pLmxhc3RQYWNrZXRzTG9zdCxsPXUmJmg/TWF0aC5yb3VuZCgxMDAqaC8odStoKSk6MDtyZXR1cm4ge21vczp0aGlzLmNhbGN1bGF0ZU1PUyh7YXZnSml0dGVyOmQscnR0OmEscGFja2V0c0xvc3M6bH0pLHN0YXRzOnthdmdKaXR0ZXI6ZCxydHQ6YSxwYWNrZXRzTG9zczpsfX19Y2FsY3VsYXRlTU9TKHthdmdKaXR0ZXI6dCxydHQ6ZSxwYWNrZXRzTG9zczpzfSl7Y29uc3Qgbj1lKzIqdCsxMDtsZXQgcj1uPDE2MD85My4yLW4vNDA6OTMuMi1uLzEyMC0xMDtyZXR1cm4gci09Mi41KnMsMSsuMDM1KnIrN2UtNipyKihyLTYwKSooMTAwLXIpfX1jbGFzcyB5eyNlPW5ldyBNYXA7I3M7I247Y29uc3RydWN0b3IodD17fSl7dGhpcy4jcz10LnN0YXRzQ2xlYW51cFR0bE1zPz8zNWUzLHRoaXMuI249dC5tYXhQYXJzZWRTdGF0c1N0b3JhZ2VTaXplPz81O31kZXRlY3QodCxlKXtjb25zdCBzPXsuLi50LG5ldHdvcmtTY29yZXM6ey4uLmUsc3RhdHNTYW1wbGVzOmU/LnN0YXRzU2FtcGxlc3x8e319fSxuPXRoaXMucGVyZm9ybURldGVjdGlvbihzKTtyZXR1cm4gdGhpcy5zZXRMYXN0UHJvY2Vzc2VkU3RhdHModC5jb25uZWN0aW9uLmlkLHMpLHRoaXMucGVyZm9ybVByZXZTdGF0c0NsZWFudXAoe2Nvbm5lY3Rpb25JZDp0LmNvbm5lY3Rpb24uaWR9KSxufXBlcmZvcm1QcmV2U3RhdHNDbGVhbnVwKHQpe2NvbnN0e2Nvbm5lY3Rpb25JZDplLGNsZWFudXBDYWxsYmFjazpzfT10O3RoaXMuI2UuaGFzKGUpJiZ2KHt0YXNrSWQ6ZSxkZWxheU1zOnRoaXMuI3MsY2FsbGJhY2s6KCk9Pnt0aGlzLmRlbGV0ZUxhc3RQcm9jZXNzZWRTdGF0cyhlKSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBzJiZzKCk7fX0pO31zZXRMYXN0UHJvY2Vzc2VkU3RhdHModCxlKXtpZighdHx8ZS5jb25uZWN0aW9uLmlkIT09dClyZXR1cm47Y29uc3Qgcz10aGlzLiNlLmdldCh0KT8/W107cy5wdXNoKGUpLHMubGVuZ3RoPnRoaXMuI24mJnMuc2hpZnQoKSx0aGlzLiNlLnNldCh0LHMpO31nZXRMYXN0UHJvY2Vzc2VkU3RhdHModCl7Y29uc3QgZT10aGlzLiNlLmdldCh0KTtyZXR1cm4gZT8uW2UubGVuZ3RoLTFdfWdldEFsbExhc3RQcm9jZXNzZWRTdGF0cyh0KXtyZXR1cm4gdGhpcy4jZS5nZXQodCk/P1tdfWRlbGV0ZUxhc3RQcm9jZXNzZWRTdGF0cyh0KXt0aGlzLiNlLmRlbGV0ZSh0KTt9fWNsYXNzIHcgZXh0ZW5kcyB5eyNyO2NvbnN0cnVjdG9yKHQ9e30pe3N1cGVyKHQpLHRoaXMuI3I9dC5hdmFpbGFibGVPdXRnb2luZ0JpdHJhdGVUaHJlc2hvbGQ/PzFlNTt9cGVyZm9ybURldGVjdGlvbih0KXtjb25zdCBuPVtdLHthdmFpbGFibGVPdXRnb2luZ0JpdHJhdGU6cn09dC5jb25uZWN0aW9uO2lmKHZvaWQgMD09PXIpcmV0dXJuIG47Y29uc3Qgbz10LmF1ZGlvLm91dGJvdW5kLnJlZHVjZSgoKHQsZSk9PnQrZS50YXJnZXRCaXRyYXRlKSwwKSxpPXQudmlkZW8ub3V0Ym91bmQucmVkdWNlKCgodCxlKT0+dCtlLmJpdHJhdGUpLDApO2lmKCFvJiYhaSlyZXR1cm4gbjtjb25zdCBhPXthdmFpbGFibGVPdXRnb2luZ0JpdHJhdGU6cix2aWRlb1N0cmVhbXNUb3RhbEJpdHJhdGU6aSxhdWRpb1N0cmVhbXNUb3RhbFRhcmdldEJpdHJhdGU6b307cmV0dXJuIG8+cnx8aT4wJiZyPHRoaXMuI3I/KG4ucHVzaCh7c3RhdHNTYW1wbGU6YSx0eXBlOmUuTmV0d29yayxyZWFzb246cy5PdXRib3VuZE5ldHdvcmtUaHJvdWdocHV0fSksbik6bn19Y2xhc3MgYiBleHRlbmRzIHl7I287I2k7I2E7I2M7Y29uc3RydWN0b3IodD17fSl7c3VwZXIoKSx0aGlzLiNvPXQuaGlnaFBhY2tldExvc3NUaHJlc2hvbGRQY3Q/PzUsdGhpcy4jaT10LmhpZ2hKaXR0ZXJUaHJlc2hvbGQ/PzIwMCx0aGlzLiNhPXQuaGlnaEppdHRlckJ1ZmZlckRlbGF5VGhyZXNob2xkTXM/PzUwMCx0aGlzLiNjPXQuaGlnaFJ0dFRocmVzaG9sZE1zPz8yNTA7fXBlcmZvcm1EZXRlY3Rpb24odCl7cmV0dXJuIHRoaXMucHJvY2Vzc0RhdGEodCl9cHJvY2Vzc0RhdGEodCl7Y29uc3Qgbj1bXSxyPVsuLi50LmF1ZGlvPy5pbmJvdW5kLC4uLnQudmlkZW8/LmluYm91bmRdO2lmKCFyLmxlbmd0aClyZXR1cm4gbjtjb25zdCBvPXRoaXMuZ2V0TGFzdFByb2Nlc3NlZFN0YXRzKHQuY29ubmVjdGlvbi5pZCk7aWYoIW8pcmV0dXJuIG47Y29uc3QgaT1bLi4uby52aWRlbz8uaW5ib3VuZCwuLi5vLmF1ZGlvPy5pbmJvdW5kXSx7cGFja2V0c1JlY2VpdmVkOmF9PXQuY29ubmVjdGlvbixjPW8uY29ubmVjdGlvbi5wYWNrZXRzUmVjZWl2ZWQsZD1yLnJlZHVjZSgoKHQsZSk9Pntjb25zdCBzPWkuZmluZCgodD0+dC5zc3JjPT09ZS5zc3JjKSksbj1zPy5qaXR0ZXJCdWZmZXJEZWxheXx8MCxyPXM/LmppdHRlckJ1ZmZlckVtaXR0ZWRDb3VudHx8MCxvPWUuaml0dGVyQnVmZmVyRGVsYXktbixhPWUuaml0dGVyQnVmZmVyRW1pdHRlZENvdW50LXIsYz1vJiZhPzFlMypvL2E6MDtyZXR1cm4ge3N1bUppdHRlcjp0LnN1bUppdHRlcitlLmppdHRlcixzdW1KaXR0ZXJCdWZmZXJEZWxheU1zOnQuc3VtSml0dGVyQnVmZmVyRGVsYXlNcytjLHBhY2tldHNMb3N0OnQucGFja2V0c0xvc3QrZS5wYWNrZXRzTG9zdCxsYXN0UGFja2V0c0xvc3Q6dC5sYXN0UGFja2V0c0xvc3QrKHM/LnBhY2tldHNMb3N0fHwwKX19KSx7c3VtSml0dGVyOjAsc3VtSml0dGVyQnVmZmVyRGVsYXlNczowLHBhY2tldHNMb3N0OjAsbGFzdFBhY2tldHNMb3N0OjB9KSx1PTFlMyp0LmNvbm5lY3Rpb24uY3VycmVudFJvdW5kVHJpcFRpbWV8fDAse3N1bUppdHRlcjpoLHN1bUppdHRlckJ1ZmZlckRlbGF5TXM6bH09ZCxwPWgvci5sZW5ndGgsZj1sL3IubGVuZ3RoLG09YS1jLGc9ZC5wYWNrZXRzTG9zdC1kLmxhc3RQYWNrZXRzTG9zdCxTPW0mJmc/TWF0aC5yb3VuZCgxMDAqZy8obStnKSk6MCx2PVM+dGhpcy4jbyxrPXA+PXRoaXMuI2kseT11Pj10aGlzLiNjLHc9Zj50aGlzLiNhLGI9eSYmIWsmJiF2LFA9diYmayxUPWsmJncsTD17cnR0OnUscGFja2V0TG9zc1BjdDpTLGF2Z0ppdHRlcjpwLGF2Z0ppdHRlckJ1ZmZlckRlbGF5OmZ9O3JldHVybiAoa3x8dikmJm4ucHVzaCh7c3RhdHNTYW1wbGU6TCx0eXBlOmUuTmV0d29yayxyZWFzb246cy5JbmJvdW5kTmV0d29ya1F1YWxpdHksaWNlQ2FuZGlkYXRlOnQuY29ubmVjdGlvbi5sb2NhbC5pZH0pLGImJm4ucHVzaCh7c3RhdHNTYW1wbGU6TCx0eXBlOmUuU2VydmVyLHJlYXNvbjpzLlNlcnZlcklzc3VlLGljZUNhbmRpZGF0ZTp0LmNvbm5lY3Rpb24ucmVtb3RlLmlkfSksUCYmbi5wdXNoKHtzdGF0c1NhbXBsZTpMLHR5cGU6ZS5OZXR3b3JrLHJlYXNvbjpzLkluYm91bmROZXR3b3JrTWVkaWFMYXRlbmN5LGljZUNhbmRpZGF0ZTp0LmNvbm5lY3Rpb24ubG9jYWwuaWR9KSxUJiZuLnB1c2goe3N0YXRzU2FtcGxlOkwsdHlwZTplLk5ldHdvcmsscmVhc29uOnMuTmV0d29ya01lZGlhU3luY0ZhaWx1cmUsaWNlQ2FuZGlkYXRlOnQuY29ubmVjdGlvbi5sb2NhbC5pZH0pLG59fWNsYXNzIFAgZXh0ZW5kcyB5eyNkO2NvbnN0cnVjdG9yKHQ9e30pe3N1cGVyKCksdGhpcy4jZD10LmNvcnJlY3RlZFNhbXBsZXNUaHJlc2hvbGRQY3Q/PzU7fXBlcmZvcm1EZXRlY3Rpb24odCl7cmV0dXJuIHRoaXMucHJvY2Vzc0RhdGEodCl9cHJvY2Vzc0RhdGEodCl7Y29uc3Qgbj10LmF1ZGlvLmluYm91bmQscj1bXSxvPXRoaXMuZ2V0TGFzdFByb2Nlc3NlZFN0YXRzKHQuY29ubmVjdGlvbi5pZCk/LmF1ZGlvLmluYm91bmQ7cmV0dXJuIG8/KG4uZm9yRWFjaCgodD0+e2NvbnN0IG49by5maW5kKChlPT5lLnNzcmM9PT10LnNzcmMpKTtpZighbilyZXR1cm47Y29uc3QgaT10LnRyYWNrLmluc2VydGVkU2FtcGxlc0ZvckRlY2VsZXJhdGlvbit0LnRyYWNrLnJlbW92ZWRTYW1wbGVzRm9yQWNjZWxlcmF0aW9uLGE9bi50cmFjay5pbnNlcnRlZFNhbXBsZXNGb3JEZWNlbGVyYXRpb24rbi50cmFjay5yZW1vdmVkU2FtcGxlc0ZvckFjY2VsZXJhdGlvbjtpZihpPT09YSlyZXR1cm47Y29uc3QgYz10LnRyYWNrLnRvdGFsU2FtcGxlc1JlY2VpdmVkLW4udHJhY2sudG90YWxTYW1wbGVzUmVjZWl2ZWQsZD1pLWEsdT1NYXRoLnJvdW5kKDEwMCpkL2MpLGg9e2NvcnJlY3RlZFNhbXBsZXNQY3Q6dX07dT50aGlzLiNkJiZyLnB1c2goe3N0YXRzU2FtcGxlOmgsdHlwZTplLk5ldHdvcmsscmVhc29uOnMuTmV0d29ya01lZGlhU3luY0ZhaWx1cmUsc3NyYzp0LnNzcmN9KTt9KSkscik6cn19Y2xhc3MgVCBleHRlbmRzIHl7I287I2k7Y29uc3RydWN0b3IodD17fSl7c3VwZXIoKSx0aGlzLiNvPXQuaGlnaFBhY2tldExvc3NUaHJlc2hvbGRQY3Q/PzUsdGhpcy4jaT10LmhpZ2hKaXR0ZXJUaHJlc2hvbGQ/PzIwMDt9cGVyZm9ybURldGVjdGlvbih0KXtyZXR1cm4gdGhpcy5wcm9jZXNzRGF0YSh0KX1wcm9jZXNzRGF0YSh0KXtjb25zdCBuPVtdLHI9Wy4uLnQucmVtb3RlPy5hdWRpby5pbmJvdW5kfHxbXSwuLi50LnJlbW90ZT8udmlkZW8uaW5ib3VuZHx8W11dO2lmKCFyLmxlbmd0aClyZXR1cm4gbjtjb25zdCBvPXRoaXMuZ2V0TGFzdFByb2Nlc3NlZFN0YXRzKHQuY29ubmVjdGlvbi5pZCk7aWYoIW8pcmV0dXJuIG47Y29uc3QgaT1bLi4uby5yZW1vdGU/LmF1ZGlvLmluYm91bmR8fFtdLC4uLm8ucmVtb3RlPy52aWRlby5pbmJvdW5kfHxbXV0se3BhY2tldHNTZW50OmF9PXQuY29ubmVjdGlvbixjPW8uY29ubmVjdGlvbi5wYWNrZXRzU2VudCxkPXIucmVkdWNlKCgodCxlKT0+e2NvbnN0IHM9aS5maW5kKCh0PT50LnNzcmM9PT1lLnNzcmMpKTtyZXR1cm4ge3N1bUppdHRlcjp0LnN1bUppdHRlcitlLmppdHRlcixwYWNrZXRzTG9zdDp0LnBhY2tldHNMb3N0K2UucGFja2V0c0xvc3QsbGFzdFBhY2tldHNMb3N0OnQubGFzdFBhY2tldHNMb3N0KyhzPy5wYWNrZXRzTG9zdHx8MCl9fSkse3N1bUppdHRlcjowLHBhY2tldHNMb3N0OjAsbGFzdFBhY2tldHNMb3N0OjB9KSx1PTFlMyp0LmNvbm5lY3Rpb24uY3VycmVudFJvdW5kVHJpcFRpbWV8fDAse3N1bUppdHRlcjpofT1kLGw9aC9yLmxlbmd0aCxwPWEtYyxmPWQucGFja2V0c0xvc3QtZC5sYXN0UGFja2V0c0xvc3QsbT1wJiZmP01hdGgucm91bmQoMTAwKmYvKHArZikpOjAsZz1tPnRoaXMuI28sUz1sPj10aGlzLiNpLHY9IWcmJlN8fFN8fGcsaz17cnR0OnUsYXZnSml0dGVyOmwscGFja2V0TG9zc1BjdDptfTtyZXR1cm4gZyYmUyYmbi5wdXNoKHtzdGF0c1NhbXBsZTprLHR5cGU6ZS5OZXR3b3JrLHJlYXNvbjpzLk91dGJvdW5kTmV0d29ya01lZGlhTGF0ZW5jeSxpY2VDYW5kaWRhdGU6dC5jb25uZWN0aW9uLmxvY2FsLmlkfSksdiYmbi5wdXNoKHtzdGF0c1NhbXBsZTprLHR5cGU6ZS5OZXR3b3JrLHJlYXNvbjpzLk91dGJvdW5kTmV0d29ya1F1YWxpdHksaWNlQ2FuZGlkYXRlOnQuY29ubmVjdGlvbi5sb2NhbC5pZH0pLG59fWNsYXNzIEwgZXh0ZW5kcyB5e3BlcmZvcm1EZXRlY3Rpb24odCl7cmV0dXJuIHRoaXMucHJvY2Vzc0RhdGEodCl9cHJvY2Vzc0RhdGEodCl7Y29uc3Qgbj10LnZpZGVvLm91dGJvdW5kLmZpbHRlcigodD0+XCJub25lXCIhPT10LnF1YWxpdHlMaW1pdGF0aW9uUmVhc29uKSkscj1bXSxvPXRoaXMuZ2V0TGFzdFByb2Nlc3NlZFN0YXRzKHQuY29ubmVjdGlvbi5pZCk/LnZpZGVvLm91dGJvdW5kO3JldHVybiBvPyhuLmZvckVhY2goKHQ9Pntjb25zdCBuPW8uZmluZCgoZT0+ZS5zc3JjPT09dC5zc3JjKSk7aWYoIW4pcmV0dXJuO2NvbnN0IGk9e3F1YWxpdHlMaW1pdGF0aW9uUmVhc29uOnQucXVhbGl0eUxpbWl0YXRpb25SZWFzb259O3QuZnJhbWVzU2VudD5uLmZyYW1lc1NlbnR8fChcImNwdVwiPT09dC5xdWFsaXR5TGltaXRhdGlvblJlYXNvbiYmci5wdXNoKHtzdGF0c1NhbXBsZTppLHR5cGU6ZS5DUFUscmVhc29uOnMuRW5jb2RlckNQVVRocm90dGxpbmcsc3NyYzp0LnNzcmN9KSxcImJhbmR3aWR0aFwiPT09dC5xdWFsaXR5TGltaXRhdGlvblJlYXNvbiYmci5wdXNoKHtzdGF0c1NhbXBsZTppLHR5cGU6ZS5OZXR3b3JrLHJlYXNvbjpzLk91dGJvdW5kTmV0d29ya1Rocm91Z2hwdXQsc3NyYzp0LnNzcmN9KSk7fSkpLHIpOnJ9fWNsYXNzIEQgZXh0ZW5kcyB5e1VOS05PV05fREVDT0RFUj1cInVua25vd25cIjsjdT17fTtwZXJmb3JtRGV0ZWN0aW9uKHQpe3JldHVybiB0aGlzLnByb2Nlc3NEYXRhKHQpfXBlcmZvcm1QcmV2U3RhdHNDbGVhbnVwKHQpe2NvbnN0e2Nvbm5lY3Rpb25JZDplLGNsZWFudXBDYWxsYmFjazpzfT10O3N1cGVyLnBlcmZvcm1QcmV2U3RhdHNDbGVhbnVwKHsuLi50LGNsZWFudXBDYWxsYmFjazooKT0+e2RlbGV0ZSB0aGlzLiN1W2VdLFwiZnVuY3Rpb25cIj09dHlwZW9mIHMmJnMoKTt9fSk7fXByb2Nlc3NEYXRhKHQpe2NvbnN0IG49W10se2lkOnJ9PXQuY29ubmVjdGlvbixvPXRoaXMuZ2V0TGFzdFByb2Nlc3NlZFN0YXRzKHIpPy52aWRlby5pbmJvdW5kO3JldHVybiB0LnZpZGVvLmluYm91bmQuZm9yRWFjaCgodD0+e2NvbnN0e2RlY29kZXJJbXBsZW1lbnRhdGlvbjppLHNzcmM6YX09dCxjPW8/LmZpbmQoKHQ9PnQuc3NyYz09PWEpKTtpZihjKWlmKGk9PT10aGlzLlVOS05PV05fREVDT0RFUil7aWYoIXRoaXMuaGFkTGFzdERlY29kZXJXaXRoSXNzdWUocixhKSl7dGhpcy5zZXRMYXN0RGVjb2RlcldpdGhJc3N1ZShyLGEsdGhpcy5VTktOT1dOX0RFQ09ERVIpO2NvbnN0IG89e21pbWVUeXBlOnQubWltZVR5cGUsZGVjb2RlckltcGxlbWVudGF0aW9uOml9O24ucHVzaCh7c3NyYzphLHN0YXRzU2FtcGxlOm8sdHlwZTplLlN0cmVhbSxyZWFzb246cy5Vbmtub3duVmlkZW9EZWNvZGVySXNzdWUsdHJhY2tJZGVudGlmaWVyOnQudHJhY2sudHJhY2tJZGVudGlmaWVyfSk7fX1lbHNlIHRoaXMuc2V0TGFzdERlY29kZXJXaXRoSXNzdWUocixhLHZvaWQgMCk7fSkpLG59c2V0TGFzdERlY29kZXJXaXRoSXNzdWUodCxlLHMpe2NvbnN0IG49dGhpcy4jdVt0XT8/e307dm9pZCAwPT09cz9kZWxldGUgbltlXTpuW2VdPXMsdGhpcy4jdVt0XT1uO31oYWRMYXN0RGVjb2RlcldpdGhJc3N1ZSh0LGUpe2NvbnN0IHM9dGhpcy4jdVt0XTtyZXR1cm4gKHMmJnNbZV0pPT09dGhpcy5VTktOT1dOX0RFQ09ERVJ9fWNvbnN0IEM9dD0+dC5yZWR1Y2UoKCh0LGUpPT50K2UpLDApL3QubGVuZ3RoLFI9KHQsZSxzPTMwKT0+e2NvbnN0IG49W107Zm9yKGxldCBzPTE7czxlLmxlbmd0aC0xO3MrPTEpe2NvbnN0IHI9ZVtzXT8udmlkZW8/LmluYm91bmQuZmluZCgoZT0+ZS5zc3JjPT09dCkpO2lmKCFyKWNvbnRpbnVlO2NvbnN0IG89ZVtzLTFdPy52aWRlbz8uaW5ib3VuZD8uZmluZCgoZT0+ZS5zc3JjPT09dCkpO2lmKCFyfHwhbyljb250aW51ZTtjb25zdCBpPXIudGltZXN0YW1wLW8udGltZXN0YW1wLGE9ci5mcmFtZXNEZWNvZGVkLW8uZnJhbWVzRGVjb2RlZDtpZihhPjApe2NvbnN0IHQ9aS9hO24ucHVzaCh0KTt9fWlmKG4ubGVuZ3RoPD0xKXJldHVybiAhMTtyZXR1cm4gKHQ9Pntjb25zdCBlPSgodCxlKT0+ZS5yZWR1Y2UoKChlLHMpPT5lKyhzLXQpKioyKSwwKS9lLmxlbmd0aCkoQyh0KSx0KTtyZXR1cm4gTWF0aC5zcXJ0KGUpfSkobik+c30sTT0odCxlKT0+e2ZvcihsZXQgcz0xO3M8ZS5sZW5ndGg7cys9MSl7Y29uc3Qgbj1lW3NdLnZpZGVvLmluYm91bmQuZmluZCgoZT0+ZS5zc3JjPT09dCkpO2lmKCFuKWNvbnRpbnVlO2NvbnN0IHI9ZVtzLTFdLnZpZGVvLmluYm91bmQuZmluZCgoZT0+ZS5zc3JjPT09dCkpLG89bi5mcmFtZVdpZHRoIT09cj8uZnJhbWVXaWR0aCxpPW4uZnJhbWVIZWlnaHQhPT1yPy5mcmFtZUhlaWdodDtpZihvfHxpKXJldHVybiAhMH1yZXR1cm4gITF9O2NsYXNzIEkgZXh0ZW5kcyB5eyNoOyNsOyNwO2NvbnN0cnVjdG9yKHQ9e30pe3N1cGVyKCksdGhpcy4jaD10LmF2Z0ZyZWV6ZUR1cmF0aW9uVGhyZXNob2xkTXM/PzFlMyx0aGlzLiNsPXQuZnJvemVuRHVyYXRpb25UaHJlc2hvbGRQY3Q/PzMwLHRoaXMuI3A9dC5taW5Nb3NRdWFsaXR5Pz9uLkJBRDt9cGVyZm9ybURldGVjdGlvbih0KXtjb25zdCBlPXQubmV0d29ya1Njb3Jlcy5pbmJvdW5kO3JldHVybiB2b2lkIDAhPT1lJiZlPD10aGlzLiNwP1tdOnRoaXMucHJvY2Vzc0RhdGEodCl9cHJvY2Vzc0RhdGEodCl7Y29uc3Qgbj1bXSxyPXRoaXMuZ2V0QWxsTGFzdFByb2Nlc3NlZFN0YXRzKHQuY29ubmVjdGlvbi5pZCk7aWYoMD09PXIubGVuZ3RoKXJldHVybiBbXTtjb25zdCBvPXQudmlkZW8uaW5ib3VuZC5tYXAoKGU9Pntjb25zdCBzPXJbci5sZW5ndGgtMV0udmlkZW8uaW5ib3VuZC5maW5kKCh0PT50LnNzcmM9PT1lLnNzcmMpKTtpZighcylyZXR1cm47aWYoTShlLnNzcmMsW3Jbci5sZW5ndGgtMV0sdF0pKXJldHVybjtpZihSKGUuc3NyYyxyKSlyZXR1cm47Y29uc3Qgbj1lLmZyZWV6ZUNvdW50LShzLmZyZWV6ZUNvdW50Pz8wKSxvPTFlMyooZS50b3RhbEZyZWV6ZXNEdXJhdGlvbi0ocy50b3RhbEZyZWV6ZXNEdXJhdGlvbj8/MCkpLGk9bj4wP28vbjowLGE9by8oZS50aW1lc3RhbXAtcy50aW1lc3RhbXApKjEwMDtyZXR1cm4gYT50aGlzLiNsfHxpPnRoaXMuI2g/e3NzcmM6ZS5zc3JjLGF2Z0ZyZWV6ZUR1cmF0aW9uTXM6aSxmcm96ZW5EdXJhdGlvblBjdDphfTp2b2lkIDB9KSkuZmlsdGVyKCh0PT52b2lkIDAhPT10KSk7cmV0dXJuIG8ubGVuZ3RoPjAmJihuLnB1c2goe3R5cGU6ZS5TdHJlYW0scmVhc29uOnMuRnJvemVuVmlkZW9UcmFjayxzdGF0c1NhbXBsZTp7c3NyY3M6by5tYXAoKHQ9PnQuc3NyYykpfX0pLHRoaXMuZGVsZXRlTGFzdFByb2Nlc3NlZFN0YXRzKHQuY29ubmVjdGlvbi5pZCkpLG59fWNsYXNzIEUgZXh0ZW5kcyB5eyNmOyNtOyNwO2NvbnN0cnVjdG9yKHQ9e30pe3N1cGVyKHQpLHRoaXMuI2Y9dC52b2xhdGlsaXR5VGhyZXNob2xkPz84LHRoaXMuI209dC5hZmZlY3RlZFN0cmVhbXNQZXJjZW50VGhyZXNob2xkPz8zMCx0aGlzLiNwPXQubWluTW9zUXVhbGl0eT8/bi5CQUQ7fXBlcmZvcm1EZXRlY3Rpb24odCl7cmV0dXJuIFsuLi50aGlzLmdldEFsbExhc3RQcm9jZXNzZWRTdGF0cyh0LmNvbm5lY3Rpb24uaWQpLHRdLmZpbmQoKHQ9PnZvaWQgMCE9PXQubmV0d29ya1Njb3Jlcy5pbmJvdW5kJiZ0Lm5ldHdvcmtTY29yZXMuaW5ib3VuZDw9dGhpcy4jcCkpP1tdOnRoaXMucHJvY2Vzc0RhdGEodCl9cHJvY2Vzc0RhdGEodCl7Y29uc3Qgbj1bXSxyPVsuLi50aGlzLmdldEFsbExhc3RQcm9jZXNzZWRTdGF0cyh0LmNvbm5lY3Rpb24uaWQpLHRdLG89dC52aWRlby5pbmJvdW5kLm1hcCgodD0+e2lmKHIubGVuZ3RoPDUpcmV0dXJuO2lmKE0odC5zc3JjLHIpKXJldHVybjtjb25zdCBlPVtdO2ZvcihsZXQgcz0wO3M8ci5sZW5ndGgtMTtzKz0xKXtjb25zdCBuPXJbc10udmlkZW8uaW5ib3VuZC5maW5kKChlPT5lLnNzcmM9PT10LnNzcmMpKTt2b2lkIDAhPT1uPy5mcmFtZXNQZXJTZWNvbmQmJmUucHVzaChuLmZyYW1lc1BlclNlY29uZCk7fWlmKGUubGVuZ3RoPDUpcmV0dXJuO2lmKFIodC5zc3JjLHIpKXJldHVybjtjb25zdCBzPSh0PT57aWYoMD09PXQubGVuZ3RoKXRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBjYWxjdWxhdGUgdm9sYXRpbGl0eSBmb3IgZW1wdHkgYXJyYXlcIik7Y29uc3QgZT1DKHQpO3JldHVybiB0LnJlZHVjZSgoKHQscyk9PnQrTWF0aC5hYnMocy1lKSksMCkvdC5sZW5ndGgqMTAwL2V9KShlKTtyZXR1cm4gcz50aGlzLiNmP3tzc3JjOnQuc3NyYyxhbGxGcHM6ZSx2b2xhdGlsaXR5OnN9OnZvaWQgMH0pKS5maWx0ZXIoKHQ9PkJvb2xlYW4odCkpKTtpZigwPT09by5sZW5ndGgpcmV0dXJuIG47Y29uc3QgaT1vLmxlbmd0aC8odC52aWRlby5pbmJvdW5kLmxlbmd0aC8xMDApO3JldHVybiBpPnRoaXMuI20mJihuLnB1c2goe3R5cGU6ZS5DUFUscmVhc29uOnMuRGVjb2RlckNQVVRocm90dGxpbmcsc3RhdHNTYW1wbGU6e2FmZmVjdGVkU3RyZWFtc1BlcmNlbnQ6aSx0aHJvdHRoZWRTdHJlYW1zOm99fSksdGhpcy5kZWxldGVMYXN0UHJvY2Vzc2VkU3RhdHModC5jb25uZWN0aW9uLmlkKSksbn19Y29uc3QgTj10PT5cImNsb3NlZFwiPT09dC5pY2VDb25uZWN0aW9uU3RhdGV8fFwiY2xvc2VkXCI9PT10LmNvbm5lY3Rpb25TdGF0ZSxfPSh0LGUscyk9PjgqKCh0LGUscyk9PntpZighZSlyZXR1cm4gMDtjb25zdCBuPXRbc10scj1lW3NdO2lmKG51bGw9PW58fG51bGw9PXIpcmV0dXJuIDA7Y29uc3Qgbz1NYXRoLmZsb29yKHQudGltZXN0YW1wKS1NYXRoLmZsb29yKGUudGltZXN0YW1wKTtyZXR1cm4gMD09PW8/MDooTnVtYmVyKG4pLU51bWJlcihyKSkvbyoxZTN9KSh0LGUscyk7Y2xhc3MgQXtjb25uZWN0aW9ucz1bXTtzdGF0c1BhcnNlcjtjb25zdHJ1Y3Rvcih0KXt0aGlzLnN0YXRzUGFyc2VyPXQuc3RhdHNQYXJzZXI7fWxpc3RDb25uZWN0aW9ucygpe3JldHVybiBbLi4udGhpcy5jb25uZWN0aW9uc119YWRkUGVlckNvbm5lY3Rpb24odCl7dGhpcy5jb25uZWN0aW9ucy5wdXNoKHtpZDp0LmlkPz9TdHJpbmcoRGF0ZS5ub3coKStNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDMyKSkscGM6dC5wY30pO31yZW1vdmVQZWVyQ29ubmVjdGlvbih0KXtjb25zdCBlPXRoaXMuY29ubmVjdGlvbnMuZmluZEluZGV4KCgoe3BjOmV9KT0+ZT09PXQucGMpKTtlPj0wJiZ0aGlzLnJlbW92ZUNvbm5lY3Rpb25zQnlJbmRleGVzKFtlXSk7fWFzeW5jIHBhcnNlKCl7Y29uc3QgdD1bXSxlPXRoaXMuY29ubmVjdGlvbnMubWFwKChhc3luYyhlLHMpPT57aWYoIU4oZS5wYykpcmV0dXJuIHRoaXMuc3RhdHNQYXJzZXIucGFyc2UoZSk7dC51bnNoaWZ0KHMpO30pKTt0Lmxlbmd0aCYmdGhpcy5yZW1vdmVDb25uZWN0aW9uc0J5SW5kZXhlcyh0KTtyZXR1cm4gKGF3YWl0IFByb21pc2UuYWxsKGUpKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PXQpKX1yZW1vdmVDb25uZWN0aW9uc0J5SW5kZXhlcyh0KXt0LmZvckVhY2goKHQ9Pnt0aGlzLmNvbm5lY3Rpb25zLnNwbGljZSh0LDEpO30pKTt9fWNsYXNzIE97cHJldlN0YXRzPW5ldyBNYXA7YWxsb3dlZFJlcG9ydFR5cGVzPW5ldyBTZXQoW1wiY2FuZGlkYXRlLXBhaXJcIixcImluYm91bmQtcnRwXCIsXCJvdXRib3VuZC1ydHBcIixcInJlbW90ZS1vdXRib3VuZC1ydHBcIixcInJlbW90ZS1pbmJvdW5kLXJ0cFwiLFwidHJhY2tcIixcInRyYW5zcG9ydFwiXSk7aWdub3JlU1NSQ0xpc3Q7bG9nZ2VyO2NvbnN0cnVjdG9yKHQpe3RoaXMuaWdub3JlU1NSQ0xpc3Q9dC5pZ25vcmVTU1JDTGlzdD8/W10sdGhpcy5sb2dnZXI9dC5sb2dnZXI7fWdldCBwcmV2aW91c2x5UGFyc2VkU3RhdHNDb25uZWN0aW9uc0lkcygpe3JldHVybiBbLi4udGhpcy5wcmV2U3RhdHMua2V5cygpXX1hc3luYyBwYXJzZSh0KXtpZighTih0LnBjKSlyZXR1cm4gdGhpcy5nZXRDb25uZWN0aW9uU3RhdHModCk7dGhpcy5sb2dnZXIuZGVidWcoXCJTa2lwIHN0YXRzIHBhcnNpbmcuIENvbm5lY3Rpb24gaXMgY2xvc2VkLlwiLHtjb25uZWN0aW9uOnR9KTt9YXN5bmMgZ2V0Q29ubmVjdGlvblN0YXRzKHQpe2NvbnN0e3BjOmUsaWQ6c309dDt0cnl7Y29uc3Qgbj1EYXRlLm5vdygpLHI9ZS5nZXRSZWNlaXZlcnMoKS5maWx0ZXIoKHQ9PnQudHJhY2s/LmVuYWJsZWQpKSxvPWUuZ2V0U2VuZGVycygpLmZpbHRlcigodD0+dC50cmFjaz8uZW5hYmxlZCkpLGk9YXdhaXQgUHJvbWlzZS5hbGwoci5tYXAoKHQ9PnQuZ2V0U3RhdHMoKSkpKSxhPWF3YWl0IFByb21pc2UuYWxsKG8ubWFwKCh0PT50LmdldFN0YXRzKCkpKSk7cmV0dXJuIHtpZDpzLHN0YXRzOnRoaXMubWFwUmVwb3J0c1N0YXRzKFsuLi5pLC4uLmFdLHQpLHRpbWVUYWtlbjpEYXRlLm5vdygpLW59fWNhdGNoKHQpe3JldHVybiB2b2lkIHRoaXMubG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGdldCBzdGF0cyBmb3IgUENcIix7aWQ6cyxwYzplLGVycm9yOnR9KX19bWFwUmVwb3J0c1N0YXRzKHQsZSl7Y29uc3Qgcz17YXVkaW86e2luYm91bmQ6W10sb3V0Ym91bmQ6W119LHZpZGVvOntpbmJvdW5kOltdLG91dGJvdW5kOltdfSxjb25uZWN0aW9uOnt9LHJlbW90ZTp7dmlkZW86e2luYm91bmQ6W10sb3V0Ym91bmQ6W119LGF1ZGlvOntpbmJvdW5kOltdLG91dGJvdW5kOltdfX19O3QuZm9yRWFjaCgodD0+e3QuZm9yRWFjaCgoZT0+e3RoaXMuYWxsb3dlZFJlcG9ydFR5cGVzLmhhcyhlLnR5cGUpJiZ0aGlzLnVwZGF0ZU1hcHBlZFN0YXRzV2l0aFJlcG9ydEl0ZW1EYXRhKGUscyx0KTt9KSk7fSkpO2NvbnN0e2lkOm59PWUscj10aGlzLnByZXZTdGF0cy5nZXQobik7cmV0dXJuIHImJnRoaXMucHJvcGFnYXRlU3RhdHNXaXRoUmF0ZVZhbHVlcyhzLHIuc3RhdHMpLHRoaXMucHJldlN0YXRzLnNldChuLHtzdGF0czpzLHRzOkRhdGUubm93KCl9KSx2KHt0YXNrSWQ6bixkZWxheU1zOjM1ZTMsY2FsbGJhY2s6KCk9PnRoaXMucHJldlN0YXRzLmRlbGV0ZShuKX0pLHN9dXBkYXRlTWFwcGVkU3RhdHNXaXRoUmVwb3J0SXRlbURhdGEodCxlLHMpe2NvbnN0IG49dC50eXBlO2lmKFwiY2FuZGlkYXRlLXBhaXJcIj09PW4mJlwic3VjY2VlZGVkXCI9PT10LnN0YXRlJiZ0Lm5vbWluYXRlZClyZXR1cm4gdm9pZChlLmNvbm5lY3Rpb249dGhpcy5wcmVwYXJlQ29ubmVjdGlvblN0YXRzKHQscykpO2NvbnN0IHI9dGhpcy5nZXRNZWRpYVR5cGUodCk7aWYoIXIpcmV0dXJuO2NvbnN0IG89dC5zc3JjO2lmKCFvfHwhdGhpcy5pZ25vcmVTU1JDTGlzdC5pbmNsdWRlcyhvKSlpZihcIm91dGJvdW5kLXJ0cFwiIT09bilpZihcImluYm91bmQtcnRwXCIhPT1uKVwicmVtb3RlLW91dGJvdW5kLXJ0cFwiIT09bj9cInJlbW90ZS1pbmJvdW5kLXJ0cFwiPT09biYmKHRoaXMubWFwQ29ubmVjdGlvblN0YXRzSWZOZWNlc3NhcnkoZSx0LHMpLGUucmVtb3RlW3JdLmluYm91bmQucHVzaCh7Li4udH0pKTplLnJlbW90ZVtyXS5vdXRib3VuZC5wdXNoKHsuLi50fSk7ZWxzZSB7Y29uc3Qgbj1zLmdldCh0LnRyYWNrSWQpfHxzLmdldCh0Lm1lZGlhU291cmNlSWQpfHx7fTt0aGlzLm1hcENvbm5lY3Rpb25TdGF0c0lmTmVjZXNzYXJ5KGUsdCxzKTtjb25zdCBvPXsuLi50LHRyYWNrOnsuLi5ufX07ZVtyXS5pbmJvdW5kLnB1c2gobyk7fWVsc2Uge2NvbnN0IG49cy5nZXQodC50cmFja0lkKXx8cy5nZXQodC5tZWRpYVNvdXJjZUlkKXx8e30sbz17Li4udCx0cmFjazp7Li4ubn19O2Vbcl0ub3V0Ym91bmQucHVzaChvKTt9fWdldE1lZGlhVHlwZSh0KXtjb25zdCBlPXQubWVkaWFUeXBlfHx0LmtpbmQ7aWYoIVtcImF1ZGlvXCIsXCJ2aWRlb1wiXS5pbmNsdWRlcyhlKSl7Y29uc3R7aWQ6ZX09dDtpZighZSlyZXR1cm47cmV0dXJuIFN0cmluZyhlKS5pbmNsdWRlcyhcIlZpZGVvXCIpP1widmlkZW9cIjpTdHJpbmcoZSkuaW5jbHVkZXMoXCJBdWRpb1wiKT9cImF1ZGlvXCI6dm9pZCAwfXJldHVybiBlfXByb3BhZ2F0ZVN0YXRzV2l0aFJhdGVWYWx1ZXModCxlKXt0LmF1ZGlvLmluYm91bmQuZm9yRWFjaCgodD0+e2NvbnN0IHM9ZS5hdWRpby5pbmJvdW5kLmZpbmQoKCh7aWQ6ZX0pPT5lPT09dC5pZCkpO3QuYml0cmF0ZT1fKHQscyxcImJ5dGVzUmVjZWl2ZWRcIiksdC5wYWNrZXRSYXRlPV8odCxzLFwicGFja2V0c1JlY2VpdmVkXCIpO30pKSx0LmF1ZGlvLm91dGJvdW5kLmZvckVhY2goKHQ9Pntjb25zdCBzPWUuYXVkaW8ub3V0Ym91bmQuZmluZCgoKHtpZDplfSk9PmU9PT10LmlkKSk7dC5iaXRyYXRlPV8odCxzLFwiYnl0ZXNTZW50XCIpLHQucGFja2V0UmF0ZT1fKHQscyxcInBhY2tldHNTZW50XCIpO30pKSx0LnZpZGVvLmluYm91bmQuZm9yRWFjaCgodD0+e2NvbnN0IHM9ZS52aWRlby5pbmJvdW5kLmZpbmQoKCh7aWQ6ZX0pPT5lPT09dC5pZCkpO3QuYml0cmF0ZT1fKHQscyxcImJ5dGVzUmVjZWl2ZWRcIiksdC5wYWNrZXRSYXRlPV8odCxzLFwicGFja2V0c1JlY2VpdmVkXCIpO30pKSx0LnZpZGVvLm91dGJvdW5kLmZvckVhY2goKHQ9Pntjb25zdCBzPWUudmlkZW8ub3V0Ym91bmQuZmluZCgoKHtpZDplfSk9PmU9PT10LmlkKSk7dC5iaXRyYXRlPV8odCxzLFwiYnl0ZXNTZW50XCIpLHQucGFja2V0UmF0ZT1fKHQscyxcInBhY2tldHNTZW50XCIpO30pKTt9bWFwQ29ubmVjdGlvblN0YXRzSWZOZWNlc3NhcnkodCxlLHMpe2lmKHQuY29ubmVjdGlvbi5pZHx8IWUudHJhbnNwb3J0SWQpcmV0dXJuO2NvbnN0IG49cy5nZXQoZS50cmFuc3BvcnRJZCk7aWYobiYmbi5zZWxlY3RlZENhbmRpZGF0ZVBhaXJJZCl7Y29uc3QgZT1zLmdldChuLnNlbGVjdGVkQ2FuZGlkYXRlUGFpcklkKTt0LmNvbm5lY3Rpb249dGhpcy5wcmVwYXJlQ29ubmVjdGlvblN0YXRzKGUscyk7fX1wcmVwYXJlQ29ubmVjdGlvblN0YXRzKHQsZSl7aWYoIXR8fCFlKXJldHVybiB7fTtjb25zdCBzPXsuLi50fTtpZihzLnJlbW90ZUNhbmRpZGF0ZUlkKXtjb25zdCB0PWUuZ2V0KHMucmVtb3RlQ2FuZGlkYXRlSWQpO3MucmVtb3RlPXsuLi50fTt9aWYocy5sb2NhbENhbmRpZGF0ZUlkKXtjb25zdCB0PWUuZ2V0KHMubG9jYWxDYW5kaWRhdGVJZCk7cy5sb2NhbD17Li4udH07fXJldHVybiBzfX1jbGFzcyBKIGV4dGVuZHMgeXsjZz1uZXcgTWFwOyNTOyN2O2NvbnN0cnVjdG9yKHQ9e30pe3N1cGVyKCksdGhpcy4jUz10LnRpbWVvdXRNcz8/MTVlMyx0aGlzLiN2PXQuc3RlcHM/PzM7fXBlcmZvcm1EZXRlY3Rpb24odCl7cmV0dXJuIHRoaXMucHJvY2Vzc0RhdGEodCl9cHJvY2Vzc0RhdGEodCl7Y29uc3Qgbj1bXSxyPVsuLi50aGlzLmdldEFsbExhc3RQcm9jZXNzZWRTdGF0cyh0LmNvbm5lY3Rpb24uaWQpLHRdO2lmKHIubGVuZ3RoPHRoaXMuI3YpcmV0dXJuIG47Y29uc3Qgbz1yLnNsaWNlKC10aGlzLiN2KSxpPW8ubWFwKCh0PT50LnZpZGVvLmluYm91bmQpKSxhPW8ubWFwKCh0PT50LmF1ZGlvLmluYm91bmQpKTtuLnB1c2goLi4udGhpcy5kZXRlY3RNaXNzaW5nRGF0YShhLGUuU3RyZWFtLHMuTWlzc2luZ0F1ZGlvU3RyZWFtRGF0YSkpLG4ucHVzaCguLi50aGlzLmRldGVjdE1pc3NpbmdEYXRhKGksZS5TdHJlYW0scy5NaXNzaW5nVmlkZW9TdHJlYW1EYXRhKSk7cmV0dXJuIG5ldyBTZXQodGhpcy4jZy5rZXlzKCkpLmZvckVhY2goKHQ9Pntjb25zdCBlPXRoaXMuI2cuZ2V0KHQpO2UmJkRhdGUubm93KCktZT50aGlzLiNTJiZ0aGlzLnJlbW92ZU1hcmtlZElzc3VlKHQpO30pKSxufWRldGVjdE1pc3NpbmdEYXRhKHQsZSxzKXtjb25zdCBuPVtdLHI9dC5wb3AoKSxvPUoubWFwU3RhdHNCeVRyYWNrSWQodCk7cmV0dXJuIHIuZm9yRWFjaCgodD0+e2NvbnN0IHI9dC50cmFjay50cmFja0lkZW50aWZpZXIsaT1vLmdldChyKTtpZighQXJyYXkuaXNBcnJheShpKXx8MD09PWkubGVuZ3RoKXJldHVybjtpZih0LnRyYWNrLmRldGFjaGVkfHx0LnRyYWNrLmVuZGVkKXJldHVybjtpZighSi5pc0FsbEJ5dGVzUmVjZWl2ZWREaWRudENoYW5nZSh0LmJ5dGVzUmVjZWl2ZWQsaSkpcmV0dXJuIHZvaWQgdGhpcy5yZW1vdmVNYXJrZWRJc3N1ZShyKTtpZighdGhpcy5tYXJrSXNzdWUocikpcmV0dXJuO2NvbnN0IGE9e2J5dGVzUmVjZWl2ZWQ6dC5ieXRlc1JlY2VpdmVkfTtuLnB1c2goe3R5cGU6ZSxyZWFzb246cyxzdGF0c1NhbXBsZTphLHRyYWNrSWRlbnRpZmllcjpyfSk7fSkpLG59c3RhdGljIG1hcFN0YXRzQnlUcmFja0lkKHQpe2NvbnN0IGU9bmV3IE1hcDtyZXR1cm4gdC5mb3JFYWNoKCh0PT57dC5mb3JFYWNoKCh0PT57Y29uc3Qgcz1lLmdldCh0LnRyYWNrLnRyYWNrSWRlbnRpZmllcil8fFtdO3MucHVzaCh0KSxlLnNldCh0LnRyYWNrLnRyYWNrSWRlbnRpZmllcixzKTt9KSk7fSkpLGV9c3RhdGljIGlzQWxsQnl0ZXNSZWNlaXZlZERpZG50Q2hhbmdlKHQsZSl7Zm9yKGxldCBzPTA7czxlLmxlbmd0aDtzKz0xKXtpZihlW3NdLmJ5dGVzUmVjZWl2ZWQhPT10KXJldHVybiAhMX1yZXR1cm4gITB9bWFya0lzc3VlKHQpe2NvbnN0IGU9RGF0ZS5ub3coKSxzPXRoaXMuI2cuZ2V0KHQpO3JldHVybiAoIXN8fGUtcz50aGlzLiNTKSYmKHRoaXMuI2cuc2V0KHQsZSksITApfXJlbW92ZU1hcmtlZElzc3VlKHQpe3RoaXMuI2cuZGVsZXRlKHQpO319Y2xhc3MgeHtldmVudEVtaXR0ZXI7I2s9ITE7ZGV0ZWN0b3JzPVtdO25ldHdvcmtTY29yZXNDYWxjdWxhdG9yO3N0YXRzUmVwb3J0ZXI7Y29tcG9zaXRlU3RhdHNQYXJzZXI7bG9nZ2VyO2F1dG9BZGRQZWVyQ29ubmVjdGlvbnM7Y29uc3RydWN0b3IoZSl7dGhpcy5sb2dnZXI9ZS5sb2dnZXI/P3tkZWJ1ZzooKT0+e30saW5mbzooKT0+e30sd2FybjooKT0+e30sZXJyb3I6KCk9Pnt9fSx0aGlzLmV2ZW50RW1pdHRlcj1lLmlzc3VlRW1pdHRlcj8/bmV3IGcsZS5vbklzc3VlcyYmdGhpcy5ldmVudEVtaXR0ZXIub24odC5Jc3N1ZSxlLm9uSXNzdWVzKSxlLm9uTmV0d29ya1Njb3Jlc1VwZGF0ZWQmJnRoaXMuZXZlbnRFbWl0dGVyLm9uKHQuTmV0d29ya1Njb3Jlc1VwZGF0ZWQsZS5vbk5ldHdvcmtTY29yZXNVcGRhdGVkKSx0aGlzLmRldGVjdG9ycz1lLmRldGVjdG9ycz8/W25ldyBMLG5ldyBiLG5ldyBULG5ldyBQLG5ldyB3LG5ldyBELG5ldyBJLG5ldyBFLG5ldyBKXSx0aGlzLm5ldHdvcmtTY29yZXNDYWxjdWxhdG9yPWUubmV0d29ya1Njb3Jlc0NhbGN1bGF0b3I/P25ldyBrLHRoaXMuY29tcG9zaXRlU3RhdHNQYXJzZXI9ZS5jb21wb3NpdGVTdGF0c1BhcnNlcj8/bmV3IEEoe3N0YXRzUGFyc2VyOm5ldyBPKHtpZ25vcmVTU1JDTGlzdDplLmlnbm9yZVNTUkNMaXN0LGxvZ2dlcjp0aGlzLmxvZ2dlcn0pfSksdGhpcy5zdGF0c1JlcG9ydGVyPWUuc3RhdHNSZXBvcnRlcj8/bmV3IFMoe2NvbXBvc2l0ZVN0YXRzUGFyc2VyOnRoaXMuY29tcG9zaXRlU3RhdHNQYXJzZXIsZ2V0U3RhdHNJbnRlcnZhbDplLmdldFN0YXRzSW50ZXJ2YWw/PzVlM30pLHdpbmRvdy53aWQ9dGhpcyx0aGlzLmF1dG9BZGRQZWVyQ29ubmVjdGlvbnM9ZS5hdXRvQWRkUGVlckNvbm5lY3Rpb25zPz8hMCx0aGlzLmF1dG9BZGRQZWVyQ29ubmVjdGlvbnMmJnRoaXMud3JhcFJUQ1BlZXJDb25uZWN0aW9uKCksdGhpcy5zdGF0c1JlcG9ydGVyLm9uKFMuU1RBVFNfUkVQT1JUX1JFQURZX0VWRU5ULCh0PT57Y29uc3QgZT10aGlzLmNhbGN1bGF0ZU5ldHdvcmtTY29yZXModC5zdGF0cyk7dGhpcy5kZXRlY3RJc3N1ZXMoe2RhdGE6dC5zdGF0c30sZSk7fSkpLHRoaXMuc3RhdHNSZXBvcnRlci5vbihTLlNUQVRTX1JFUE9SVFNfUEFSU0VELChzPT57Y29uc3Qgbj17dGltZVRha2VuOnMudGltZVRha2VuLHRzOkRhdGUubm93KCl9O2Uub25TdGF0cyYmZS5vblN0YXRzKHMucmVwb3J0SXRlbXMpLHRoaXMuZXZlbnRFbWl0dGVyLmVtaXQodC5TdGF0c1BhcnNpbmdGaW5pc2hlZCxuKTt9KSk7fXdhdGNoTmV3UGVlckNvbm5lY3Rpb25zKCl7aWYoIXRoaXMuYXV0b0FkZFBlZXJDb25uZWN0aW9ucyl0aHJvdyBuZXcgRXJyb3IoXCJBdXRvIGFkZCBwZWVyIGNvbm5lY3Rpb25zIHdhcyBkaXNhYmxlZCBpbiB0aGUgY29uc3RydWN0b3IuXCIpO3RoaXMuI2s/dGhpcy5sb2dnZXIud2FybihcIldlYlJUQ0lzc3VlRGV0ZWN0b3IgaXMgYWxyZWFkeSBzdGFydGVkLiBTa2lwIHByb2Nlc3NpbmdcIik6KHRoaXMubG9nZ2VyLmluZm8oXCJTdGFydCB3YXRjaGluZyBwZWVyIGNvbm5lY3Rpb25zXCIpLHRoaXMuI2s9ITAsdGhpcy5zdGF0c1JlcG9ydGVyLnN0YXJ0UmVwb3J0aW5nKCkpO31zdG9wV2F0Y2hpbmdOZXdQZWVyQ29ubmVjdGlvbnMoKXt0aGlzLiNrPyh0aGlzLmxvZ2dlci5pbmZvKFwiU3RvcCB3YXRjaGluZyBwZWVyIGNvbm5lY3Rpb25zXCIpLHRoaXMuI2s9ITEsdGhpcy5zdGF0c1JlcG9ydGVyLnN0b3BSZXBvcnRpbmcoKSk6dGhpcy5sb2dnZXIud2FybihcIldlYlJUQ0lzc3VlRGV0ZWN0b3IgaXMgYWxyZWFkeSBzdG9wcGVkLiBTa2lwIHByb2Nlc3NpbmdcIik7fWhhbmRsZU5ld1BlZXJDb25uZWN0aW9uKHQsZSl7dGhpcy4ja3x8IXRoaXMuYXV0b0FkZFBlZXJDb25uZWN0aW9ucz8odGhpcy4ja3x8ITEhPT10aGlzLmF1dG9BZGRQZWVyQ29ubmVjdGlvbnN8fCh0aGlzLmxvZ2dlci5pbmZvKFwiU3RhcnRpbmcgc3RhdHMgcmVwb3J0aW5nIGZvciBuZXcgcGVlciBjb25uZWN0aW9uXCIpLHRoaXMuI2s9ITAsdGhpcy5zdGF0c1JlcG9ydGVyLnN0YXJ0UmVwb3J0aW5nKCkpLHRoaXMubG9nZ2VyLmRlYnVnKFwiSGFuZGxpbmcgbmV3IHBlZXIgY29ubmVjdGlvblwiLHQpLHRoaXMuY29tcG9zaXRlU3RhdHNQYXJzZXIuYWRkUGVlckNvbm5lY3Rpb24oe3BjOnQsaWQ6ZX0pKTp0aGlzLmxvZ2dlci5kZWJ1ZyhcIlNraXAgaGFuZGxpbmcgbmV3IHBlZXIgY29ubmVjdGlvbi4gRGV0ZWN0b3IgaXMgbm90IHJ1bm5pbmdcIix0KTt9ZW1pdElzc3VlcyhlKXt0aGlzLmV2ZW50RW1pdHRlci5lbWl0KHQuSXNzdWUsZSk7fWRldGVjdElzc3Vlcyh7ZGF0YTp0fSxlKXtjb25zdCBzPXRoaXMuZGV0ZWN0b3JzLnJlZHVjZSgoKHMsbik9PlsuLi5zLC4uLm4uZGV0ZWN0KHQsZSldKSxbXSk7cy5sZW5ndGg+MCYmdGhpcy5lbWl0SXNzdWVzKHMpO31jYWxjdWxhdGVOZXR3b3JrU2NvcmVzKGUpe2NvbnN0IHM9dGhpcy5uZXR3b3JrU2NvcmVzQ2FsY3VsYXRvci5jYWxjdWxhdGUoZSk7cmV0dXJuIHRoaXMuZXZlbnRFbWl0dGVyLmVtaXQodC5OZXR3b3JrU2NvcmVzVXBkYXRlZCxzKSxzfXdyYXBSVENQZWVyQ29ubmVjdGlvbigpe2lmKCF3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24pcmV0dXJuIHZvaWQgdGhpcy5sb2dnZXIud2FybihcIk5vIFJUQ1BlZXJDb25uZWN0aW9uIGZvdW5kIGluIGJyb3dzZXIgd2luZG93LiBTa2lwcGluZ1wiKTtjb25zdCB0PXdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbixlPXQ9PnRoaXMuaGFuZGxlTmV3UGVlckNvbm5lY3Rpb24odCk7ZnVuY3Rpb24gcyhzKXtjb25zdCBuPW5ldyB0KHMpO3JldHVybiBlKG4pLG59cy5wcm90b3R5cGU9dC5wcm90b3R5cGUsd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uPXM7fX1cblxudmFyIFdlYlJUQ0Nvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhXZWJSVENDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXZWJSVENDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmlzc3VlRGV0ZWN0b3IgPSBudWxsO1xuICAgICAgICBfdGhpcy5tb3NTY29yZXMgPSBudWxsO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFdlYlJUQ0Nvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZS5fc3RhcnQgPSBmdW5jdGlvbiAocGVlckNvbm5lY3Rpb24pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5pc3N1ZURldGVjdG9yID0gbmV3IHgoe1xuICAgICAgICAgICAgYXV0b0FkZFBlZXJDb25uZWN0aW9uczogZmFsc2UsXG4gICAgICAgICAgICBnZXRTdGF0c0ludGVydmFsOiAzMDAwLFxuICAgICAgICAgICAgb25OZXR3b3JrU2NvcmVzVXBkYXRlZDogZnVuY3Rpb24gKHNjb3Jlcykge1xuICAgICAgICAgICAgICAgIF90aGlzLm1vc1Njb3JlcyA9IHNjb3JlcztcbiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVTdGF0c0NoYW5nZWQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlzc3VlRGV0ZWN0b3IuaGFuZGxlTmV3UGVlckNvbm5lY3Rpb24ocGVlckNvbm5lY3Rpb24pO1xuICAgIH07XG4gICAgV2ViUlRDQ29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IucHJvdG90eXBlLl9zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pc3N1ZURldGVjdG9yKSB7XG4gICAgICAgICAgICB0aGlzLmlzc3VlRGV0ZWN0b3Iuc3RvcFdhdGNoaW5nTmV3UGVlckNvbm5lY3Rpb25zKCk7XG4gICAgICAgICAgICB0aGlzLmlzc3VlRGV0ZWN0b3IgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubW9zU2NvcmVzID0gbnVsbDtcbiAgICB9O1xuICAgIFdlYlJUQ0Nvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVDb25uZWN0aW9uUXVhbGl0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLm1vc1Njb3JlcyB8fCAodGhpcy5tb3NTY29yZXMuaW5ib3VuZCAmJiB0aGlzLm1vc1Njb3Jlcy5vdXRib3VuZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBDb25uZWN0aW9uUXVhbGl0eS5VTktOT1dOO1xuICAgICAgICB9XG4gICAgICAgIGlmICgodGhpcy5tb3NTY29yZXMuaW5ib3VuZCAmJiB0aGlzLm1vc1Njb3Jlcy5pbmJvdW5kIDwgMykgfHxcbiAgICAgICAgICAgICh0aGlzLm1vc1Njb3Jlcy5vdXRib3VuZCAmJiB0aGlzLm1vc1Njb3Jlcy5vdXRib3VuZCA8IDMpKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29ubmVjdGlvblF1YWxpdHkuQkFEO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb25uZWN0aW9uUXVhbGl0eS5HT09EO1xuICAgIH07XG4gICAgcmV0dXJuIFdlYlJUQ0Nvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yO1xufShBYnN0cmFjdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yKSk7XG5cbnZhciBWb2ljZUNoYXRTdGF0ZTtcbihmdW5jdGlvbiAoVm9pY2VDaGF0U3RhdGUpIHtcbiAgICBWb2ljZUNoYXRTdGF0ZVtcIklOQUNUSVZFXCJdID0gXCJpbmFjdGl2ZVwiO1xuICAgIFZvaWNlQ2hhdFN0YXRlW1wiU1RBUlRJTkdcIl0gPSBcInN0YXJ0aW5nXCI7XG4gICAgVm9pY2VDaGF0U3RhdGVbXCJBQ1RJVkVcIl0gPSBcInN0YXJ0ZWRcIjtcbiAgICBWb2ljZUNoYXRTdGF0ZVtcIlNUT1BQSU5HXCJdID0gXCJzdG9wcGluZ1wiO1xufSkoVm9pY2VDaGF0U3RhdGUgfHwgKFZvaWNlQ2hhdFN0YXRlID0ge30pKTtcbnZhciBBYnN0cmFjdFZvaWNlQ2hhdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBBYnN0cmFjdFZvaWNlQ2hhdCgpIHtcbiAgICB9XG4gICAgcmV0dXJuIEFic3RyYWN0Vm9pY2VDaGF0O1xufSgpKTtcbnZhciBBYnN0cmFjdFZvaWNlQ2hhdEltcGxlbWVudGF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhBYnN0cmFjdFZvaWNlQ2hhdEltcGxlbWVudGF0aW9uLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24oKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5faXNNdXRlZCA9IHRydWU7XG4gICAgICAgIF90aGlzLnN0YXRlID0gVm9pY2VDaGF0U3RhdGUuSU5BQ1RJVkU7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24ucHJvdG90eXBlLCBcImlzTXV0ZWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc011dGVkO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24ucHJvdG90eXBlLCBcImlzVm9pY2VDaGF0dGluZ1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUgIT09IFZvaWNlQ2hhdFN0YXRlLklOQUNUSVZFO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgQWJzdHJhY3RWb2ljZUNoYXRJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuc3RhcnRWb2ljZUNoYXQgPSBmdW5jdGlvbiAodm9pY2VDaGF0Q29uZmlnKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBlXzE7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISh0aGlzLnN0YXRlICE9PSBWb2ljZUNoYXRTdGF0ZS5JTkFDVElWRSkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdG9wVm9pY2VDaGF0KCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDI7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMiwgNCwgLCA2XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gVm9pY2VDaGF0U3RhdGUuU1RBUlRJTkc7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLl9zdGFydFZvaWNlQ2hhdCh2b2ljZUNoYXRDb25maWcpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFZvaWNlQ2hhdFN0YXRlLkFDVElWRTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDZdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBlXzEgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnN0b3BWb2ljZUNoYXQoKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVfMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgQWJzdHJhY3RWb2ljZUNoYXRJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuc3RvcFZvaWNlQ2hhdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09IFZvaWNlQ2hhdFN0YXRlLklOQUNUSVZFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFZvaWNlQ2hhdFN0YXRlLlNUT1BQSU5HO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5fc3RvcFZvaWNlQ2hhdCgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNNdXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gVm9pY2VDaGF0U3RhdGUuSU5BQ1RJVkU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgQWJzdHJhY3RWb2ljZUNoYXRJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuX211dGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9O1xuICAgIEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24ucHJvdG90eXBlLl91bm11dGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9O1xuICAgIEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24ucHJvdG90eXBlLm11dGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1ZvaWNlQ2hhdHRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9tdXRlKCk7XG4gICAgICAgIHRoaXMuX2lzTXV0ZWQgPSB0cnVlO1xuICAgIH07XG4gICAgQWJzdHJhY3RWb2ljZUNoYXRJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUudW5tdXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWb2ljZUNoYXR0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdW5tdXRlKCk7XG4gICAgICAgIHRoaXMuX2lzTXV0ZWQgPSBmYWxzZTtcbiAgICB9O1xuICAgIHJldHVybiBBYnN0cmFjdFZvaWNlQ2hhdEltcGxlbWVudGF0aW9uO1xufShBYnN0cmFjdFZvaWNlQ2hhdCkpO1xuXG5mdW5jdGlvbiBzbGVlcChtcykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXR1cm4gc2V0VGltZW91dChyZXNvbHZlLCBtcyk7IH0pO1xufVxuZnVuY3Rpb24gY29udmVydEZsb2F0MzJUb1MxNlBDTShmbG9hdDMyQXJyYXkpIHtcbiAgICB2YXIgaW50MTZBcnJheSA9IG5ldyBJbnQxNkFycmF5KGZsb2F0MzJBcnJheS5sZW5ndGgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmxvYXQzMkFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBjbGFtcGVkVmFsdWUgPSBNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwgZmxvYXQzMkFycmF5W2ldKSk7XG4gICAgICAgIGludDE2QXJyYXlbaV0gPSBjbGFtcGVkVmFsdWUgPCAwID8gY2xhbXBlZFZhbHVlICogMzI3NjggOiBjbGFtcGVkVmFsdWUgKiAzMjc2NztcbiAgICB9XG4gICAgcmV0dXJuIGludDE2QXJyYXk7XG59XG5cbnZhciBMaXZla2l0Vm9pY2VDaGF0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhMaXZla2l0Vm9pY2VDaGF0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIExpdmVraXRWb2ljZUNoYXQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5yb29tID0gbnVsbDtcbiAgICAgICAgX3RoaXMudHJhY2sgPSBudWxsO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIExpdmVraXRWb2ljZUNoYXQucHJvdG90eXBlLl9zdGFydFZvaWNlQ2hhdCA9IGZ1bmN0aW9uICh2b2ljZUNoYXRDb25maWcpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgdmFyIF9iO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYykge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2MubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb29tID0gdm9pY2VDaGF0Q29uZmlnLnJvb207XG4gICAgICAgICAgICAgICAgICAgICAgICBfYSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjcmVhdGVMb2NhbEF1ZGlvVHJhY2soe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvQ2FuY2VsbGF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2lzZVN1cHByZXNzaW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvR2FpbkNvbnRyb2w6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cmFjayA9IF9jLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMucm9vbS5sb2NhbFBhcnRpY2lwYW50LnB1Ymxpc2hUcmFjayh0aGlzLnRyYWNrKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKChfYiA9IHZvaWNlQ2hhdENvbmZpZy5jb25maWcpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5kZWZhdWx0TXV0ZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bm11dGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubXV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgc2xlZXAoNDAwMCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYy5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgTGl2ZWtpdFZvaWNlQ2hhdC5wcm90b3R5cGUuX3N0b3BWb2ljZUNoYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2IpIHtcbiAgICAgICAgICAgICAgICBpZiAoKF9hID0gdGhpcy5yb29tKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubG9jYWxQYXJ0aWNpcGFudCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvb20ubG9jYWxQYXJ0aWNpcGFudC5nZXRUcmFja1B1YmxpY2F0aW9ucygpLmZvckVhY2goZnVuY3Rpb24gKHB1YmxpY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHVibGljYXRpb24udHJhY2sgJiYgcHVibGljYXRpb24udHJhY2sua2luZCA9PT0gVHJhY2suS2luZC5BdWRpbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpY2F0aW9uLnRyYWNrLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhY2suc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYWNrID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgTGl2ZWtpdFZvaWNlQ2hhdC5wcm90b3R5cGUuX211dGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnRyYWNrICYmICF0aGlzLnRyYWNrLmlzTXV0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMudHJhY2subXV0ZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBMaXZla2l0Vm9pY2VDaGF0LnByb3RvdHlwZS5fdW5tdXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy50cmFjayAmJiB0aGlzLnRyYWNrLmlzTXV0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMudHJhY2sudW5tdXRlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBMaXZla2l0Vm9pY2VDaGF0O1xufShBYnN0cmFjdFZvaWNlQ2hhdEltcGxlbWVudGF0aW9uKSk7XG5cbnZhciBXZWJTb2NrZXRWb2ljZUNoYXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFdlYlNvY2tldFZvaWNlQ2hhdCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXZWJTb2NrZXRWb2ljZUNoYXQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5hdWRpb0NvbnRleHQgPSBudWxsO1xuICAgICAgICBfdGhpcy53ZWJTb2NrZXQgPSBudWxsO1xuICAgICAgICBfdGhpcy5zY3JpcHRQcm9jZXNzb3IgPSBudWxsO1xuICAgICAgICBfdGhpcy5tZWRpYVN0cmVhbUF1ZGlvU291cmNlID0gbnVsbDtcbiAgICAgICAgX3RoaXMubWVkaWFEZXZpY2VzU3RyZWFtID0gbnVsbDtcbiAgICAgICAgX3RoaXMuYXVkaW9SYXdGcmFtZSA9IG51bGw7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgV2ViU29ja2V0Vm9pY2VDaGF0LnByb3RvdHlwZS5fc3RhcnRWb2ljZUNoYXQgPSBmdW5jdGlvbiAodm9pY2VDaGF0Q29uZmlnKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBkZXZpY2VzU3RyZWFtO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2UpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9lLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbmF2aWdhdG9yLm1lZGlhRGV2aWNlcyB8fCAhbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzdGFydCB2b2ljZSBjaGF0IHdpdGhvdXQgbWVkaWEgZGV2aWNlcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQgPSB2b2ljZUNoYXRDb25maWcud2ViU29ja2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdWRpb1Jhd0ZyYW1lID0gdm9pY2VDaGF0Q29uZmlnLmF1ZGlvUmF3RnJhbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvQ29udGV4dCA9IG5ldyB3aW5kb3cuQXVkaW9Db250ZXh0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRlbmN5SGludDogJ2ludGVyYWN0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVSYXRlOiAxNjAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoKF9hID0gdm9pY2VDaGF0Q29uZmlnLmNvbmZpZykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRlZmF1bHRNdXRlZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVubXV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpbzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcGxlUmF0ZTogMTYwMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsQ291bnQ6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvR2FpbkNvbnRyb2w6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvQ2FuY2VsbGF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9pc2VTdXBwcmVzc2lvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZXNTdHJlYW0gPSBfZS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lZGlhRGV2aWNlc1N0cmVhbSA9IGRldmljZXNTdHJlYW07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lZGlhU3RyZWFtQXVkaW9Tb3VyY2UgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfYiA9IHRoaXMuYXVkaW9Db250ZXh0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2UoZGV2aWNlc1N0cmVhbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcmlwdFByb2Nlc3NvciA9IChfYyA9IHRoaXMuYXVkaW9Db250ZXh0KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuY3JlYXRlU2NyaXB0UHJvY2Vzc29yKDUxMiwgMSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lZGlhU3RyZWFtQXVkaW9Tb3VyY2UuY29ubmVjdCh0aGlzLnNjcmlwdFByb2Nlc3Nvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcmlwdFByb2Nlc3Nvci5jb25uZWN0KChfZCA9IHRoaXMuYXVkaW9Db250ZXh0KSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JpcHRQcm9jZXNzb3Iub25hdWRpb3Byb2Nlc3MgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy53ZWJTb2NrZXQgfHwgIV90aGlzLmF1ZGlvUmF3RnJhbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXVkaW9EYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5pc011dGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvRGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoNTEyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvRGF0YSA9IGV2ZW50LmlucHV0QnVmZmVyLmdldENoYW5uZWxEYXRhKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGNtUzE2QXJyYXkgPSBjb252ZXJ0RmxvYXQzMlRvUzE2UENNKGF1ZGlvRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBjbUJ5dGVBcnJheSA9IG5ldyBVaW50OEFycmF5KHBjbVMxNkFycmF5LmJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZyYW1lID0gX3RoaXMuYXVkaW9SYXdGcmFtZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpbzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW86IEFycmF5LmZyb20ocGNtQnl0ZUFycmF5KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsZVJhdGU6IDE2MDAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtQ2hhbm5lbHM6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVuY29kZWRGcmFtZSA9IG5ldyBVaW50OEFycmF5KF90aGlzLmF1ZGlvUmF3RnJhbWUuZW5jb2RlKGZyYW1lKS5maW5pc2goKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKF9hID0gX3RoaXMud2ViU29ja2V0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2VuZChlbmNvZGVkRnJhbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRob3VnaCByb29tIGhhcyBiZWVuIGNvbm5lY3RlZCwgYnV0IHRoZSBzdHJlYW0gbWF5IG5vdCBiZSByZWFkeS5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHNsZWVwKDIwMDApXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhvdWdoIHJvb20gaGFzIGJlZW4gY29ubmVjdGVkLCBidXQgdGhlIHN0cmVhbSBtYXkgbm90IGJlIHJlYWR5LlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Uuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFdlYlNvY2tldFZvaWNlQ2hhdC5wcm90b3R5cGUuX3N0b3BWb2ljZUNoYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9jKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXVkaW9Db250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NyaXB0UHJvY2Vzc29yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0UHJvY2Vzc29yLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JpcHRQcm9jZXNzb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tZWRpYVN0cmVhbUF1ZGlvU291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVkaWFTdHJlYW1BdWRpb1NvdXJjZS5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVkaWFTdHJlYW1BdWRpb1NvdXJjZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1lZGlhRGV2aWNlc1N0cmVhbSkge1xuICAgICAgICAgICAgICAgICAgICAoX2IgPSAoX2EgPSB0aGlzLm1lZGlhRGV2aWNlc1N0cmVhbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldFRyYWNrcygpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHsgcmV0dXJuIHRyYWNrLnN0b3AoKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVkaWFEZXZpY2VzU3RyZWFtID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIFdlYlNvY2tldFZvaWNlQ2hhdDtcbn0oQWJzdHJhY3RWb2ljZUNoYXRJbXBsZW1lbnRhdGlvbikpO1xuXG52YXIgVm9pY2VDaGF0VHJhbnNwb3J0O1xuKGZ1bmN0aW9uIChWb2ljZUNoYXRUcmFuc3BvcnQpIHtcbiAgICBWb2ljZUNoYXRUcmFuc3BvcnRbXCJMSVZFS0lUXCJdID0gXCJsaXZla2l0XCI7XG4gICAgVm9pY2VDaGF0VHJhbnNwb3J0W1wiV0VCU09DS0VUXCJdID0gXCJ3ZWJzb2NrZXRcIjtcbn0pKFZvaWNlQ2hhdFRyYW5zcG9ydCB8fCAoVm9pY2VDaGF0VHJhbnNwb3J0ID0ge30pKTtcbnZhciBWb2ljZUNoYXRGYWN0b3J5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhWb2ljZUNoYXRGYWN0b3J5LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFZvaWNlQ2hhdEZhY3RvcnkoX2EpIHtcbiAgICAgICAgdmFyIHZvaWNlQ2hhdEluc3RhbmNlID0gX2Eudm9pY2VDaGF0SW5zdGFuY2UsIGluaXRpYWxDb25maWcgPSBfYS5pbml0aWFsQ29uZmlnO1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5pbml0aWFsQ29uZmlnID0gaW5pdGlhbENvbmZpZztcbiAgICAgICAgX3RoaXMudm9pY2VDaGF0ID0gdm9pY2VDaGF0SW5zdGFuY2U7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZvaWNlQ2hhdEZhY3RvcnkucHJvdG90eXBlLCBcImlzTXV0ZWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZvaWNlQ2hhdC5pc011dGVkO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZvaWNlQ2hhdEZhY3RvcnkucHJvdG90eXBlLCBcImlzVm9pY2VDaGF0dGluZ1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudm9pY2VDaGF0LmlzVm9pY2VDaGF0dGluZztcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFZvaWNlQ2hhdEZhY3RvcnkucHJvdG90eXBlLnN0YXJ0Vm9pY2VDaGF0ID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgYXJndW1lbnRzLCB2b2lkIDAsIGZ1bmN0aW9uIChfYikge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IF9iLmNvbmZpZztcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2MpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy52b2ljZUNoYXQuc3RhcnRWb2ljZUNoYXQoX19hc3NpZ24oX19hc3NpZ24oe30sIHRoaXMuaW5pdGlhbENvbmZpZyksIHsgY29uZmlnOiBjb25maWcgfSkpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Muc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFZvaWNlQ2hhdEZhY3RvcnkucHJvdG90eXBlLnN0b3BWb2ljZUNoYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy52b2ljZUNoYXQuc3RvcFZvaWNlQ2hhdCgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFZvaWNlQ2hhdEZhY3RvcnkucHJvdG90eXBlLm11dGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudm9pY2VDaGF0Lm11dGUoKTtcbiAgICB9O1xuICAgIFZvaWNlQ2hhdEZhY3RvcnkucHJvdG90eXBlLnVubXV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy52b2ljZUNoYXQudW5tdXRlKCk7XG4gICAgfTtcbiAgICBWb2ljZUNoYXRGYWN0b3J5LmNyZWF0ZUxpdmVLaXRWb2ljZUNoYXQgPSBmdW5jdGlvbiAodm9pY2VDaGF0Q29uZmlnKSB7XG4gICAgICAgIHJldHVybiBuZXcgdGhpcyh7XG4gICAgICAgICAgICB2b2ljZUNoYXRJbnN0YW5jZTogbmV3IExpdmVraXRWb2ljZUNoYXQoKSxcbiAgICAgICAgICAgIGluaXRpYWxDb25maWc6IHZvaWNlQ2hhdENvbmZpZyxcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBWb2ljZUNoYXRGYWN0b3J5LmNyZWF0ZVdlYlNvY2tldFZvaWNlQ2hhdCA9IGZ1bmN0aW9uICh2b2ljZUNoYXRDb25maWcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB0aGlzKHtcbiAgICAgICAgICAgIHZvaWNlQ2hhdEluc3RhbmNlOiBuZXcgV2ViU29ja2V0Vm9pY2VDaGF0KCksXG4gICAgICAgICAgICBpbml0aWFsQ29uZmlnOiB2b2ljZUNoYXRDb25maWcsXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIFZvaWNlQ2hhdEZhY3Rvcnk7XG59KEFic3RyYWN0Vm9pY2VDaGF0KSk7XG5cbnZhciBBdmF0YXJRdWFsaXR5O1xuKGZ1bmN0aW9uIChBdmF0YXJRdWFsaXR5KSB7XG4gICAgQXZhdGFyUXVhbGl0eVtcIkxvd1wiXSA9IFwibG93XCI7XG4gICAgQXZhdGFyUXVhbGl0eVtcIk1lZGl1bVwiXSA9IFwibWVkaXVtXCI7XG4gICAgQXZhdGFyUXVhbGl0eVtcIkhpZ2hcIl0gPSBcImhpZ2hcIjtcbn0pKEF2YXRhclF1YWxpdHkgfHwgKEF2YXRhclF1YWxpdHkgPSB7fSkpO1xudmFyIFZvaWNlRW1vdGlvbjtcbihmdW5jdGlvbiAoVm9pY2VFbW90aW9uKSB7XG4gICAgVm9pY2VFbW90aW9uW1wiRVhDSVRFRFwiXSA9IFwiZXhjaXRlZFwiO1xuICAgIFZvaWNlRW1vdGlvbltcIlNFUklPVVNcIl0gPSBcInNlcmlvdXNcIjtcbiAgICBWb2ljZUVtb3Rpb25bXCJGUklFTkRMWVwiXSA9IFwiZnJpZW5kbHlcIjtcbiAgICBWb2ljZUVtb3Rpb25bXCJTT09USElOR1wiXSA9IFwic29vdGhpbmdcIjtcbiAgICBWb2ljZUVtb3Rpb25bXCJCUk9BRENBU1RFUlwiXSA9IFwiYnJvYWRjYXN0ZXJcIjtcbn0pKFZvaWNlRW1vdGlvbiB8fCAoVm9pY2VFbW90aW9uID0ge30pKTtcbnZhciBFbGV2ZW5MYWJzTW9kZWw7XG4oZnVuY3Rpb24gKEVsZXZlbkxhYnNNb2RlbCkge1xuICAgIEVsZXZlbkxhYnNNb2RlbFtcImVsZXZlbl9mbGFzaF92Ml81XCJdID0gXCJlbGV2ZW5fZmxhc2hfdjJfNVwiO1xuICAgIEVsZXZlbkxhYnNNb2RlbFtcImVsZXZlbl9tdWx0aWxpbmd1YWxfdjJcIl0gPSBcImVsZXZlbl9tdWx0aWxpbmd1YWxfdjJcIjtcbn0pKEVsZXZlbkxhYnNNb2RlbCB8fCAoRWxldmVuTGFic01vZGVsID0ge30pKTtcbnZhciBTVFRQcm92aWRlcjtcbihmdW5jdGlvbiAoU1RUUHJvdmlkZXIpIHtcbiAgICBTVFRQcm92aWRlcltcIkRFRVBHUkFNXCJdID0gXCJkZWVwZ3JhbVwiO1xuICAgIFNUVFByb3ZpZGVyW1wiR0xBRElBXCJdID0gXCJnbGFkaWFcIjtcbn0pKFNUVFByb3ZpZGVyIHx8IChTVFRQcm92aWRlciA9IHt9KSk7XG52YXIgVGFza1R5cGU7XG4oZnVuY3Rpb24gKFRhc2tUeXBlKSB7XG4gICAgVGFza1R5cGVbXCJUQUxLXCJdID0gXCJ0YWxrXCI7XG4gICAgVGFza1R5cGVbXCJSRVBFQVRcIl0gPSBcInJlcGVhdFwiO1xufSkoVGFza1R5cGUgfHwgKFRhc2tUeXBlID0ge30pKTtcbnZhciBUYXNrTW9kZTtcbihmdW5jdGlvbiAoVGFza01vZGUpIHtcbiAgICBUYXNrTW9kZVtcIlNZTkNcIl0gPSBcInN5bmNcIjtcbiAgICBUYXNrTW9kZVtcIkFTWU5DXCJdID0gXCJhc3luY1wiO1xufSkoVGFza01vZGUgfHwgKFRhc2tNb2RlID0ge30pKTtcbi8vIGV2ZW50IHR5cGVzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG52YXIgU3RyZWFtaW5nRXZlbnRzO1xuKGZ1bmN0aW9uIChTdHJlYW1pbmdFdmVudHMpIHtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJBVkFUQVJfU1RBUlRfVEFMS0lOR1wiXSA9IFwiYXZhdGFyX3N0YXJ0X3RhbGtpbmdcIjtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJBVkFUQVJfU1RPUF9UQUxLSU5HXCJdID0gXCJhdmF0YXJfc3RvcF90YWxraW5nXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiQVZBVEFSX1RBTEtJTkdfTUVTU0FHRVwiXSA9IFwiYXZhdGFyX3RhbGtpbmdfbWVzc2FnZVwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIkFWQVRBUl9FTkRfTUVTU0FHRVwiXSA9IFwiYXZhdGFyX2VuZF9tZXNzYWdlXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiVVNFUl9UQUxLSU5HX01FU1NBR0VcIl0gPSBcInVzZXJfdGFsa2luZ19tZXNzYWdlXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiVVNFUl9FTkRfTUVTU0FHRVwiXSA9IFwidXNlcl9lbmRfbWVzc2FnZVwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIlVTRVJfU1RBUlRcIl0gPSBcInVzZXJfc3RhcnRcIjtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJVU0VSX1NUT1BcIl0gPSBcInVzZXJfc3RvcFwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIlVTRVJfU0lMRU5DRVwiXSA9IFwidXNlcl9zaWxlbmNlXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiU1RSRUFNX1JFQURZXCJdID0gXCJzdHJlYW1fcmVhZHlcIjtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJTVFJFQU1fRElTQ09OTkVDVEVEXCJdID0gXCJzdHJlYW1fZGlzY29ubmVjdGVkXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiQ09OTkVDVElPTl9RVUFMSVRZX0NIQU5HRURcIl0gPSBcImNvbm5lY3Rpb25fcXVhbGl0eV9jaGFuZ2VkXCI7XG59KShTdHJlYW1pbmdFdmVudHMgfHwgKFN0cmVhbWluZ0V2ZW50cyA9IHt9KSk7XG52YXIgQVBJRXJyb3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEFQSUVycm9yLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEFQSUVycm9yKG1lc3NhZ2UsIHN0YXR1cywgcmVzcG9uc2VUZXh0KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLm5hbWUgPSAnQVBJRXJyb3InO1xuICAgICAgICBfdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgIF90aGlzLnJlc3BvbnNlVGV4dCA9IHJlc3BvbnNlVGV4dDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gQVBJRXJyb3I7XG59KEVycm9yKSk7XG52YXIgQ29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3JDbGFzcyA9IFF1YWxpdHlJbmRpY2F0b3JNaXhlcih7XG4gICAgVHJhY2tlckNsYXNzOiBMaXZlS2l0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IsXG4gICAgZ2V0UGFyYW1zOiBmdW5jdGlvbiAocm9vbSkgeyByZXR1cm4gcm9vbTsgfSxcbn0sIHtcbiAgICBUcmFja2VyQ2xhc3M6IFdlYlJUQ0Nvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLFxuICAgIGdldFBhcmFtczogZnVuY3Rpb24gKHJvb20pIHsgdmFyIF9hOyByZXR1cm4gKChfYSA9IHJvb20uZW5naW5lLnBjTWFuYWdlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN1YnNjcmliZXIpLl9wYzsgfSxcbn0pO1xudmFyIFN0cmVhbWluZ0F2YXRhciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTdHJlYW1pbmdBdmF0YXIoX2EpIHtcbiAgICAgICAgdmFyIHRva2VuID0gX2EudG9rZW4sIF9iID0gX2EuYmFzZVBhdGgsIGJhc2VQYXRoID0gX2IgPT09IHZvaWQgMCA/ICdodHRwczovL2FwaS5oZXlnZW4uY29tJyA6IF9iO1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnJvb20gPSBudWxsO1xuICAgICAgICB0aGlzLm1lZGlhU3RyZWFtID0gbnVsbDtcbiAgICAgICAgdGhpcy5ldmVudFRhcmdldCA9IG5ldyBFdmVudFRhcmdldCgpO1xuICAgICAgICB0aGlzLndlYlNvY2tldCA9IG51bGw7XG4gICAgICAgIHRoaXMuc2Vzc2lvbklkID0gbnVsbDtcbiAgICAgICAgdGhpcy52b2ljZUNoYXQgPSBudWxsO1xuICAgICAgICB0aGlzLmlzTGl2ZUtpdFRyYW5zcG9ydCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRva2VuID0gdG9rZW47XG4gICAgICAgIHRoaXMuYmFzZVBhdGggPSBiYXNlUGF0aDtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uUXVhbGl0eUluZGljYXRvciA9IG5ldyBDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvckNsYXNzKGZ1bmN0aW9uIChxdWFsaXR5KSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuZW1pdChTdHJlYW1pbmdFdmVudHMuQ09OTkVDVElPTl9RVUFMSVRZX0NIQU5HRUQsIHF1YWxpdHkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUsIFwiY29ubmVjdGlvblF1YWxpdHlcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLmNvbm5lY3Rpb25RdWFsaXR5O1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUsIFwiaXNJbnB1dEF1ZGlvTXV0ZWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICByZXR1cm4gKF9iID0gKF9hID0gdGhpcy52b2ljZUNoYXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc011dGVkKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5tdXRlSW5wdXRBdWRpbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnZvaWNlQ2hhdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm11dGUoKTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUudW5tdXRlSW5wdXRBdWRpbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnZvaWNlQ2hhdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVubXV0ZSgpO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5jcmVhdGVTdGFydEF2YXRhciA9IGZ1bmN0aW9uIChyZXF1ZXN0RGF0YSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc2Vzc2lvbkluZm87XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMubmV3U2Vzc2lvbihyZXF1ZXN0RGF0YSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSW5mbyA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnN0YXJ0QXZhdGFyKHJlcXVlc3REYXRhLCBzZXNzaW9uSW5mbyldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc3RhcnRBdmF0YXIgPSBmdW5jdGlvbiAocmVxdWVzdERhdGEsIHNlc3Npb25JbmZvKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciByb29tLCBtZWRpYVN0cmVhbTtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25JZCA9IHNlc3Npb25JbmZvLnNlc3Npb25faWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTGl2ZUtpdFRyYW5zcG9ydCA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdERhdGEudm9pY2VDaGF0VHJhbnNwb3J0ID09PSBWb2ljZUNoYXRUcmFuc3BvcnQuTElWRUtJVDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb20gPSBuZXcgUm9vbSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRhcHRpdmVTdHJlYW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHluYWNhc3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9DYXB0dXJlRGVmYXVsdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogVmlkZW9QcmVzZXRzLmg3MjAucmVzb2x1dGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJvb20gPSByb29tO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZWRpYVN0cmVhbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICByb29tLm9uKFJvb21FdmVudC5EYXRhUmVjZWl2ZWQsIGZ1bmN0aW9uIChyb29tTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldmVudE1zZyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VTdHJpbmcgPSBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUocm9vbU1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudE1zZyA9IEpTT04ucGFyc2UobWVzc2FnZVN0cmluZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZXZlbnRNc2cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5lbWl0KGV2ZW50TXNnLnR5cGUsIGV2ZW50TXNnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWFTdHJlYW0gPSBuZXcgTWVkaWFTdHJlYW0oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb20ub24oUm9vbUV2ZW50LlRyYWNrU3Vic2NyaWJlZCwgZnVuY3Rpb24gKHRyYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyYWNrLmtpbmQgPT09ICd2aWRlbycgfHwgdHJhY2sua2luZCA9PT0gJ2F1ZGlvJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYVN0cmVhbS5hZGRUcmFjayh0cmFjay5tZWRpYVN0cmVhbVRyYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhhc1ZpZGVvVHJhY2sgPSBtZWRpYVN0cmVhbS5nZXRWaWRlb1RyYWNrcygpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoYXNBdWRpb1RyYWNrID0gbWVkaWFTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzVmlkZW9UcmFjayAmJiBoYXNBdWRpb1RyYWNrICYmICFfdGhpcy5tZWRpYVN0cmVhbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubWVkaWFTdHJlYW0gPSBtZWRpYVN0cmVhbTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVtaXQoU3RyZWFtaW5nRXZlbnRzLlNUUkVBTV9SRUFEWSwgX3RoaXMubWVkaWFTdHJlYW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByb29tLm9uKFJvb21FdmVudC5UcmFja1Vuc3Vic2NyaWJlZCwgZnVuY3Rpb24gKHRyYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lZGlhVHJhY2sgPSB0cmFjay5tZWRpYVN0cmVhbVRyYWNrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZWRpYVRyYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhU3RyZWFtLnJlbW92ZVRyYWNrKG1lZGlhVHJhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbS5vbihSb29tRXZlbnQuRGlzY29ubmVjdGVkLCBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZW1pdChTdHJlYW1pbmdFdmVudHMuU1RSRUFNX0RJU0NPTk5FQ1RFRCwgcmVhc29uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAxO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzEsIDMsICwgNF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgcm9vbS5wcmVwYXJlQ29ubmVjdGlvbihzZXNzaW9uSW5mby51cmwsIHNlc3Npb25JbmZvLmFjY2Vzc190b2tlbildO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDogcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdGFydFNlc3Npb24oKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHJvb20uY29ubmVjdChzZXNzaW9uSW5mby51cmwsIHNlc3Npb25JbmZvLmFjY2Vzc190b2tlbildO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmNvbm5lY3RXZWJTb2NrZXQoeyB1c2VTaWxlbmNlUHJvbXB0OiAhIXJlcXVlc3REYXRhLnVzZVNpbGVuY2VQcm9tcHQgfSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRWb2ljZUNoYXQocmVxdWVzdERhdGEudm9pY2VDaGF0VHJhbnNwb3J0IHx8IFZvaWNlQ2hhdFRyYW5zcG9ydC5XRUJTT0NLRVQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5zdGFydChyb29tKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBzZXNzaW9uSW5mb107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5zdGFydFZvaWNlQ2hhdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCBhcmd1bWVudHMsIHZvaWQgMCwgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICB2YXIgX2I7XG4gICAgICAgICAgICB2YXIgX2MgPSBfYSA9PT0gdm9pZCAwID8ge30gOiBfYSwgaXNJbnB1dEF1ZGlvTXV0ZWQgPSBfYy5pc0lucHV0QXVkaW9NdXRlZDtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2QpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9kLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgKChfYiA9IHRoaXMudm9pY2VDaGF0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3RhcnRWb2ljZUNoYXQoeyBjb25maWc6IHsgZGVmYXVsdE11dGVkOiBpc0lucHV0QXVkaW9NdXRlZCB9IH0pKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9kLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmNsb3NlVm9pY2VDaGF0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9iKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYi5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sICgoX2EgPSB0aGlzLnZvaWNlQ2hhdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0b3BWb2ljZUNoYXQoKSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5uZXdTZXNzaW9uID0gZnVuY3Rpb24gKHJlcXVlc3REYXRhKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9mKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucmVxdWVzdCgnL3YxL3N0cmVhbWluZy5uZXcnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdmF0YXJfbmFtZTogcmVxdWVzdERhdGEuYXZhdGFyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1YWxpdHk6IHJlcXVlc3REYXRhLnF1YWxpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBrbm93bGVkZ2VfYmFzZV9pZDogcmVxdWVzdERhdGEua25vd2xlZGdlSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBrbm93bGVkZ2VfYmFzZTogcmVxdWVzdERhdGEua25vd2xlZGdlQmFzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvaWNlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pY2VfaWQ6IChfYSA9IHJlcXVlc3REYXRhLnZvaWNlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eudm9pY2VJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXRlOiAoX2IgPSByZXF1ZXN0RGF0YS52b2ljZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnJhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vdGlvbjogKF9jID0gcmVxdWVzdERhdGEudm9pY2UpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5lbW90aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZXZlbmxhYnNfc2V0dGluZ3M6IF9fYXNzaWduKF9fYXNzaWduKHt9LCAoX2QgPSByZXF1ZXN0RGF0YSA9PT0gbnVsbCB8fCByZXF1ZXN0RGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVxdWVzdERhdGEudm9pY2UpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5lbGV2ZW5sYWJzU2V0dGluZ3MpLCB7IG1vZGVsX2lkOiAoX2UgPSByZXF1ZXN0RGF0YS52b2ljZSkgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLm1vZGVsIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiByZXF1ZXN0RGF0YS5sYW5ndWFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246ICd2MicsXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWRlb19lbmNvZGluZzogJ0gyNjQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiAnc2RrJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVfaWRsZV90aW1lb3V0OiByZXF1ZXN0RGF0YS5kaXNhYmxlSWRsZVRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHRfc2V0dGluZ3M6IHJlcXVlc3REYXRhLnN0dFNldHRpbmdzLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWFfaXNfbGl2ZWtpdF90cmFuc3BvcnQ6IHJlcXVlc3REYXRhLnZvaWNlQ2hhdFRyYW5zcG9ydCA9PT0gVm9pY2VDaGF0VHJhbnNwb3J0LkxJVkVLSVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaWxlbmNlX3Jlc3BvbnNlOiByZXF1ZXN0RGF0YS51c2VTaWxlbmNlUHJvbXB0LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlfaWRsZV90aW1lb3V0OiByZXF1ZXN0RGF0YS5hY3Rpdml0eUlkbGVUaW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLnN0YXJ0U2Vzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnJlcXVlc3QoJy92MS9zdHJlYW1pbmcuc3RhcnQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2lkOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5zcGVhayA9IGZ1bmN0aW9uIChyZXF1ZXN0RGF0YSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGFza1R5cGUsIHRhc2tNb2RlO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHRhc2tUeXBlID0gcmVxdWVzdERhdGEudGFza1R5cGUgfHwgcmVxdWVzdERhdGEudGFza190eXBlIHx8IFRhc2tUeXBlLlRBTEs7XG4gICAgICAgICAgICAgICAgdGFza01vZGUgPSByZXF1ZXN0RGF0YS50YXNrTW9kZSB8fCBUYXNrTW9kZS5BU1lOQztcbiAgICAgICAgICAgICAgICAvLyBsaXZla2l0L3dlYnNvY2tldCB0ZXh0IHRyYW5zcG9ydCBzdXBwb3J0cyBvbmx5IGFzeW5jIHRhbGsgdGFza1xuICAgICAgICAgICAgICAgIGlmICh0YXNrVHlwZSA9PT0gVGFza1R5cGUuVEFMSyAmJiB0YXNrTW9kZSA9PT0gVGFza01vZGUuQVNZTkMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNMaXZlS2l0VHJhbnNwb3J0ICYmIHRoaXMucm9vbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTGl2ZWtpdE1lc3NhZ2UocmVxdWVzdERhdGEudGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzTGl2ZUtpdFRyYW5zcG9ydCAmJiB0aGlzLndlYlNvY2tldCAmJiB0aGlzLmF1ZGlvUmF3RnJhbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZFdlYnNvY2tldE1lc3NhZ2UocmVxdWVzdERhdGEudGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucmVxdWVzdCgnL3YxL3N0cmVhbWluZy50YXNrJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogcmVxdWVzdERhdGEudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25faWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFza19tb2RlOiByZXF1ZXN0RGF0YS50YXNrTW9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogcmVxdWVzdERhdGEudGFza1R5cGUsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc3RhcnRMaXN0ZW5pbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5yZXF1ZXN0KCcvdjEvc3RyZWFtaW5nLnN0YXJ0X2xpc3RlbmluZycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25faWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLnN0b3BMaXN0ZW5pbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5yZXF1ZXN0KCcvdjEvc3RyZWFtaW5nLnN0b3BfbGlzdGVuaW5nJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZDogdGhpcy5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuaW50ZXJydXB0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucmVxdWVzdCgnL3YxL3N0cmVhbWluZy5pbnRlcnJ1cHQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2lkOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5zdG9wQXZhdGFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgLy8gY2xlYXIgc29tZSByZXNvdXJjZXNcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlVm9pY2VDaGF0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgdGhpcy52b2ljZUNoYXQgPSBudWxsO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLndlYlNvY2tldCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndlYlNvY2tldC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndlYlNvY2tldCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnJlcXVlc3QoJy92MS9zdHJlYW1pbmcuc3RvcCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25faWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmtlZXBBbGl2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnJlcXVlc3QoJy92MS9zdHJlYW1pbmcua2VlcF9hbGl2ZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25faWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKGV2ZW50VHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgICAgdGhpcy5ldmVudFRhcmdldC5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgbGlzdGVuZXIpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24gKGV2ZW50VHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgICAgdGhpcy5ldmVudFRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgbGlzdGVuZXIpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc2VuZExpdmVraXRNZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGRhdGE7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJvb20pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkYXRhID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJvb20ubG9jYWxQYXJ0aWNpcGFudC5wdWJsaXNoRGF0YShkYXRhLCB7IHJlbGlhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc2VuZFdlYnNvY2tldE1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZnJhbWUsIGVuY29kZWRGcmFtZTtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9jKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLndlYlNvY2tldCB8fCAhdGhpcy5hdWRpb1Jhd0ZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnJhbWUgPSAoX2EgPSB0aGlzLmF1ZGlvUmF3RnJhbWUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGVuY29kZWRGcmFtZSA9IG5ldyBVaW50OEFycmF5KChfYiA9IHRoaXMuYXVkaW9SYXdGcmFtZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmVuY29kZShmcmFtZSkuZmluaXNoKCkpO1xuICAgICAgICAgICAgICAgIHRoaXMud2ViU29ja2V0LnNlbmQoZW5jb2RlZEZyYW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmluaXRWb2ljZUNoYXQgPSBmdW5jdGlvbiAodHJhbnNwb3J0KSB7XG4gICAgICAgIGlmICh0cmFuc3BvcnQgPT09IFZvaWNlQ2hhdFRyYW5zcG9ydC5XRUJTT0NLRVQpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZEF1ZGlvUmF3RnJhbWUoKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5hdWRpb1Jhd0ZyYW1lIHx8ICF0aGlzLndlYlNvY2tldCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudm9pY2VDaGF0ID0gVm9pY2VDaGF0RmFjdG9yeS5jcmVhdGVXZWJTb2NrZXRWb2ljZUNoYXQoe1xuICAgICAgICAgICAgICAgIHdlYlNvY2tldDogdGhpcy53ZWJTb2NrZXQsXG4gICAgICAgICAgICAgICAgYXVkaW9SYXdGcmFtZTogdGhpcy5hdWRpb1Jhd0ZyYW1lLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMucm9vbSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudm9pY2VDaGF0ID0gVm9pY2VDaGF0RmFjdG9yeS5jcmVhdGVMaXZlS2l0Vm9pY2VDaGF0KHtcbiAgICAgICAgICAgICAgICByb29tOiB0aGlzLnJvb20sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5yZXF1ZXN0ID0gZnVuY3Rpb24gKHBhdGgsIHBhcmFtcywgY29uZmlnKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZSwgZXJyb3JUZXh0LCBqc29uRGF0YSwgZXJyb3JfMjtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMCwgNSwgLCA2XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBmZXRjaCh0aGlzLmdldFJlcXVlc3RVcmwocGF0aCksIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IFwiQmVhcmVyIFwiLmNvbmNhdCh0aGlzLnRva2VuKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIXJlc3BvbnNlLm9rKSByZXR1cm4gWzMgLypicmVhayovLCAzXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHJlc3BvbnNlLnRleHQoKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yVGV4dCA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkFQSSByZXF1ZXN0IGZhaWxlZCB3aXRoIHN0YXR1cyBcIi5jb25jYXQocmVzcG9uc2Uuc3RhdHVzKSwgcmVzcG9uc2Uuc3RhdHVzLCBlcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6IHJldHVybiBbNCAvKnlpZWxkKi8sIHJlc3BvbnNlLmpzb24oKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGpzb25EYXRhID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGpzb25EYXRhLmRhdGFdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl8yID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3JfMjtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gKGV2ZW50VHlwZSwgZGV0YWlsKSB7XG4gICAgICAgIHZhciBldmVudCA9IG5ldyBDdXN0b21FdmVudChldmVudFR5cGUsIHsgZGV0YWlsOiBkZXRhaWwgfSk7XG4gICAgICAgIHRoaXMuZXZlbnRUYXJnZXQuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmdldFJlcXVlc3RVcmwgPSBmdW5jdGlvbiAoZW5kcG9pbnQpIHtcbiAgICAgICAgcmV0dXJuIFwiXCIuY29uY2F0KHRoaXMuYmFzZVBhdGgpLmNvbmNhdChlbmRwb2ludCk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmNvbm5lY3RXZWJTb2NrZXQgPSBmdW5jdGlvbiAocmVxdWVzdERhdGEpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHdlYnNvY2tldFVybDtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgd2Vic29ja2V0VXJsID0gXCJ3c3M6Ly9cIi5jb25jYXQobmV3IFVSTCh0aGlzLmJhc2VQYXRoKS5ob3N0bmFtZSwgXCIvdjEvd3Mvc3RyZWFtaW5nLmNoYXQ/c2Vzc2lvbl9pZD1cIikuY29uY2F0KHRoaXMuc2Vzc2lvbklkLCBcIiZzZXNzaW9uX3Rva2VuPVwiKS5jb25jYXQodGhpcy50b2tlbikuY29uY2F0KHRoaXMuaXNMaXZlS2l0VHJhbnNwb3J0ID8gJyZhcmNoX3ZlcnNpb249djInIDogJycsIFwiJnNpbGVuY2VfcmVzcG9uc2U9XCIpLmNvbmNhdChyZXF1ZXN0RGF0YS51c2VTaWxlbmNlUHJvbXB0KTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYlNvY2tldCA9IG5ldyBXZWJTb2NrZXQod2Vic29ja2V0VXJsKTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYlNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBldmVudERhdGEgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnREYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5lbWl0KGV2ZW50RGF0YS5ldmVudF90eXBlLCBldmVudERhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMud2ViU29ja2V0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICAgICAgICAgIChfYSA9IF90aGlzLndlYlNvY2tldCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMud2ViU29ja2V0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAoX2IgPSBfdGhpcy53ZWJTb2NrZXQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hZGRFdmVudExpc3RlbmVyKCdvcGVuJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5sb2FkQXVkaW9SYXdGcmFtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJvb3Q7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmF1ZGlvUmF3RnJhbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcm9vdCA9IHByb3RvYnVmLlJvb3QuZnJvbUpTT04oanNvbkRlc2NyaXB0b3IpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvUmF3RnJhbWUgPSByb290ID09PSBudWxsIHx8IHJvb3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJvb3QubG9va3VwVHlwZSgncGlwZWNhdC5GcmFtZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gU3RyZWFtaW5nQXZhdGFyO1xufSgpKTtcblxuZXhwb3J0IHsgQXZhdGFyUXVhbGl0eSwgQ29ubmVjdGlvblF1YWxpdHksIEVsZXZlbkxhYnNNb2RlbCwgU1RUUHJvdmlkZXIsIFN0cmVhbWluZ0V2ZW50cywgVGFza01vZGUsIFRhc2tUeXBlLCBWb2ljZUNoYXRUcmFuc3BvcnQsIFZvaWNlRW1vdGlvbiwgU3RyZWFtaW5nQXZhdGFyIGFzIGRlZmF1bHQgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@heygen/streaming-avatar/lib/index.esm.js\n");

/***/ })

};
;